<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<TITLE>KDevelop. Руководство программиста: Конфигурирование меню и панелей инструментов</TITLE>
<META HTTP-EQUIV="content-type" CONTENT="text/html; charset=koi8-r">
<META NAME="keywords" CONTENT="">
<META NAME="description" CONTENT="">
</HEAD>
<BODY BGCOLOR="#ffffff" LINK="#aa0000" TEXT="#000000" > 
<FONT FACE="Helvetica">
<A HREF="http://www.kde.org/"><IMG SRC="logotp3.png" BORDER="0" ALT="The K Desktop Environment"></A>
<HR WIDTH="100%" SIZE=2 ALIGN="CENTER" NOSHADE>

 
<P ALIGN="RIGHT">

<A HREF="index-6.html">Next</A>
 <A HREF="index-4.html">Previous</A>
 <A HREF="index.html#toc5">Table of Contents</A>
</P>
<H3><A NAME="Configuring Menubars and Toolbars"></A> <A NAME="s5">5. Конфигурирование меню и панелей инструментов</A></H3>

<P>Меню и панели инструментов - одна из наиболее важных частей приложения для обеспечения работы с документом.
Как правило, вы должны сделать доступными все функции через меню. Те пункты меню, которые вызывают функции, недоступные в текущем состоянии приложения,
должны быть запрещены.
<P>Далее, приложение может содержать только одну панель меню, но несколько панелей инструментов. 
<P>Панель инструментов должна содержать только наиболее часто используемые функции,
которые должны вызываться нажатием кнопок с иконками; также в состав панелей инструментов могут входить выпадающие списки для выбора значений.
<P>
<H3><A NAME="ss5.1">5.1 Как они работают ?</A>
</H3>

<P>Каждый вход меню или кнопка панели инструментов имеет ресурсный идентификатор (ID), представляющий собой число типа integer. Поскольку данные значения не могут использоваться дважды,
они представляются макросами. В макросах числовое значение заменяется осмысленным названием, используемым в коде программы.
<P>Все ресурсные ID собраны в файле <CODE>resource.h</CODE>, где можно посмотреть, какие числа уже задействованы. В любом случае, компилятор
проинформирует вас, если вы дважды используете одно и то же число для различных входов. Кроме того, ресурсный файл должен содержать все клавиши быстрого доступа к меню,
заменяемые в IDK-макросе(?). Например:
<P>
<HR>
<PRE>
(resource.h)

#define ID_VIEW_TOOLBAR             12010


(kscribble.cpp)

// menu entry Toolbar in the "view" menubar menu
view_menu->insertItem(i18n("&amp;Toolbar"), ID_VIEW_TOOLBAR);
</PRE>
<HR>
<P>Этот код добавляет вход Toolbar в меню View панели меню приложения kscribble. Имя ресурсного ID
состоит из имени меню и имени входа, как видно. Амперсант, стоящий перед буквой, заставляет ее работать как горячую клавишу,
а само имя входа передается с использованием макроса интернационализации i18n().
<P>При активации входа меню вызывается конструкция switch функции commandCallback() с ID меню. Поэтому вы должны добавить соответствующее сравнение
в конструкцию switch и функцию, которую необходимо выполнить при выборе данного входа меню:
<P>
<HR>
<PRE>
    case ID_VIEW_TOOLBAR:
        slotViewToolBar();
        break;
</PRE>
<HR>
<P>Заметьте, что вы не обязаны использовать систему ID. Если не задан никакой ID, меню нумеруется автоматически. 
KDevelop использует систему ID для того, чтобы иметь возможность создать конструкции switch для выбора выполняемого слота при
поступлении сигнала <CODE>activated()</CODE> для меню и <CODE>clicked()</CODE> для кнопок панели инструментов. 
Однако эта связь может быть реализована непосредственно, используя соответствующие методы классов меню и панели инструментов.
<P>
<P>
<H3><A NAME="ss5.2">5.2 Добавление нового меню</A>
</H3>

<P>Новое меню добавляется в приложение так:
<P>
<OL>
<LI>добавьте указатель на новое меню в заголовке класса приложения (App-class);</LI>
<LI>вызовите конструктор <CODE>QPopupMenu</CODE> для указателя в <CODE>initMenuBar()</CODE> там, где должна появиться ваша панель меню в дальнейшем;</LI>
<LI>добавьте соответствующие пункты меню в выпадающие меню и установите их ресурсные ID в файле ресурсов;</LI>
<LI>добавьте связи меню с <CODE>commandCallback()</CODE> и <CODE>statusCallback()</CODE> в конце <CODE>initMenuBar()</CODE>;</LI>
<LI>добавьте методы, которые будут вызываться при выборе входов меню, в заголовки и файлы реализации;</LI>
<LI>добавьте конструкции switch для входов в <CODE>commandCallback()</CODE> и <CODE>statusCallback()</CODE>;</LI>
</OL>
<P>
<P>
<H3><A NAME="ss5.3">5.3 Использование кнопок панелей инструментов</A>
</H3>

<P>Кнопки панелей инструментов могут быть добавлены аналогично входам меню, но с тем отличием, что используемый метод - <CODE>insertButton()</CODE>. 
Этот метод принимает в качестве аргументов иконку и всплывающую подсказку вместо текста меню.
<P>Иконки, которые вы хотите использовать, загружаются с помощью <CODE>KIconLoader</CODE>. <CODE>KApplication</CODE> предоставляет макросы <CODE>ICON()</CODE> и <CODE>Icon()</CODE> 
для доступа к <CODE>KIconLoader</CODE> и загрузки иконок. Эти макросы получают в качестве параметра имя файла иконки для ее загрузки из
файловой системы KDE, производя в ней поиск в определенном порядке (см. <CODE>KIconLoader</CODE> для уточнения этого порядка).
<P>
<P>Библиотеки KDE также предоставляют набор кнопок для панелей инструментов, которые используются для выполнения стандартных действий. В случае, когда они не удовлетворяют ваших потребностей,
вы должны самостоятельно нарисовать иконки. KDevelop поможет вам это сделать - выберите "New" из меню "File", затем выберите тип файла Pixmap.
Обычно иконки для панели инструментов располагаются в поддиректории проекта "toolbar" и инсталлируются оттуда в специфичный для вашего приложения
KDE каталог "toolbar".
<P>
<H3><A NAME="ss5.4">5.4 Конфигурация строки статуса</A>
</H3>

<P>Шаблон проекта KDevelop уже использует строку статуса, отображая в ней справку о назначении входов меню и кнопок панели инструментов.
При добавлении входа меню также добавляйте справочное сообщение в метод <CODE>statusCallback()</CODE>.
<P><CODE>statusCallback()</CODE> использует метод <CODE>slotStatusHelpMsg()</CODE> для показа сообщения в строке статуса в течение 2 секунд.
Когда выполняется команда, вы должны использовать метод <CODE>slotStatusMsg()</CODE> в начале выполнения со строкой, поясняющей, что приложение делает;
перед окончанием операции вы должны установить сообщение в строке статуса "Ready.", вызывая тот же метод.
<P>
<P>
<H3><A NAME="ss5.5">5.5 Конфигурация горячих клавиш</A>
</H3>

<P>Очень профессиональная вещь, которую вы всегда должны добавлять в ваше приложение, - это горячие клавиши. Они обычно используются опытными пользователями,
которые хотят работать с приложением быстро и готовы изучить горячие клавиши. Для них библиотека KDE предоставляет класс
<CODE>KAccel</CODE>, который реализует горячие клавиши и обеспечивает доступ к стандартной глобальной конфигурации горячих клавиш.
<P>По умолчанию, приложение, сгенерированное KDevelop, использует только стандартные горячие клавиши, такие как F1 для получения помощи,
Ctrl+N для создания нового файла. Перед добавлением новой комбинации клавиш вы должны посмотреть, а не определена ли она уже.
<P>Если ваше приложение содержит множество горячих клавиш, вы должны сделать их конфигурируемыми через меню Options; они могут совпадать с конфигурацией других приложений
или использоваться только в вашем. Библиотека KDE предоставляет класс <CODE>KKeyChooser</CODE> для использования в многостраничном диалоге,
тогда как <CODE>KKeyDialog</CODE> дает готовое диалоговое окно для конфигурации горячих клавиш.
<P>Для более детальной информации см. следующие классы:
<CODE>KAccel</CODE>(kdecore), <CODE>KKeyChooser</CODE>, <CODE>KKeyDialog</CODE> (kdeui).
<P>
<P ALIGN="RIGHT">

<A HREF="index-6.html">Next</A>
 <A HREF="index-4.html">Previous</A>
 <A HREF="index.html#toc5">Table of Contents</A>
</P>
<CENTER>
<HR WIDTH="100%" SIZE=3 ALIGN=CENTER NOSHADE>
</CENTER>    
</FONT>

 
</BODY>
</HTML>
