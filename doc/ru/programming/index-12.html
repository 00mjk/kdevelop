<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<TITLE>KDevelop. Руководство программиста: Поиск ошибок</TITLE>
<META HTTP-EQUIV="content-type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="keywords" CONTENT="">
<META NAME="description" CONTENT="">
</HEAD>
<BODY BGCOLOR="#ffffff" LINK="#aa0000" TEXT="#000000" > 
<FONT FACE="Helvetica">
<A HREF="http://www.kde.org/"><IMG SRC="logotp3.png" BORDER="0" ALT="The K Desktop Environment"></A>
<HR WIDTH="100%" SIZE=2 ALIGN="CENTER" NOSHADE>

 
<P ALIGN="RIGHT">

<A HREF="index-13.html">Next</A>
 <A HREF="index-11.html">Previous</A>
 <A HREF="index.html#toc12">Table of Contents</A>
</P>
<H3><A NAME="s12">12. Поиск ошибок</A></H3>

<P>
<!--
debugging macros
-->
<H3><A NAME="ss12.1">12.1 Отладочные макросы, предоставляемые Qt</A>
</H3>

<P>Отладочные макросы, предоставляемые  библиотекой Qt, описаны на странице debug.html online-документации Qt, 
доступной по линку "Debugging Techniques" на странице с индексом Qt-документации.
<P>Наиболее часто используемые макросы:
<P>
<UL>
<LI>ASSERT(b)</LI>
<LI>CHECK_PTR(p)</LI>
</UL>
<P>b - выражение типа boolean. Генерирует предупреждающее сообщение дебаггера, если равно false; p - указатель, который проверяется, если
он равен нулю, то генерируется предупреждающее сообщение.
<P>Подробности см. в online-документации Qt.
<P>
<H3><A NAME="ss12.2">12.2 Макросы KDE</A>
</H3>

<P><B>Внимание:</B> Эта глава - копия документа о макросе KDEBUG, включенного в набор библиотек KDE и
написанного Kalle Dalheimer's 
<A HREF="mailto:kalle@kde.org">kalle@kde.org</A>. Документ
находится в файле kdebug.html.
<P>Последнее изменение: Sat Sep 13 11:56:01 CEST 1997
<P>
<P><B>Что такое KDebug</B>
<P>KDebug - набор макросов и функций, делающий более эффективным использование диагностических сообщений. Вы можете получать сообщения
одного из четырех уровней строгости. Вы можете выбрать в процессе выполнения, куда должны выводиться диагностические сообщения, и какие из них
вообще должны выводиться.
<P><B>Макрос KDEBUG</B>
<P>Использование KDebug очень простое. Все, что вы должны сделать, это включить #include &lt;kdebug.h&gt; 
в начало каждого исходного файла, в котором вы хотите использовать диагностические сообщения, и выводить эти сообщения, 
вызывая макрос KDEBUG. Он ожидает 3 параметра. Первый - уровень безопасности; используйте следующие константы:
<P>
<UL>
<LI>KDEBUG_INFO</LI>
<LI>KDEBUG_WARN</LI>
<LI>KDEBUG_ERROR</LI>
<LI>KDEBUG_FATAL</LI>
</UL>
<P>Второй параметр - это область. Область - часть KDE, которую вы определяете сами. Потом, в процессе выполнения, вы сможете выбрать, от какой
области необходимо печатать диагностические сообщения. См. файл kdelibs/kdecore/kdebugareas.txt для получения списка уже назначенных диапазонов областей.
Выберите область в диапазоне вашего приложения. Если ваше приложение еще не включено в этот список, и вы имеете доступ к CVS, вы можете
назначить там область для своего приложения, иначе напишите мне. Вероятно, будет хорошей идеей определить символическую константу для
области, которую вы хотите использовать, но это решаете вы. 
<P>Третий параметр, наконец, это текст, который вы хотите вывести. KDebug
автоматически добавит логическое имя приложения, если вы производите вывод в файл, в stderr или в syslog. Всегда добавляется символ новой строки, 
вы не должны его использовать сами. Если вам нужны параметры, вы можете использовать один из макросов KDEBUG1, ..., KDEBUG9. Это позволит
иметь от 1 до 9 дополнительных параметров. Синтаксис вывода абсолютно аналогичен printf, например, вы можете включать спецификации формата в ваше
сообщение, которые заменяются дополнительными параметрами. Например:
<P>
<BLOCKQUOTE><CODE>
<HR>
<PRE>
KDEBUG3( &lt;idx/KDEBUG_INFO/, kmail_composer, "Message no. %d to %s has %d bytes",
          message_no, aMessage.to(), aMessage.length() );
</PRE>
<HR>
</CODE></BLOCKQUOTE>
<P>
<P><B>KASSERT</B>
<P>Есть также макросы KASSERT, KASSERT1, ..., KASSERT9, которые работают так же, как их KDEBUG-аналоги, однако они имеют
дополнительный первый параметр булевского типа. Только если он обращается в ложь, сообщение будет распечатано. 
<P>Примечание 1: вы не должны использовать ни KDEBUG, ни KASSERT до создания объекта KApplication.
<P>Примечание 2: KDebug не предоставляет никаких возможностей интернационализации, поскольку он предназначен только для разработчиков.
Если вы хотите информировать пользователя о нештатной ситуации (например, "этот файл защищен от записи"), используйте 
KMsgBox.
<P><B>Опции компилятора</B>
<P>Вы не должны задавать никаких специальных ключей для компилятора при использовании KDebug. 
Но когда вы распространяете свое приложение (в основном это касается людей, которые создают .rpm или .deb пакеты), вы должны компилировать с ключом
-DNDEBUG. Это просто удалит код дебаггера из вашего приложения и сделает его меньше и быстрее (например, оно будет использовать на 256K меньше
памяти).
<P>
<P><B>Как анализировать диагностические сообщения в процессе выполнения</B>
<P>Вы можете нажать Ctrl-Shift-F12 в любом приложении KDE в любое время, и появится диалог "Debug Settings". В нем вы сможете определить
раздельно для каждого уровня строгости, что должно быть сделано с диагностическими сообщениями этого уровня. Возможны следующие настройки:
<P>
<UL>
<LI>Output: в этом списке вы можете выбрать, куда будут выводиться диагностические сообщения; доступен выбор "File", "Message Box", "Shell" (имеется в виду stderr)
и "syslog". Не направляйте фатальные сообщения в syslog, если вы не системный администратор.
По умолчанию используется "Message Box".</LI>
<LI>File: это поле используется, если вы решили выводить сообщения в файл; здесь указывается имя файла (интерпретируется относительно текущего каталога).
По умолчанию kdebug.dbg.
</LI>
<LI>Area: определяет области, для которых осуществляется вывод. Все сообщения, не упомянутые в них, не будут выведены
(если только это поле не оставлено пустым, что используется по умолчанию и значит вывод всех сообщений). Вы можете ввести несколько областей,
разделенных ",", и вы можете назначить диапазоны областей с синтаксисом "начало-конец". Например, 117,214-289,356-359,221. Не используйте пробелы.</LI>
</UL>
<P>Кроме того, вы можете выбрать опцию "Прерывать на фатальных ошибках" ("Abort on fatal errors"). В этом случае при возникновении диагностического сообщения с уровнем
"KDEBUG_FATAL" приложение завершит работу с кодом SIGABRT после вывода этого сообщения. Когда вы закроете диалог кнопкой OK, ваши
настройки вступят в силу немедленно и сохранятся в конфигурационном файле вашего приложения. Имейте в виду, что эти установки специфичны
для каждого приложения! При нажатии cancel все изменения будут утеряны, и будут возвращены предыдущие установки.
<P>
<P ALIGN="RIGHT">

<A HREF="index-13.html">Next</A>
 <A HREF="index-11.html">Previous</A>
 <A HREF="index.html#toc12">Table of Contents</A>
</P>
<CENTER>
<HR WIDTH="100%" SIZE=3 ALIGN=CENTER NOSHADE>
</CENTER>    
</FONT>

 
</BODY>
</HTML>
