<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Creating a KParts Application</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="Creating and Using Components (KParts)"
HREF="ch12.html"/><LINK
REL="PREVIOUS"
TITLE="Making a Part Available Using Shared Libraries"
HREF="ch12lev1sec6.html"/><LINK
REL="NEXT"
TITLE="Embedding More Than One Part in the Same Window"
HREF="ch12lev1sec8.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch12lev1sec6.html"
>Prev</A
> <A
HREF="ch12lev1sec8.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="ch12lev1sec7"
>12.7. Creating a KParts Application</A
></H1
><P
>If an
			
			 application wants to use parts and the GUI merging feature, its own GUI needs to be defined in XML. The top level windows of the application will then use the class <TT
CLASS="literal"
>KParts::MainWindow</TT
>.</P
><P
>Note that it's also possible to use a part in a standard application, using <TT
CLASS="literal"
>KTMainWindow</TT
>, but then no GUI merging happens. In this case, only the functionality provided by the widget and by the part API are available, so the application has to create the GUI for part's functionality itself, or the part has to provide it through context menus. In any case, it is much less flexible.</P
><P
>As an example of a window based on <TT
CLASS="literal"
>KParts::MainWindow</TT
>, you are going to create a PostScript viewer very easily, by embedding the part provided by KDE's PostScript viewer, KGhostView.</P
><DIV
CLASS="note"
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="note.png"
HSPACE="5"
ALT="Note"/></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>You need to install the package kdegraphics if you want to test this example.</P
></TD
></TR
></TABLE
></DIV
><P
>The first thing to look at is the mainwindow's GUI; an example is given in <A
HREF="ch12lev1sec7.html#ch12list11"
>Listing 12.11</A
>.
			
			
		</P
><DIV
CLASS="example"
><HR/><A
NAME="ch12list11"
></A
><P
><B
>Example 12.11. ghostviewtest_shell.rc: The Mainwindow's GUI
				
				
			</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;&lt;!DOCTYPE kpartgui SYSTEM "kpartgui.dtd"&gt;
   3&nbsp;&lt;kpartgui name="KGVShell" version="1"&gt;
   4&nbsp;&lt;MenuBar&gt;
   5&nbsp; &lt;Menu name="file"&gt;&lt;text&gt;&amp;amp;File&lt;/text&gt;
   6&nbsp;  &lt;Action name="file_open"/&gt;
   7&nbsp;  &lt;Merge/&gt;
   8&nbsp;  &lt;Action name="file_quit"/&gt;
   9&nbsp;&lt;/Menu&gt;
  10&nbsp;&lt;/MenuBar&gt;
  11&nbsp;&lt;ToolBar name="KGV-ToolBar"&gt;&lt;text&gt;KGhostView&lt;/text&gt;
  12&nbsp; &lt;Action name="file_open"/&gt;
  13&nbsp; &lt;Action name="file_quit"/&gt;
  14&nbsp;&lt;/ToolBar&gt;
  15&nbsp;&lt;/kpartgui&gt;
  16&nbsp;				
  17&nbsp;				
  18&nbsp;				
  19&nbsp;				
  20&nbsp;				
  21&nbsp;			</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>By analogy with a command line's shell, a main window is often called a shell. In its GUI you define the actions that will always be shown, whichever part is active. The listing for a simple <TT
CLASS="literal"
>KParts</TT
> mainwindow is shown in <A
HREF="ch12lev1sec7.html#ch12list12"
>Listing 12.12</A
>
			
			
			
		</P
><DIV
CLASS="example"
><HR/><A
NAME="ch12list12"
></A
><P
><B
>Example 12.12. ghostviewtest.h: Header for a Simple KParts Mainwindow
				
				
			</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: #include &lt;kparts/mainwindow.h&gt;
   3&nbsp; 2:
   4&nbsp; 3: class Shell : public KParts::MainWindow
   5&nbsp; 4: {
   6&nbsp; 5:   Q_OBJECT
   7&nbsp; 6: public:
   8&nbsp; 7:   Shell();
   9&nbsp; 8:   virtual ~Shell();
  10&nbsp; 9:
  11&nbsp;10:   void openURL( const KURL &amp; url );
  12&nbsp;11:
  13&nbsp;12: protected slots:
  14&nbsp;13:   void slotFileOpen();
  15&nbsp;14:
  16&nbsp;15: private:
  17&nbsp;16:   KParts::ReadOnlyPart *m_gvpart;
  18&nbsp;17: };
  19&nbsp;				
  20&nbsp;				
  21&nbsp;			</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The mainwindow inherits <TT
CLASS="literal"
>KParts::MainWindow</TT
> instead of <TT
CLASS="literal"
>KTMainWindow</TT
>. Nothing else is required; the <TT
CLASS="literal"
>openURL()</TT
> here is just so that <TT
CLASS="literal"
>main()</TT
> can call <TT
CLASS="literal"
>openURL()</TT
> on the window. The URL could be passed to the constructor instead.
			
			
		</P
><P
>The code for the mainwindow embedding the KGhostView part is part of the KParts examples, which can be found under kdelibs/kparts/tests/ghostview*, so <A
HREF="ch12lev1sec7.html#ch12list13"
>Listing 12.13</A
> only shows the relevant lines of ghostview.cpp.
			
			
		</P
><DIV
CLASS="example"
><HR/><A
NAME="ch12list13"
></A
><P
><B
>Example 12.13. Excerpt of ghostviewtest.cpp: Implementation of the Simple KParts Mainwindow
				
				
			</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: Shell::Shell()
   3&nbsp; 2: {
   4&nbsp; 3:   setXMLFile( "ghostviewtest_shell.rc" );
   5&nbsp; 4:
   6&nbsp; 5:   KAction * paOpen = new KAction( i18n( "&amp;Open file" ), "fileopen", 0,
   7&nbsp; 6:             this, SLOT( slotFileOpen() ), actionCollection(), "file_open" );
   8&nbsp; 7:
   9&nbsp; 8:   KAction * paQuit = new KAction( i18n( "&amp;Quit" ), "exit", 0,
  10&nbsp; 9:             this, SLOT( close() ), actionCollection(), "file_quit" );
  11&nbsp;10:
  12&nbsp;11:   // Try to find libkghostview
  13&nbsp;12:   KLibFactory *factory = KLibLoader::self()-&gt;factory( "libkghostview" );
  14&nbsp;13:   if (factory)
  15&nbsp;14:   {
  16&nbsp;15:     // Create the part
  17&nbsp;16:     m_gvpart = (KParts::ReadOnlyPart *)factory-&gt;create( this, "kgvpart",
  18&nbsp;17:                "KParts::ReadOnlyPart" );
  19&nbsp;18:     // Set the main widget
  20&nbsp;19:     setView( m_gvpart-&gt;widget() );
  21&nbsp;20:     // Integrate its GUI
  22&nbsp;21:     createGUI( m_gvpart );
  23&nbsp;22:   }
  24&nbsp;23:   else
  25&nbsp;24:     kdFatal() &lt;&lt; "No libkghostview found !" &lt;&lt; endl;
  26&nbsp;25: }
  27&nbsp;26:
  28&nbsp;27: Shell::~Shell()
  29&nbsp;28: {
  30&nbsp;29:   delete m_gvpart;
  31&nbsp;30: }
  32&nbsp;31:
  33&nbsp;32: void Shell::openURL( const KURL &amp; url )
  34&nbsp;33: {
  35&nbsp;34:   m_gvpart-&gt;openURL( url );
  36&nbsp;35: }
  37&nbsp;				
  38&nbsp;				
  39&nbsp;				
  40&nbsp;				
  41&nbsp;				
  42&nbsp;			</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>A mainwindow is created much like a part, with an XML file and actions. To find a part, it uses <TT
CLASS="literal"
>KLibLoader</TT
> to get the KLibFactory for the library. A flexible application would use .desktop files for this and KIO's trader for selecting the user's preferred component, but for the sake of simplicity, open the library by its name here. After the factory has been created, the mainwindow makes it create a <TT
CLASS="literal"
>ReadOnlyPart</TT
>, and because here you have only one part in the window, the part's widget is set as the main widget of the window with <TT
CLASS="literal"
>setView</TT
>. Then a mainwindow needs to call
			
			<TT
CLASS="literal"
>createGUI()</TT
> to make the framework create the GUI, merging the actions of the mainwindow with those of the active part. A mainwindow with no part will simply call <TT
CLASS="literal"
>createGUI(0L)</TT
>.</P
><P
>Using this mainwindow, for instance from <TT
CLASS="literal"
>main()</TT
>, is as simple as</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;Shell *shell = new Shell;
   3&nbsp;shell-&gt;openURL( url );
   4&nbsp;shell-&gt;show();
   5&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>Compile kdelibs/kparts/tests/ghostviewtest to test this simple example of how to embed a part.</P
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch12lev1sec7"/></TD
></TR
><ANNOTATION
NAME="ch12lev1sec7"
TITLE="Creating a KParts Application"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch12lev1sec6.html"
>Prev</A
> <A
HREF="ch12lev1sec8.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>