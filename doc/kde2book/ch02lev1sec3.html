<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>KDE Application Structure</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="A Simple KDE Application"
HREF="ch02.html"/><LINK
REL="PREVIOUS"
TITLE="Compiling a KDE Program"
HREF="ch02lev1sec2.html"/><LINK
REL="NEXT"
TITLE="GUI Elements"
HREF="ch02lev1sec4.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch02lev1sec2.html"
>Prev</A
> <A
HREF="ch02lev1sec4.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="ch02lev1sec3"
>2.3. KDE Application Structure</A
></H1
><P
>The structure of a typical KDE application is shown in <A
HREF="ch02lev1sec3.html#ch02fig03"
>Figure 2.3</A
>. <TT
CLASS="literal"
>KApplication</TT
> is a class that provides low-level KDE application services, and <TT
CLASS="literal"
>KTMainWindow</TT
> serves as a programmer-friendly base class for your main application window, <TT
CLASS="literal"
>KMyMainWindow</TT
>. The classes <TT
CLASS="literal"
>KMenuBar</TT
>, <TT
CLASS="literal"
>KToolBar</TT
>, and <TT
CLASS="literal"
>KStatusBar</TT
> are created, positioned, and resized by <TT
CLASS="literal"
>KTMainWindow</TT
>, but you customize them from within <TT
CLASS="literal"
>KMyMainWindow</TT
>. Many possibilities exist for the form of <TT
CLASS="literal"
>KMyContent</TT
>. This widget is positioned and resized by <TT
CLASS="literal"
>KTMainWindow</TT
> and otherwise maintained by <TT
CLASS="literal"
>KMyMainWindow</TT
>. All these widgets ultimately interact with the user through the class <TT
CLASS="literal"
>KApplication</TT
>. <TT
CLASS="literal"
>KApplication</TT
> dispatches event messages that signal, for example, keypresses or mouse clicks to all the widgets used by an application.</P
><DIV
CLASS="figure"
><HR/><A
NAME="ch02fig03"
></A
><P
><B
>Figure 2.3. You derive your application from <TT
CLASS="literal"
>KTMainWindow</TT
>, shown here as KMyMainWindow, and add a menubar, a toolbar, a status line, and a widget of your choice (or creation) for the content area.</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="graphics/02fig03.gif"
></IMG
></P
></DIV
><HR/></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch02lev2sec4"
>2.3.1. <TT
CLASS="literal"
>KApplication</TT
></A
></H2
><P
><TT
CLASS="literal"
>KApplication</TT
> receives messages from X, the underlying windowing system, and distributes them to the widgets in your application. It gives access to fonts, desktop style options, and processes some KDE-standard command line options. It also provides access to the session-management features of KWin, although you generally do not need to use these because <TT
CLASS="literal"
>KTMainWindow</TT
> offers a higher-level session management API.</P
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch02lev2sec4"/></TD
></TR
><ANNOTATION
NAME="ch02lev2sec4"
TITLE="KApplication"/></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch02lev2sec5"
>2.3.2. <TT
CLASS="literal"
>KTMainWindow</TT
></A
></H2
><P
>Listings 2.3&#8211;2.5 present a simple KDE application: KSimpleApp.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch02list03"
></A
><P
><B
>Example 2.3. ksimpleapp.h: The Class Declaration File for <TT
CLASS="literal"
>KSimpleApp</TT
>, the Main Widget of the Application <TT
CLASS="literal"
>ksimpleapp</TT
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: #include &lt;ktmainwindow.h&gt;
   3&nbsp; 2:
   4&nbsp; 3: class QLabel;
   5&nbsp; 4:
   6&nbsp; 5: /**
   7&nbsp; 6:  * This is a simple KDE application.
   8&nbsp; 7:  *
   9&nbsp; 8:  * @author David Sweet &lt;dsweet@kde.org&gt;
  10&nbsp; 9:  **/
  11&nbsp;10: class KSimpleApp : public KTMainWindow
  12&nbsp;11: {
  13&nbsp;12:  Q_OBJECT
  14&nbsp;13:
  15&nbsp;14:  public:
  16&nbsp;15:   /**
  17&nbsp;16:    * Create the widget.
  18&nbsp;17:    **/
  19&nbsp;18:   KSimpleApp (const char *name=0);
  20&nbsp;19:
  21&nbsp;20:   public slots:
  22&nbsp;21:     /**
  23&nbsp;22:      * Reposition the text in the context area.  The user will
  24&nbsp;23:      *  cycle through:  left, center, and right.
  25&nbsp;24:      **/
  26&nbsp;25:     void slotRepositionText();
  27&nbsp;26:
  28&nbsp;27:  private:
  29&nbsp;28:   QLabel *text;
  30&nbsp;29:   int alignment [3], indexalignment;
  31&nbsp;30: };</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The file ksimpleapp.h contains the class declaration for the class <TT
CLASS="literal"
>KSimpleApp</TT
>. This class is the equivalent of <TT
CLASS="literal"
>KMyMainWindow</TT
> in <A
HREF="ch02lev1sec3.html#ch02fig03"
>Figure 2.3</A
> and thus is derived from <TT
CLASS="literal"
>KTMainWindow</TT
>.</P
><P
>The <TT
CLASS="literal"
>KSimpleApp</TT
> widget shows how to use <TT
CLASS="literal"
>KTMainWindow</TT
> to create a document-centric application. A document-centric application contains a menubar, a toolbar, a statusbar, and a content area. These elements can be seen in <A
HREF="ch02lev1sec3.html#ch02fig04"
>Figure 2.4</A
>, which shows a screen shot of KWrite, a text-editing utility included with KDE. KWrite is an example of a document-centric application.</P
><DIV
CLASS="figure"
><HR/><A
NAME="ch02fig04"
></A
><P
><B
>Figure 2.4. KWrite offers a prototype KDE-style, document-centric application.</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="graphics/02fig04.gif"
></IMG
></P
></DIV
><HR/></DIV
><P
>The content area in this case contains the document being edited. In general, the content area contains a view of the document being worked on, but the concept of <SPAN
CLASS="QUOTE"
>"document"</SPAN
> is extended to include images, Web pages, scientific plots, file-manager views, or whatever data the application deals with.</P
><P
>The menubar, toolbar, and statusbar widgets are created, positioned, and deleted by <TT
CLASS="literal"
>KTMainWindow</TT
>. The menubar contains the familiar File, Edit, and other pull-down menu headings. The toolbar shows icon buttons that provide quick access to frequently used menu entries. The statusbar displays short messages and state indicators that let the user know what tasks the application is performing and that give extended information about UI objects or document elements.</P
><P
><TT
CLASS="literal"
>KTMainWindow</TT
> also implements basic session management. The session manager, as implemented by KWin saves the state of the desktop when the user logs out, and it re-creates it at the next login. This means that each application that was running at logout should be restarted in a window that has the same position and size and that contains the document that was being edited. <TT
CLASS="literal"
>KTMainWindow</TT
> takes care of positioning and sizing your application's window when <TT
CLASS="literal"
>kwm</TT
> restores it. You will see in <A
HREF="ch07.html"
>Chapter 7, <SPAN
CLASS="QUOTE"
>"Further KDE Compliance,"</SPAN
></A
> how to save additional information such as the contents of the document that was being edited when the user logged out.</P
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch02lev2sec5"/></TD
></TR
><ANNOTATION
NAME="ch02lev2sec5"
TITLE="KTMainWindow"/></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch02lev2sec6"
>2.3.3. A Typical <TT
CLASS="literal"
>main()</TT
> Function</A
></H2
><P
><A
HREF="ch02lev1sec3.html#ch02list04"
>Listing 2.4</A
> contains a <TT
CLASS="literal"
>main()</TT
> function that is typical for a KDE application. It is short because the real work is done in the class you derive from <TT
CLASS="literal"
>KTMainWindow</TT
> (<TT
CLASS="literal"
>KSimpleApp</TT
> in this case). It creates an instance of <TT
CLASS="literal"
>KApplication</TT
>, an instance of <TT
CLASS="literal"
>KSimpleApp</TT
>, and it passes control to the instance <TT
CLASS="literal"
>KApplication</TT
>.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch02list04"
></A
><P
><B
>Example 2.4. main.cpp: The <TT
CLASS="literal"
>main()</TT
> Function for <TT
CLASS="literal"
>KSimpleApp</TT
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: #include &lt;kapp.h&gt;
   3&nbsp; 2:
   4&nbsp; 3: #include "ksimpleapp.h"
   5&nbsp; 4:
   6&nbsp; 5: int
   7&nbsp; 6: main (int argc, char *argv[])
   8&nbsp; 7: {
   9&nbsp; 8:   KApplication kapplication (argc, argv, "ksimpleapp");
  10&nbsp; 9:
  11&nbsp;10:   if (kapplication.isRestored())
  12&nbsp;11:       RESTORE(KSimpleApp)
  13&nbsp;12:   else
  14&nbsp;13:   {
  15&nbsp;14:     KSimpleApp *ksimpleapp = new KSimpleApp;
  16&nbsp;15:     ksimpleapp-&gt;show();
  17&nbsp;16:   }
  18&nbsp;17:
  19&nbsp;18:   return kapplication.exec();
  20&nbsp;19: }</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The <TT
CLASS="literal"
>KApplication</TT
> constructor needs <TT
CLASS="literal"
>argc</TT
> and <TT
CLASS="literal"
>argv</TT
> so that it can process command-line options. <A
HREF="ch02lev1sec3.html#ch02table01"
>Table 2.1</A
> is a list of options that are processed by all KDE applications and removed from <TT
CLASS="literal"
>argc</TT
>/<TT
CLASS="literal"
>argv</TT
> after the constructor is called:</P
><DIV
CLASS="table"
><HR/><A
NAME="ch02table01"
></A
><P
><B
>Table 2.1. Options Processed by All KDE Applications</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><THEAD
><TR
><TH
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
><I
CLASS="emphasis"
>Option</I
></TH
><TH
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
><I
CLASS="emphasis"
>Action</I
></TH
></TR
></THEAD
><TBODY
><TR
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="literal"
>caption</TT
> <I
CLASS="emphasis"
><TT
CLASS="literal"
>caption_name</TT
></I
></TD
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
>Tells <TT
CLASS="literal"
>KApplication</TT
> to use <I
CLASS="emphasis"
><TT
CLASS="literal"
>caption_name</TT
></I
> as the titlebar text.</TD
></TR
><TR
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="literal"
>icon</TT
> <I
CLASS="emphasis"
><TT
CLASS="literal"
>icon_name</TT
></I
></TD
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
>Specifies which file to use as the application icon.</TD
></TR
><TR
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="literal"
>miniicon</TT
> <I
CLASS="emphasis"
><TT
CLASS="literal"
>miniicon_name</TT
></I
></TD
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
>Specifies which file to use as the application miniicon. This icon is placed in the upper-left corner of the application window.</TD
></TR
><TR
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
><TT
CLASS="literal"
>restore</TT
></TD
><TD
WIDTH="50%"
ALIGN="LEFT"
VALIGN="TOP"
>Indicates that the application has been started by the session manager.</TD
></TR
></TBODY
></TABLE
><HR/></DIV
><P
>You may process the remaining command-line options however you want.</P
><P
>The last option to the <TT
CLASS="literal"
>KApplication</TT
> constructor is the name of the application. This name serves as the default caption as well as the name of the icon and of the miniicon. In this case, as is generally the case, no icon or miniicon name was specified in the command line. This causes <TT
CLASS="literal"
>KApplication</TT
> to look for the default icon file for this application, ksimpleapp.png, (.png is used to denote files Portable Network Graphics (PNG) format) in the standard icon and miniicon directories. Of course, in this example you have not created an icon file for the KSimpleApp, so the file will not be found and a generic icon will be used instead. (The standard locations of icons and other resources are discussed in <A
HREF="ch16.html"
>Chapter 16</A
>.)</P
><P
>If your application has been started by the session manager, <TT
CLASS="literal"
>KApplication::isRestored()</TT
>, as used on line 9 of <A
HREF="ch02lev1sec3.html#ch02list04"
>Listing 2.4</A
>, will return <TT
CLASS="literal"
>true</TT
>. In this case, use the <TT
CLASS="literal"
>RESTORE</TT
> macro, defined in ktmainwindow.h, to create <TT
CLASS="literal"
>KSimpleApp</TT
>. Creating <TT
CLASS="literal"
>KSimpleApp</TT
> in this way will place the window, the menubar and the toolbars where the user left them at logout. (Note that the menubar and toolbars can be positioned by the user. Try right-clicking the textured vertical bar to the left of the menubar. You are offered the following options for positioning the menubar: <TT
CLASS="literal"
>Left</TT
>, <TT
CLASS="literal"
>Top</TT
>, <TT
CLASS="literal"
>Right</TT
>, <TT
CLASS="literal"
>Bottom</TT
>, <TT
CLASS="literal"
>Float</TT
>, and <TT
CLASS="literal"
>Flat</TT
>.)</P
><P
>If your application was started normally&#8212;that is, by the user and not by the session manager&#8212; you create a new instance of <TT
CLASS="literal"
>KSimpleApp</TT
> and make it visible with</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;KSimpleApp *ksimpleapp = new KSimpleApp;
   3&nbsp;ksimpleapp-&gt;show();
   4&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The <TT
CLASS="literal"
>show()</TT
> method does not actually show the window. The window will be shown after you enter the event loop with</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;kapplication-&gt;exec();
   3&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>In this method, all the events received from X, such as window move, resize, paint events, mouse-move events, button-press events, and keypress events will be dispatched to the appropriate KDE/Qt widget classes. This loop exits when the last window is closed. At this time, your program should not expect to have a user interface and should terminate.</P
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch02lev2sec6"/></TD
></TR
><ANNOTATION
NAME="ch02lev2sec6"
TITLE="A Typical main() Function"/></TABLE
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch02lev1sec3"/></TD
></TR
><ANNOTATION
NAME="ch02lev1sec3"
TITLE="KDE Application Structure"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch02lev1sec2.html"
>Prev</A
> <A
HREF="ch02lev1sec4.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>