<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Compiling a KDE Program</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="A Simple KDE Application"
HREF="ch02.html"/><LINK
REL="PREVIOUS"
TITLE="A Simple KDE Application"
HREF="ch02.html"/><LINK
REL="NEXT"
TITLE="KDE Application Structure"
HREF="ch02lev1sec3.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch02.html"
>Prev</A
> <A
HREF="ch02lev1sec3.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="ch02lev1sec2"
>2.2. Compiling a KDE Program</A
></H1
><P
>I am discussing compiling early on so that you may begin programming immediately. I hope that you will key in the source code that is presented, compile it, and play with it as you read. (You can also download the source code from the web site, but typing it in yourself will help familiarize you with class names and conventions that you may miss even in a careful reading.) The concepts that are presented will be clearer to you if you are programming them while you read.</P
><P
>The source code presented in <A
HREF="ch02lev1sec2.html#ch02list01"
>Listing 2.1</A
> is an example of a C++ program that depends on the KDE and Qt libraries. <TT
CLASS="literal"
>khello</TT
> is a simple application that says <SPAN
CLASS="QUOTE"
>"Hello!"</SPAN
></P
><DIV
CLASS="example"
><HR/><A
NAME="ch02list01"
></A
><P
><B
>Example 2.1. <TT
CLASS="literal"
>khello</TT
> is a Simple KDE Application that Says <SPAN
CLASS="QUOTE"
>"Hello!"</SPAN
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: #include &lt;qstring.h&gt;
   3&nbsp; 2: #include &lt;kapp.h&gt;
   4&nbsp; 3: #include &lt;klined.h&gt;
   5&nbsp; 4:
   6&nbsp; 5: int main (int argc, char *argv[])
   7&nbsp; 6: {
   8&nbsp; 7: KApplication khello (argc, argv, "khello");
   9&nbsp; 8: KLineEdit *helloeditor = new KLineEdit (0);
  10&nbsp; 9: QString hellostring ("Hello!");
  11&nbsp;10: helloeditor-&gt;setText (hellostring);
  12&nbsp;11: helloeditor-&gt;show();
  13&nbsp;12:
  14&nbsp;13: khello.setMainWidget (helloeditor);
  15&nbsp;14: return khello.exec();</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>To compile this code, you first need to set the environment variables <TT
CLASS="literal"
>KDEDIR</TT
> and <TT
CLASS="literal"
>QTDIR</TT
>. <TT
CLASS="literal"
>KDEDIR</TT
> should be set to the path where KDE was installed. This is usually /opt/kde, but it is /usr on a Red Hat 6.x system. <TT
CLASS="literal"
>QTDIR</TT
> may be /usr/local/lib, /usr/lib, or some other directory. The command to set environment variables differs from shell to shell. If you are using <TT
CLASS="literal"
>bash</TT
>, for example, type</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;<I
CLASS="emphasis"
>QTDIR=/usr/local/lib</I
>
   3&nbsp;<I
CLASS="emphasis"
>KDEDIR=/opt/kde</I
></PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>If you are using <TT
CLASS="literal"
>tcsh</TT
>, type</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;<I
CLASS="emphasis"
>setenv QTDIR /usr/local/lib</I
>
   3&nbsp;<I
CLASS="emphasis"
>setenv KDEDIR /opt/kde</I
>
   4&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>On typical systems, the command to compile the source code given in <A
HREF="ch02lev1sec2.html#ch02list01"
>Listing 2.1</A
> is</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;<I
CLASS="emphasis"
>g++  khello.cpp -I$KDEDIR/include -I$QTDIR/include</I
>
   3&nbsp;·      <I
CLASS="emphasis"
>L$KDEDIR/lib -L$QTDIR/lib -lkdeui -lkdecore -ldl -lqt</I
>
   4&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>On a Red Hat 6.x system, the Qt header files are in /usr/include/qt, and the libraries are in /usr/lib, which is checked by g++ by default. You should compile the program using the following command on a Red Hat 6.x system:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;<I
CLASS="emphasis"
>g++  khello.cpp -I$KDEDIR/include</I
>
   3&nbsp;·       <I
CLASS="emphasis"
>I/usr/include/qt -L$KDEDIR/lib -lkdeui -lkdecore -ldl -lqt</I
>
   4&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The compiler is the GNU C++ compiler, g++. khello.cpp is the name of the source-code file. <A
HREF="ch02lev1sec2.html#ch02list01"
>Listing 2.1</A
> shows that khello.cpp includes header files from the Qt (qlabel.h) and KDE (kapp.h and klined.h) library distributions.</P
><P
>The <TT
CLASS="literal"
>-I</TT
> option tells g++ in what directory to look for header files. The <TT
CLASS="literal"
>-L</TT
> option tells where, in addition to standard directories, to look for libraries.</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;<I
CLASS="emphasis"
>g++  khello.cpp -I$KDEDIR/include -I$QTDIR/include</I
>
   3&nbsp;       <I
CLASS="emphasis"
>L$KDEDIR/lib -L$QTDIR/lib -lkdecore &#8211;lkdeui</I
>
   4&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>khello uses classes from the Qt library and from the KDE libraries libkdecore and libkdeui. The <TT
CLASS="literal"
>-l</TT
> option specifies which libraries (in addition to default libraries, such as libc) to link to khello.</P
><P
>khello is shown in <A
HREF="ch02lev1sec2.html#ch02fig02"
>Figure 2.2</A
>. Its window contains only a line editor with the text <SPAN
CLASS="QUOTE"
>"Hello!"</SPAN
> in it. You can edit the text and click the close button (the X in the upper-right corner of the window) when you are through.</P
><DIV
CLASS="figure"
><HR/><A
NAME="ch02fig02"
></A
><P
><B
>Figure 2.2. khello is a simple KDE application that says <SPAN
CLASS="QUOTE"
>"Hello!"</SPAN
></B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="graphics/02fig02.gif"
></IMG
></P
></DIV
><HR/></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch02lev2sec3"
>2.2.1. Using <TT
CLASS="literal"
>make</TT
></A
></H2
><P
>The development process usually consists of the following steps:</P
><OL
COMPACT="COMPACT"
TYPE="1"
><LI
><P
>Edit the source code.</P
></LI
><LI
><P
>Compile it.</P
></LI
><LI
><P
>Test the program.</P
></LI
></OL
><P
>To minimize the overhead involved in compilation&#8212;especially on large projects&#8212;you can use the <TT
CLASS="literal"
>make</TT
> utility. <TT
CLASS="literal"
>make</TT
> will</P
><UL
COMPACT="COMPACT"
><LI
STYLE="list-style-type: disc"
><P
>Execute compilation commands, which can often be much longer than the one presented previously.</P
></LI
><LI
STYLE="list-style-type: disc"
><P
>Compile only the files that need recompiling. This can save a lot of time when a project consists of more than one file.</P
></LI
></UL
><P
>By examining source files, <TT
CLASS="literal"
>make</TT
> determines which files need recompiling; it checks whether the source files are newer than the object files that they get compiled to and whether the file depends on other files (such as header files) that have been updated. The drawback to using <TT
CLASS="literal"
>make</TT
> is that it takes time to describe how the files in your project depend on each other. To see why this is necessary, consider a project that has a source file called mysource.cpp, which <TT
CLASS="literal"
>#includes</TT
> a header called myheader.h. If you change mysource.cpp, you want it to be recompiled the next time you execute <TT
CLASS="literal"
>make</TT
>. You also want it recompiled if you make any changes to myheader.h, because ultimately, myheader.h becomes part of mysource.cpp. You will see in <A
HREF="ch16.html"
>Chapter 16, <SPAN
CLASS="QUOTE"
>"Packaging and Distributing Code,"</SPAN
></A
> how the standard KDE packaging automates the process of creating a <TT
CLASS="literal"
>Makefile</TT
>.</P
><P
>Listing 2.2 gives the <TT
CLASS="literal"
>Makefile</TT
> used for compiling Listings 2.3&#8211;2.5. This listings are the source code KSimpleApp, a simple KDE application. You should place all four of these files in the same directory and type <I
CLASS="emphasis"
><TT
CLASS="literal"
>make</TT
></I
> to compile the code and create an executable named <TT
CLASS="literal"
>ksimpleapp</TT
>. When keying in the <TT
CLASS="literal"
>Makefile</TT
>, you need to set the variables <TT
CLASS="literal"
>QTINC</TT
>, <TT
CLASS="literal"
>KDEINC</TT
>, <TT
CLASS="literal"
>QTLIB</TT
>, and <TT
CLASS="literal"
>KDELIB</TT
> to their correct values. Sample assignments of these variables are given in <A
HREF="ch02lev1sec2.html#ch02list02"
>Listing 2.2</A
>, lines 1&#8211;4.Variable assignment in makefiles works the same as you might have guessed from looking at <A
HREF="ch02lev1sec2.html#ch02list02"
>Listing 2.2</A
>:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;VARIABLE = <I
CLASS="emphasis"
>value</I
>
   3&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>For more information about <TT
CLASS="literal"
>make</TT
>, see the man page (i.e., type <I
CLASS="emphasis"
><TT
CLASS="literal"
>man make</TT
></I
>).</P
><P
>From this point in the book, I won't present any more <TT
CLASS="literal"
>Makefiles</TT
>. You can adapt this <TT
CLASS="literal"
>Makefile</TT
> to compile later source code, or find prepared <TT
CLASS="literal"
>Makefiles</TT
> with the source code on the World Wide Web support site.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch02list02"
></A
><P
><B
>Example 2.2. The <TT
CLASS="literal"
>Makefile</TT
> Used as Input to the <TT
CLASS="literal"
>make</TT
> Utility to Compile Listings 2.3&#8211;2.5</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: QTINC = -I$(QTDIR)/include
   3&nbsp; 2: KDEINC = -I$(KDEDIR)/include
   4&nbsp; 3: QTLIB = -L$(QTDIR)/lib
   5&nbsp; 4: KDELIB = -L$(KDEDIR)/lib
   6&nbsp; 5: QTBIN = $(QTDIR)/bin
   7&nbsp; 6:
   8&nbsp; 7:  ksimpleapp : ksimpleapp.o main.o
   9&nbsp; 8:     g++ $(QTLIB) $(KDELIB) -lkdeui -lkdecore -lqt -ldl \
  10&nbsp;         main.o ksimpleapp.o -o ksimpleapp
  11&nbsp; 9:
  12&nbsp;10:  main.o : main.cpp
  13&nbsp;11:    g++ -c $(QTINC) $(KDEINC) main.cpp
  14&nbsp;12:
  15&nbsp;13:  ksimpleapp.moc : ksimpleapp.h
  16&nbsp;14:  $(QTBIN)/moc ksimpleapp.h &gt; ksimpleapp.moc
  17&nbsp;15:
  18&nbsp;16:  ksimpleapp.o : ksimpleapp.cpp ksimpleapp.moc
  19&nbsp;17:    g++ -c $(QTINC) $(KDEINC) ksimpleapp.cpp</PRE
></TD
></TR
></TABLE
><HR/></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch02lev2sec3"/></TD
></TR
><ANNOTATION
NAME="ch02lev2sec3"
TITLE="Using make"/></TABLE
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch02lev1sec2"/></TD
></TR
><ANNOTATION
NAME="ch02lev1sec2"
TITLE="Compiling a KDE Program"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch02.html"
>Prev</A
> <A
HREF="ch02lev1sec3.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>