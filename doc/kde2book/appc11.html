<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Chapter 7</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="Answers"
HREF="ap-c.html"/><LINK
REL="PREVIOUS"
TITLE="Chapter 6"
HREF="appc9.html"/><LINK
REL="NEXT"
TITLE="Chapter 8"
HREF="appc13.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="appc9.html"
>Prev</A
> <A
HREF="appc13.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="appC11"
>C.7. <A
HREF="ch07.html"
>Chapter 7</A
></A
></H1
><P
></P
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="appC12"
>C.7.1. Exercises</A
></H2
><DIV
CLASS="qandaset"
><DL
><DT
>C.7.1.1. <A
HREF="appc11.html#AEN28123"
>Starting with <TT
CLASS="literal"
>KDropDemo</TT
> as a base, write a program that accepts drops of images. Use <TT
CLASS="literal"
>QImageObject</TT
> instead of <TT
CLASS="literal"
>QTextObject</TT
>.</A
></DT
><DT
>C.7.1.2. <A
HREF="appc11.html#AEN28136"
>Now, using <TT
CLASS="literal"
>KDragDemo</TT
> as a base, write a program that lets the user drag a pixmap to another application. You can use a <TT
CLASS="literal"
>QPixmap</TT
> returned by <TT
CLASS="literal"
>BarIcon()</TT
> as the data for the drag.</A
></DT
><DT
>C.7.1.3. <A
HREF="appc11.html#AEN28154"
>Look up <TT
CLASS="literal"
>KAudio</TT
> in the KDE class documentation. Using <TT
CLASS="literal"
>KStandardDirs</TT
> and <TT
CLASS="literal"
>KAudio</TT
>, locate and play one of the sounds distributed with KDE. (The sounds are in $KDEDIR/share/sounds.) See Listings C.23&#8211;C.25.</A
></DT
></DL
><DIV
CLASS="qandaentry"
><DIV
CLASS="question"
><P
><A
NAME="AEN28123"
></A
><B
>C.7.1.1. </B
>Starting with <TT
CLASS="literal"
>KDropDemo</TT
> as a base, write a program that accepts drops of images. Use <TT
CLASS="literal"
>QImageObject</TT
> instead of <TT
CLASS="literal"
>QTextObject</TT
>.</P
></DIV
><DIV
CLASS="answer"
><P
><B
> </B
><A
HREF="ch07lev1sec7.html#ch07que01"
>Only kdropdemo.cpp was modified. See <A
HREF="appc11.html#ap-clist20"
>Listing C.20</A
></A
>.</P
><DIV
CLASS="example"
><HR/><A
NAME="ap-clist20"
></A
><P
><B
>Example C.20. Modified kdropdemo.cpp</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;#include &lt;qdragobject.h&gt;
   3&nbsp;
   4&nbsp;#include "kdropdemo.h"
   5&nbsp;
   6&nbsp;KDropDemo::KDropDemo (QWidget *parent, const char *name) :
   7&nbsp;  QLabel (parent, name)
   8&nbsp;{
   9&nbsp;  setAcceptDrops(true);
  10&nbsp;
  11&nbsp;  //Chapter 7, Exercise 1
  12&nbsp;  setAlignment (AlignCenter);
  13&nbsp;  setText ("Drop\nan\n     image     \non\n me!");
  14&nbsp;}
  15&nbsp;
  16&nbsp;void
  17&nbsp;KDropDemo::dragEnterEvent (QDragEnterEvent *qdragenterevent)
  18&nbsp;{
  19&nbsp;  //Chapter 7, Exercise 1
  20&nbsp;  qdragenterevent-&gt;accept (QImageDrag::canDecode (qdragenterevent));
  21&nbsp;}
  22&nbsp;
  23&nbsp;void
  24&nbsp;KDropDemo::dropEvent (QDropEvent *qdropevent)
  25&nbsp;{
  26&nbsp;  //Chapter 7, Exercise 1
  27&nbsp;  QPixmap qpixmap;
  28&nbsp;
  29&nbsp;  if (QImageDrag::decode (qdropevent, qpixmap))
  30&nbsp;    {
  31&nbsp;      setPixmap (qpixmap);
  32&nbsp;    }
  33&nbsp;}
  34&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
></DIV
></DIV
><DIV
CLASS="qandaentry"
><DIV
CLASS="question"
><P
><A
NAME="AEN28136"
></A
><B
>C.7.1.2. </B
>Now, using <TT
CLASS="literal"
>KDragDemo</TT
> as a base, write a program that lets the user drag a pixmap to another application. You can use a <TT
CLASS="literal"
>QPixmap</TT
> returned by <TT
CLASS="literal"
>BarIcon()</TT
> as the data for the drag.</P
></DIV
><DIV
CLASS="answer"
><P
><B
> </B
><A
HREF="ch07lev1sec7.html#ch07que02"
>kdragdemo.h and kdragdemo.cpp were modified (see <A
HREF="appc11.html#ap-clist21"
>Listings C.21</A
> and <A
HREF="appc11.html#ap-clist22"
>C.22</A
>). You can use main.cpp, given in <A
HREF="ch07.html#ch07list03"
>Listing 7.3</A
></A
>.</P
><DIV
CLASS="example"
><HR/><A
NAME="ap-clist21"
></A
><P
><B
>Example C.21. Modified kdragdemo.h</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;#ifndef __KDRAGDEMO_H__
   3&nbsp;#define __KDRAGDEMO_H__
   4&nbsp;
   5&nbsp;
   6&nbsp;#include &lt;qlabel.h&gt;
   7&nbsp;
   8&nbsp;//Chapter 7, Exercise 2
   9&nbsp;class QImage;
  10&nbsp;
  11&nbsp;/**
  12&nbsp; * KDragDemo
  13&nbsp; *
  14&nbsp; **/
  15&nbsp;class KDragDemo : public QLabel
  16&nbsp;{
  17&nbsp; public:
  18&nbsp;  KDragDemo (QWidget *parent, const char *name=0);
  19&nbsp;
  20&nbsp; protected:
  21&nbsp;  bool dragging;
  22&nbsp;  //Chapter 7, Exercise 2
  23&nbsp;  QImage *qimage;
  24&nbsp;
  25&nbsp;  void mouseMoveEvent (QMouseEvent *qmouseevent);
  26&nbsp;  void mouseReleaseEvent (QMouseEvent *qmouseevent);
  27&nbsp;};
  28&nbsp;
  29&nbsp;#endif
  30&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><DIV
CLASS="example"
><HR/><A
NAME="ap-clist22"
></A
><P
><B
>Example C.22. Modified kdragdemo.cpp</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;#include &lt;qdragobject.h&gt;
   3&nbsp;#include &lt;qimage.h&gt;
   4&nbsp;
   5&nbsp;#include &lt;kiconloader.h&gt;
   6&nbsp;#include "kdragdemo.h"
   7&nbsp;
   8&nbsp;KDragDemo::KDragDemo (QWidget *parent, const char *name) :
   9&nbsp;  QLabel (parent, name)
  10&nbsp;{
  11&nbsp;  dragging = false;
  12&nbsp;
  13&nbsp;//Chapter 7, Exercise 2
  14&nbsp;  QPixmap qpixmap;
  15&nbsp;  qpixmap = BarIcon ("exit");
  16&nbsp;  setPixmap (qpixmap);
  17&nbsp;
  18&nbsp;  qimage = new QImage;
  19&nbsp;  *qimage = qpixmap;
  20&nbsp;
  21&nbsp;}
  22&nbsp;
  23&nbsp;
  24&nbsp;void
  25&nbsp;KDragDemo::mouseMoveEvent (QMouseEvent *qmouseevent)
  26&nbsp;{
  27&nbsp;  if (!dragging &amp;&amp;qmouseevent-&gt;state() == Qt::LeftButton)
  28&nbsp;    {
  29&nbsp;      dragging = true;
  30&nbsp;//Chapter 7, Exercise 2
  31&nbsp;      QImageDrag *qimagedrag = new QImageDrag (*qimage, this);
  32&nbsp;      qimagedrag-&gt;dragCopy();
  33&nbsp;    }
  34&nbsp;}
  35&nbsp;
  36&nbsp;void
  37&nbsp;KDragDemo::mouseReleaseEvent (QMouseEvent *)
  38&nbsp;{
  39&nbsp;  dragging = false;
  40&nbsp;}
  41&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
></DIV
></DIV
><DIV
CLASS="qandaentry"
><DIV
CLASS="question"
><P
><A
NAME="AEN28154"
></A
><B
>C.7.1.3. </B
>Look up <TT
CLASS="literal"
>KAudio</TT
> in the KDE class documentation. Using <TT
CLASS="literal"
>KStandardDirs</TT
> and <TT
CLASS="literal"
>KAudio</TT
>, locate and play one of the sounds distributed with KDE. (The sounds are in $KDEDIR/share/sounds.) See Listings C.23&#8211;C.25.</P
></DIV
><DIV
CLASS="answer"
><P
><B
> </B
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;#ifndef __KPLAYSOUND_H__
   3&nbsp;#define __KPLAYSOUND_H__
   4&nbsp;
   5&nbsp;
   6&nbsp;#include &lt;qlabel.h&gt;
   7&nbsp;
   8&nbsp;class KAudio;
   9&nbsp;
  10&nbsp;/**
  11&nbsp; * KPlaySound
  12&nbsp; *
  13&nbsp; **/
  14&nbsp;class KPlaySound : public QLabel
  15&nbsp;{
  16&nbsp; Q_OBJECT
  17&nbsp;
  18&nbsp; public:
  19&nbsp;  KPlaySound (QWidget *parent, const char *name=0);
  20&nbsp;
  21&nbsp; protected slots:
  22&nbsp;   /**
  23&nbsp;    * The sound is done playing.
  24&nbsp;    **/
  25&nbsp;   void slotPlayFinished();
  26&nbsp; protected:
  27&nbsp;   KAudio *kaudio;
  28&nbsp;};
  29&nbsp;
  30&nbsp;#endif
  31&nbsp;</PRE
></TD
></TR
></TABLE
></P
><DIV
CLASS="example"
><HR/><A
NAME="ap-clist24"
></A
><P
><B
>Example C.24. kplaysound.cpp</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;#include &lt;kaudio.h&gt;
   3&nbsp;#include &lt;kstddirs.h&gt;
   4&nbsp;
   5&nbsp;#include "kplaysound.moc"
   6&nbsp;
   7&nbsp;
   8&nbsp;KPlaySound::KPlaySound (QWidget *parent, const char *name) :
   9&nbsp;  QLabel (parent, name)
  10&nbsp;{
  11&nbsp;
  12&nbsp;  kaudio = new KAudio;
  13&nbsp;  connect ( kaudio, SIGNAL (playFinished()),
  14&nbsp;            this, SLOT (slotPlayFinished()) );
  15&nbsp;
  16&nbsp;  KStandardDirs *dirs = KGlobal::dirs();
  17&nbsp;
  18&nbsp;  QString soundpath;
  19&nbsp;  soundpath = dirs-&gt;findResource ("sound", "KDE_Startup.wav");
  20&nbsp;
  21&nbsp;  kaudio-&gt;play (soundpath);
  22&nbsp;}
  23&nbsp;
  24&nbsp;void
  25&nbsp;KPlaySound::slotPlayFinished()
  26&nbsp;{
  27&nbsp;  //playing has finished
  28&nbsp;}
  29&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><DIV
CLASS="example"
><HR/><A
NAME="ap-clist25"
></A
><P
><B
>Example C.25. main.cpp</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;#include &lt;kapp.h&gt;
   3&nbsp;
   4&nbsp;#include "kplaysound.h"
   5&nbsp;int main (int argc, char *argv[])
   6&nbsp;{
   7&nbsp;  KApplication kapplication (argc, argv, "kplaysoundtest");
   8&nbsp;  KPlaySound kplaysound (0);
   9&nbsp;
  10&nbsp;  kplaysound.show();
  11&nbsp;  kapplication.setMainWidget (&amp;kplaysound);
  12&nbsp;  kapplication.exec();
  13&nbsp;}
  14&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
></DIV
></DIV
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="appC12"/></TD
></TR
><ANNOTATION
NAME="appC12"
TITLE="Exercises"/></TABLE
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="appC11"/></TD
></TR
><ANNOTATION
NAME="appC11"
TITLE="Chapter 7"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="appc9.html"
>Prev</A
> <A
HREF="appc13.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>