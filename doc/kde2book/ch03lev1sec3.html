<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Signals and Slots</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="The Qt Toolkit"
HREF="ch03.html"/><LINK
REL="PREVIOUS"
TITLE="Inside the Qt Toolkit"
HREF="ch03lev1sec2.html"/><LINK
REL="NEXT"
TITLE="Meta Object Compiler (moc)"
HREF="ch03lev1sec4.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch03lev1sec2.html"
>Prev</A
> <A
HREF="ch03lev1sec4.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="ch03lev1sec3"
>3.3. Signals and Slots</A
></H1
><P
>The most important features of Qt are signals and slots.</P
><P
>Signals tell you that something has just happened. Signals are emitted (sent) when the user works with the computer. For example, when the user clicks the mouse or presses keys on a keyboard a signal is emitted. Signals can also be emitted when something happens inside the computer&#8212;when the clock ticks, for example.</P
><P
>Slots are the functions that respond to certain signals. It is important that your program responds to signals. Otherwise, it might look as if your program hangs. KDE programs don't&#8212;or shouldn't&#8212;hang!</P
><P
>Signals and slots are very object independent. Slots that handle a signal can be put in any object in your program. The object that sends the signal doesn't have to know anything about the slot or the object where the slot can be found. For example, you may have one window that contains a button and one window that contains a text box. You can let the text box respond to button clicks.</P
><P
>Signals and slots are primarily used for events handling, but you can use it for easy communication between objects too. When two windows need to communicate with each other, you can use signals and slots. Communication this way is much easier than doing it with pointers.</P
><DIV
CLASS="note"
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="note.png"
HSPACE="5"
ALT="Note"/></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Event handling is solved by callbacks in many other toolkits. A callback is a pointer to a function. The widgets contain callbacks, pointers to functions, for each event. When an event occurs, the appropriate function is called. It is simple in theory, but it is hard in practice. The callbacks are not type safe, which means that it is easy to make mistakes. Callbacks also can't take any number of parameters of any type like signals and slots do.</P
></TD
></TR
></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch03lev2sec5"
>3.3.1. Creating a Slot</A
></H2
><P
>Creating a slot is easy. Any class that inherits from <TT
CLASS="literal"
>QObject</TT
> can have slots.</P
><P
>First you must enable signals and slots. In the class definition, add the word <TT
CLASS="literal"
>Q_OBJECT</TT
>. This is a keyword, which the <TT
CLASS="literal"
>moc</TT
> understands.</P
><P
>The slot is just a member function in your class, but you must declare it in a slots section. Slots can be public, private, or protected.</P
><P
>The following example shows a class with a slot:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;class MyWindow : public QWidget
   3&nbsp;{
   4&nbsp;  Q_OBJECT  // Enable signals and slots
   5&nbsp;public:
   6&nbsp;  MyWindow();
   7&nbsp;public slots:  // This slots section is public
   8&nbsp;  void mySlot();  // A public slot
   9&nbsp;};
  10&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The slot in the preceding class definition is called <TT
CLASS="literal"
>mySlot</TT
>. The keyword before <TT
CLASS="literal"
>slots</TT
> defines the access mode. The slot <TT
CLASS="literal"
>mySlot</TT
> above is public.</P
><P
>You write the implementation for the slot as if it was a common member function. The following example shows you what a slot implementation may look like:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;void MyWindow::mySlot()
   3&nbsp;{
   4&nbsp;  cout &lt;&lt; "slotPublic" &lt;&lt; endl;
   5&nbsp;}
   6&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch03lev2sec5"/></TD
></TR
><ANNOTATION
NAME="ch03lev2sec5"
TITLE="Creating a Slot"/></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch03lev2sec6"
>3.3.2. Emitting a Signal</A
></H2
><P
>When you want to tell Qt that an event has occurred, you emit a signal. When that happens, Qt executes all slots that are connected to the signal.</P
><P
>Before a signal can be emitted, it must be defined. The class that emits a signal must contain the signal definition. Signals are defined in a <TT
CLASS="literal"
>signals</TT
> section in your class. The following class definition defines a signal:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;class MyWindow : public QWidget
   3&nbsp;{
   4&nbsp;  Q_OBJECT  // Enable signals and slots
   5&nbsp;public:
   6&nbsp;  MyWindow();
   7&nbsp;signals:
   8&nbsp;  void created();
   9&nbsp;};
  10&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>Signals are emitted with the command <TT
CLASS="literal"
>emit</TT
>. The signal may be emitted like so:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;// Constructor for MyWindow
   3&nbsp;MyWindow::MyWindow() : QWidget()
   4&nbsp;{
   5&nbsp;  // Emit the signal created()
   6&nbsp;  emit created();
   7&nbsp;}
   8&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The example above is only a simple demonstration that shows you how it works.</P
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch03lev2sec6"/></TD
></TR
><ANNOTATION
NAME="ch03lev2sec6"
TITLE="Emitting a Signal"/></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch03lev2sec7"
>3.3.3. Connecting a Slot to a Signal</A
></H2
><P
>To make a slot respond to a certain signal, you must connect them to each other. You can connect several slots to one signal.</P
><P
>It is very simple to connect a slot to a signal. The command <TT
CLASS="literal"
>connect</TT
> does this. The syntax is simple:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;connect(<I
CLASS="emphasis"
>startobject</I
>, SIGNAL(<I
CLASS="emphasis"
>signal()</I
>), <I
CLASS="emphasis"
>targetobject</I
>, SLOT(<I
CLASS="emphasis"
>slot()</I
>))
   3&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The parameter <I
CLASS="emphasis"
><TT
CLASS="literal"
>startobject</TT
></I
> contains a pointer to the object that the signal comes from.</P
><P
>The parameter <I
CLASS="emphasis"
><TT
CLASS="literal"
>signal</TT
></I
> specifies what signal to handle. The signal must be emitted by the <I
CLASS="emphasis"
><TT
CLASS="literal"
>startobject</TT
></I
>.</P
><P
>The object which responds to a signal is specified in the parameter <I
CLASS="emphasis"
><TT
CLASS="literal"
>targetobject</TT
></I
>.</P
><P
>The slot which responds to the signal is specified in the parameter <I
CLASS="emphasis"
><TT
CLASS="literal"
>slot</TT
></I
>. The slot must be in the object specified by <I
CLASS="emphasis"
><TT
CLASS="literal"
>targetobject</TT
></I
>.</P
><P
>The following class demonstrates that several slots can be connected to the same signal, and one slot can be connected to several signals:</P
><DIV
CLASS="example"
><HR/><A
NAME="ch03list04"
></A
><P
><B
>Example 3.4. buttons.h: Class Definition for the Class <TT
CLASS="literal"
>MyWindow</TT
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1:class MyWindow : public QWidget
   3&nbsp; 2:{
   4&nbsp; 3:  Q_OBJECT  // Enable slots and signals
   5&nbsp; 4:public:
   6&nbsp; 5: MyWindow();
   7&nbsp; 6:private slots:
   8&nbsp; 7:  void slotButton1();
   9&nbsp; 8:  void slotButton2();
  10&nbsp; 9:  void slotButtons();
  11&nbsp;10:private:
  12&nbsp;11:  QPushButton *button1;
  13&nbsp;12:  QPushButton *button2;
  14&nbsp;13: };
  15&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The listing below contains the class implementation:</P
><DIV
CLASS="example"
><HR/><A
NAME="ch03list05"
></A
><P
><B
>Example 3.5. buttons.cc: Class Implementation for the Class <TT
CLASS="literal"
>MyWindow</TT
> Declared in <A
HREF="ch03lev1sec3.html#ch03list04"
>Listing 3.4</A
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: MyWindow::MyWindow() : QWidget()
   3&nbsp; 2: {
   4&nbsp; 3:   // Create button1 and connect button1-&gt;clicked() to this-&gt;slotButton1()
   5&nbsp; 4:   button1 = new QPushButton("Button1", this);
   6&nbsp; 5:   button1-&gt;setGeometry(10,10,100,40);
   7&nbsp; 6:   button1-&gt;show();
   8&nbsp; 7:   connect(button1, SIGNAL(clicked()), this, SLOT(slotButton1()));
   9&nbsp; 8: 
  10&nbsp; 9:   // Create button2 and connect button2-&gt;clicked() to this-&gt;slotButton2()
  11&nbsp;10:   button2 = new QPushButton("Button2", this);
  12&nbsp;11:   button2-&gt;setGeometry(110,10,100,40);
  13&nbsp;12:   button2-&gt;show();
  14&nbsp;13:   connect(button2, SIGNAL(clicked()), this, SLOT(slotButton2()));
  15&nbsp;14: 
  16&nbsp;15:   // When any button is clicked, call this-&gt;slotButtons()
  17&nbsp;16:   connect(button1, SIGNAL(clicked()), this, SLOT(slotButtons()));
  18&nbsp;17:   connect(button2, SIGNAL(clicked()), this, SLOT(slotButtons()));
  19&nbsp;18: }
  20&nbsp;19: 
  21&nbsp;20: 
  22&nbsp;21: // This slot is called when button1 is clicked.
  23&nbsp;22: void MyWindow::slotButton1()
  24&nbsp;23: {
  25&nbsp;24:   cout &lt;&lt; "Button1 was clicked" &lt;&lt; endl;
  26&nbsp;25: }
  27&nbsp;26: 
  28&nbsp;27: 
  29&nbsp;28: // This slot is called when button2 is clicked
  30&nbsp;29: void MyWindow::slotButton2()
  31&nbsp;30: {
  32&nbsp;31:   cout &lt;&lt; "Button2 was clicked" &lt;&lt; endl;
  33&nbsp;32: }
  34&nbsp;33: 
  35&nbsp;34: 
  36&nbsp;35: // This slot is called when any of the buttons were clicked
  37&nbsp;36: void MyWindow::slotButtons()
  38&nbsp;37: {
  39&nbsp;38:   cout &lt;&lt; "A button was clicked" &lt;&lt; endl;
  40&nbsp;39: }
  41&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch03lev2sec7"/></TD
></TR
><ANNOTATION
NAME="ch03lev2sec7"
TITLE="Connecting a Slot to a Signal"/></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch03lev2sec8"
>3.3.4. Signals and Slots with Parameters</A
></H2
><P
>During communication, it is sometimes useful to say more than <SPAN
CLASS="QUOTE"
>"Hey!"</SPAN
> That is all that the preceding signals say.</P
><P
>If you need to say more, the simplest way is to use parameters in your signals and slots.</P
><P
>For example, you may have two windows both containing a button and a text box. When the user types in text and clicks the button in one window, the caption for the other window will change to whatever was typed in.</P
><P
>The solution is to use slots and signals with parameters. Give both the signal and slot a parameter that contains the new window caption. When you emit the signal you set this parameter.</P
><P
>The following example code shows how parameters work. The signal and slot are both in the same class, but of course that is not necessary:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;class MyWindow : public QWidget
   3&nbsp;{
   4&nbsp;  Q_OBJECT  // Enable signals and slots
   5&nbsp;public:
   6&nbsp;  MyWindow();
   7&nbsp;private slots:
   8&nbsp;  void slotChanged(int i);
   9&nbsp;signals:
  10&nbsp;  void changed(int i);
  11&nbsp;};
  12&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The class constructor may connect the slot to the signal, like this:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;MyWindow::MyWindow() : QWidget()
   3&nbsp;{
   4&nbsp;  connect(this, SIGNAL(changed(int)), this, SLOT(slotChanged(int)));
   5&nbsp;}
   6&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The slot and the signal must have compatible parameters. In the preceding example, they each have one integer as a parameter.</P
><P
>It is easy to emit a signal with a parameter. The following function emits the signal <TT
CLASS="literal"
>changed(int i)</TT
>:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;void MyWindow::emitter(int i)
   3&nbsp;{
   4&nbsp;  emit changed(i);
   5&nbsp;}
   6&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch03lev2sec8"/></TD
></TR
><ANNOTATION
NAME="ch03lev2sec8"
TITLE="Signals and Slots with Parameters"/></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch03lev2sec9"
>3.3.5. Slots in Temporary Classes</A
></H2
><P
>When a signal is emitted, the slots connected to it are activated.</P
><P
>Take a look at the following class constructor:</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;MyWindow::MyWindow() : QWidget()
   3&nbsp;{
   4&nbsp;  MyClass *temp = new MyClass();
   5&nbsp;
   6&nbsp;  button = new QPushButton(this, "Button");
   7&nbsp;  button-&gt;setGeometry(0,0,100,30);
   8&nbsp;  button-&gt;show();
   9&nbsp;  connect(button, SIGNAL(clicked()), temp, SLOT(slotTemp()));
  10&nbsp;
  11&nbsp;  delete temp;
  12&nbsp;}
  13&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>A button is created. The <TT
CLASS="literal"
>clicked()</TT
> signal is connected to <TT
CLASS="literal"
>temp-&gt;slotTemp()</TT
>. When you delete <TT
CLASS="literal"
>temp</TT
>, the slot <TT
CLASS="literal"
>slotTemp()</TT
> is also deleted. If the user clicks the button, an error will occur. Always consider this when you delete Qt objects.</P
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch03lev2sec9"/></TD
></TR
><ANNOTATION
NAME="ch03lev2sec9"
TITLE="Slots in Temporary Classes"/></TABLE
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch03lev1sec3"/></TD
></TR
><ANNOTATION
NAME="ch03lev1sec3"
TITLE="Signals and Slots"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch03lev1sec2.html"
>Prev</A
> <A
HREF="ch03lev1sec4.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>