<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Panel Applets</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="Alternative Application Types"
HREF="ch11.html"/><LINK
REL="PREVIOUS"
TITLE="Single-Instance Applications"
HREF="ch11lev1sec2.html"/><LINK
REL="NEXT"
TITLE="Summary"
HREF="ch11lev1sec4.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch11lev1sec2.html"
>Prev</A
> <A
HREF="ch11lev1sec4.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="ch11lev1sec3"
>11.3. Panel Applets</A
></H1
><P
>Panel applets are small applications with minimal user interfaces that run in the KDE panel, Kicker. They generally indicate the status of some part of the system, such as CPU load, network activity, the system time, or provide easy access to functions that are not directly related to the work being performed by the user, such as a desktop pager, a CD player controller, or an instant-messaging client. For creating your own panel applet, the KDE libraries provide the class <TT
CLASS="literal"
>KPanelApplet</TT
>. It is derived from <TT
CLASS="literal"
>QWidget</TT
> (and <TT
CLASS="literal"
>DCOPObject</TT
>) and takes the place of <TT
CLASS="literal"
>KTMainWindow</TT
> in the design of your application. <A
HREF="ch11lev1sec3.html#ch11list07"
>Listing 11.7</A
> shows our usual <TT
CLASS="literal"
>main()</TT
> function modified to create an applet.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch11list07"
></A
><P
><B
>Example 11.7. main.cpp: A <TT
CLASS="literal"
>main()</TT
> Function Suitable for Starting a Panel applet</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: #include &lt;kapp.h&gt;
   3&nbsp; 2:
   4&nbsp; 3: #include "kweather.h"
   5&nbsp; 4:
   6&nbsp; 5:  int
   7&nbsp; 6: main(int argc, char *argv[])
   8&nbsp; 7: {
   9&nbsp; 8:     KApplication kapplication (argc, argv, "kweather");
  10&nbsp; 9:
  11&nbsp;10:     KWeather *kweather = new KWeather;
  12&nbsp;11:
  13&nbsp;12:     return kapplication.exec();
  14&nbsp;13: }
  15&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>This applet, the subclass of <TT
CLASS="literal"
>KPanelApplet</TT
>, is called <TT
CLASS="literal"
>KWeather</TT
>. <TT
CLASS="literal"
>KWeather</TT
> is a mock-up of an applet that displays the outside weather, say, to a graduate student trapped in a windowless office. A complete implementation of <TT
CLASS="literal"
>KWeather</TT
> might query a weather service via HTTP (using <TT
CLASS="literal"
>KIONetAccess</TT
>) to determine the actual weather. In this implementation the weather is always rainy and 48°F so that the graduate student won't feel that he is missing out on a nice day.</P
><P
><A
HREF="ch11lev1sec3.html#ch11list08"
>Listing 11.8</A
> shows how the <TT
CLASS="literal"
>KWeather</TT
> class is implemented.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch11list08"
></A
><P
><B
>Example 11.8. kweather.cpp: Class Definition for <TT
CLASS="literal"
>KWeather</TT
>, a Panel Applet</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: #include &lt;stdio.h&gt;
   3&nbsp; 2:
   4&nbsp; 3: #include &lt;qlabel.h&gt;
   5&nbsp; 4:
   6&nbsp; 5: #include &lt;kiconloader.h&gt;
   7&nbsp; 6: #include &lt;kpopupmenu.h&gt;
   8&nbsp; 7:
   9&nbsp; 8: #include "kweather.h"
  10&nbsp; 9:
  11&nbsp;10: KWeather::KWeather (QWidget* parent, const char* name)
  12&nbsp;11:     : KPanelApplet (parent, name)
  13&nbsp;12: {
  14&nbsp;13:   setPalette(QPalette(Qt::gray));
  15&nbsp;14:   QLabel *qlabel = new QLabel ("Rainy\n  48F", this);
  16&nbsp;15:   qlabel-&gt;setAlignment (Qt::AlignVCenter);
  17&nbsp;16:   setMinimumSize (qlabel-&gt;sizeHint());
  18&nbsp;17:
  19&nbsp;18:   setActions (Preferences);
  20&nbsp;19:
  21&nbsp;20:   dock("kweather");
  22&nbsp;21: }
  23&nbsp;22:
  24&nbsp;23: void
  25&nbsp;24: KWeather::preferences()
  26&nbsp;25: {
  27&nbsp;26:   printf ("Here we let the user configure the panel applet.\n");
  28&nbsp;27: }
  29&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>In the constructor, you create your content area, a <TT
CLASS="literal"
>QLabel</TT
>. Be sure when you design your content area that it will fit comfortably in the small area given to it by Kicker, the KDE panel. The content area here consists of two lines of text on a colored background. It fits nicely. Generally, a well-designed icon can convey more information in the small space&#8212;or at least convey it in a more appealing way.</P
><P
>The call on line 16 to <TT
CLASS="literal"
>setMinimumSize()</TT
> keeps Kicker from shrinking the widget so that the text is too small to read. Kicker is trying to minimize usage of the valuable panel space, so be sure to set a minimum size for your widget.</P
><P
>KPanelApplet provides a context menu (a pop-up menu that appears when the user clicks the applet with the right mouse button, also known as an <SPAN
CLASS="QUOTE"
>"RMB menu"</SPAN
>). This menu provides the minimum of choices to the user: Move and Remove, which allow the user to, respectively, move the applet along the panel or remove from the panel, thus exiting the applet.You may add other menu entries&#8212;About, Help, and Preferences&#8212;using the method <TT
CLASS="literal"
>setActions()</TT
>, as on line 18. The enum constants About, Help and Preferences may be combined with the bitwis-or operator (i.e., <TT
CLASS="literal"
>&amp;</TT
>) and passed to <TT
CLASS="literal"
>setActions()</TT
> to add any combination of these menu entries. To respond to the user's selection of one of these menu entries, you should reimplement the corresponding virtual method: <TT
CLASS="literal"
>about()</TT
>, <TT
CLASS="literal"
>help()</TT
>, or <TT
CLASS="literal"
>preferences()</TT
>. The latter is reimplemented, as an example, on lines 23-27.</P
><P
>The final bit of code needed for <TT
CLASS="literal"
>KWeather</TT
> is given in <A
HREF="ch11lev1sec3.html#ch11list09"
>Listing 11.9</A
>.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch11list09"
></A
><P
><B
>Example 11.9. kweather.h: Class Declaration for <TT
CLASS="literal"
>KWeather</TT
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp; 1: #ifndef __KWEATHER_H__
   3&nbsp; 2: #define __KWEATHER_H__
   4&nbsp; 3:
   5&nbsp; 4: #include &lt;kapplet.h&gt;
   6&nbsp; 5:
   7&nbsp; 6: class KWeather : public KApplet
   8&nbsp; 7: {
   9&nbsp; 8:
  10&nbsp; 9: public:
  11&nbsp;10:   KWeather (QWidget * parent=0, const char *name=0);
  12&nbsp;11:
  13&nbsp;12:  protected:
  14&nbsp;13:   void mousePressEvent (QMouseEvent *);
  15&nbsp;14:
  16&nbsp;15: };
  17&nbsp;16:
  18&nbsp;17: #endif
  19&nbsp;</PRE
></TD
></TR
></TABLE
><HR/></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch11lev1sec3"/></TD
></TR
><ANNOTATION
NAME="ch11lev1sec3"
TITLE="Panel Applets"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch11lev1sec2.html"
>Prev</A
> <A
HREF="ch11lev1sec4.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>