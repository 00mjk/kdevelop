<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Chapter 6</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="Answers"
HREF="ap-c.html"/><LINK
REL="PREVIOUS"
TITLE="Chapter 5"
HREF="appc7.html"/><LINK
REL="NEXT"
TITLE="Chapter 7"
HREF="appc11.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="appc7.html"
>Prev</A
> <A
HREF="appc11.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="appC9"
>C.6. <A
HREF="ch06.html"
>Chapter 6</A
></A
></H1
><P
></P
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="appC10"
>C.6.1. Exercises</A
></H2
><DIV
CLASS="qandaset"
><DL
><DT
>C.6.1.1. <A
HREF="appc9.html#AEN28094"
>Improve the program you wrote for Exercise 2 from <A
HREF="ch05.html"
>Chapter 5</A
>. Create a full-featured Edit menu (with Copy, Paste, and Cut, Undo, and Redo), and support file saving and opening, with <TT
CLASS="literal"
>KIO::NetAccess</TT
>. (See <A
HREF="appc9.html#ap-clist18"
>Listing C.18</A
>.)</A
></DT
><DT
>C.6.1.2. <A
HREF="appc9.html#AEN28106"
>Use KRun to execute a program (and tell the user of its completion). Store the text of the KLineEdit for the sake of session management. (See <A
HREF="appc9.html#ap-clist19"
>Listing C.19</A
>.)</A
></DT
></DL
><DIV
CLASS="qandaentry"
><DIV
CLASS="question"
><P
><A
NAME="AEN28094"
></A
><B
>C.6.1.1. </B
>Improve the program you wrote for Exercise 2 from <A
HREF="ch05.html"
>Chapter 5</A
>. Create a full-featured Edit menu (with Copy, Paste, and Cut, Undo, and Redo), and support file saving and opening, with <TT
CLASS="literal"
>KIO::NetAccess</TT
>. (See <A
HREF="appc9.html#ap-clist18"
>Listing C.18</A
>.)</P
></DIV
><DIV
CLASS="answer"
><P
><B
> </B
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;keditor.h: Class Declaration for KEditor
   3&nbsp;#ifndef __KEDITOR_H__
   4&nbsp;#define __KEDITOR_H__
   5&nbsp;
   6&nbsp;#include &lt;ktmainwindow.h&gt;
   7&nbsp;#include &lt;kurl.h&gt;
   8&nbsp;
   9&nbsp;class QMultiLineEdit;
  10&nbsp;
  11&nbsp;class KEditor : public KTMainWindow
  12&nbsp;{
  13&nbsp; Q_OBJECT
  14&nbsp; public:
  15&nbsp;  KEditor (const char *name=0);
  16&nbsp;
  17&nbsp; protected slots:
  18&nbsp;  /**
  19&nbsp;   * Update the line number field in the statusbar.
  20&nbsp;   **/
  21&nbsp;  void slotUpdateStatusBar ();
  22&nbsp;  /**
  23&nbsp;   * Open the "Save As" dialog.
  24&nbsp;   **/
  25&nbsp;  void slotSaveAs();
  26&nbsp;  /**
  27&nbsp;   * Save the file.
  28&nbsp;   **/
  29&nbsp;  void slotSave();
  30&nbsp;  /**
  31&nbsp;   * Open the "Open" dialog.
  32&nbsp;   **/
  33&nbsp;  void slotOpen();
  34&nbsp;
  35&nbsp; private:
  36&nbsp;  QMultiLineEdit *qmle;
  37&nbsp;  KURL url;
  38&nbsp;  QString file;
  39&nbsp;};
  40&nbsp;
  41&nbsp;#endif
  42&nbsp;keditor.cpp: Class Definition for KEditor,
  43&nbsp;#include &lt;qmultilineedit.h&gt;
  44&nbsp;
  45&nbsp;#include &lt;kapp.h&gt;
  46&nbsp;#include &lt;kiconloader.h&gt;
  47&nbsp;#include &lt;kmenubar.h&gt;
  48&nbsp;#include &lt;kstdaction.h&gt;
  49&nbsp;#include &lt;kaction.h&gt;
  50&nbsp;
  51&nbsp;#include &lt;netaccess.h&gt;
  52&nbsp;#include &lt;ktempfile.h&gt;
  53&nbsp;
  54&nbsp;#include "keditor.moc"
  55&nbsp;
  56&nbsp;//Status Bar id
  57&nbsp;const int SBLineNumber = 2;
  58&nbsp;
  59&nbsp;KEditor::KEditor (const char *name) : KTMainWindow (name)
  60&nbsp;{
  61&nbsp;  qmle = new QMultiLineEdit (this);
  62&nbsp;
  63&nbsp;  KStdAction::openNew (qmle, SLOT (clear()), actionCollection());
  64&nbsp;  KStdAction::quit (kapp, SLOT (closeAllWindows()), actionCollection());
  65&nbsp;  KStdAction::copy (qmle, SLOT (copy()), actionCollection());
  66&nbsp;  KStdAction::cut (qmle, SLOT (cut()), actionCollection());
  67&nbsp;  KStdAction::paste (qmle, SLOT (paste()), actionCollection());
  68&nbsp;  KStdAction::undo (qmle, SLOT (undo()), actionCollection());
  69&nbsp;  KStdAction::redo (qmle, SLOT (redo()), actionCollection());
  70&nbsp;
  71&nbsp;  KStdAction::open(this, SLOT(slotOpen()), actionCollection());
  72&nbsp;  KStdAction::save(this, SLOT(slotSave()), actionCollection());
  73&nbsp;  KStdAction::saveAs(this, SLOT(slotSaveAs()), actionCollection());
  74&nbsp;
  75&nbsp;  createGUI();
  76&nbsp;
  77&nbsp;  statusBar()-&gt;insertItem ("Line", 1);
  78&nbsp;  statusBar()-&gt;insertItem ("0000", SBLineNumber);
  79&nbsp;  slotUpdateStatusBar();
  80&nbsp;  connect ( qmle, SIGNAL (textChanged()),
  81&nbsp;        this, SLOT (slotUpdateStatusBar()) );
  82&nbsp;
  83&nbsp;
  84&nbsp;  setView (qmle);
  85&nbsp;}
  86&nbsp;
  87&nbsp;void
  88&nbsp;KEditor::slotUpdateStatusBar ()
  89&nbsp;{
  90&nbsp;  QString linenumber;
  91&nbsp;  int line, col;
  92&nbsp;
  93&nbsp;  qmle-&gt;getCursorPosition (&amp;line, &amp;col);
  94&nbsp;  linenumber.sprintf ("%4d", line);
  95&nbsp;
  96&nbsp;  statusBar()-&gt;changeItem (linenumber, SBLineNumber);
  97&nbsp;}
  98&nbsp;
  99&nbsp;void
 100&nbsp;KEditor::slotSaveAs()
 101&nbsp;{
 102&nbsp;  url=KFileDialog::getSaveUrl(0,
 103&nbsp;        "*.txt|Text Files (*.txt)",this)
 104&nbsp;  file=url.path();
 105&nbsp;
 106&nbsp;  if (!file.isLocalPath())
 107&nbsp;  {
 108&nbsp;     KTempFile temp;
 109&nbsp;     file=temp.name();
 110&nbsp;
 111&nbsp;     slotSave();
 112&nbsp;     temp.unlink();
 113&nbsp;     return;
 114&nbsp;  }
 115&nbsp;  slotSave();
 116&nbsp;}
 117&nbsp;
 118&nbsp;void
 119&nbsp;KEditor::slotSave()
 120&nbsp;{
 121&nbsp;  if (url.isEmpty() || file.isEmpty())
 122&nbsp;    slotSaveAs(), return;
 123&nbsp;  QFile f(file);
 124&nbsp;
 125&nbsp;  if (!f.open(IO_WriteOnly | IO_Truncate))
 126&nbsp;    KNotifyClient::event("cannotopenfile"), return;
 127&nbsp;
 128&nbsp;  QTextStream t( &amp;f );
 129&nbsp;  t &lt;&lt; qmle-&gt;text();
 130&nbsp;
 131&nbsp;  f.close();
 132&nbsp;  qmle-&gt;setEdited(false);
 133&nbsp;}
 134&nbsp;
 135&nbsp;void
 136&nbsp;KEditor::slotOpen()
 137&nbsp;{
 138&nbsp;  if ( qmle-&gt;edited() )
 139&nbsp;  {
 140&nbsp;    int result=KMessageBox::questionYesNo(this,
 141&nbsp;      i18n("You already have a file open! Would you like
 142&nbsp;           "to save the currently "
 143&nbsp;           "opened file and open another?"),
 144&nbsp;      i18n("Continue?"));
 145&nbsp;
 146&nbsp;    if (result==KMessageBox::Yes)
 147&nbsp;      slotSave();
 148&nbsp;    else
 149&nbsp;      return;
 150&nbsp;  }
 151&nbsp;
 152&nbsp;  url=KFileDialog::getOpenURL(0,
 153&nbsp;        "*.txt|Text Files (*.txt)", this);
 154&nbsp;
 155&nbsp;  if (!KIO::NetAccess::download(url, file))
 156&nbsp;    KNotifyClient::event("cannotopenfile"), return;
 157&nbsp;
 158&nbsp;  QFile f(file);
 159&nbsp;  if (!f.open(IO_ReadOnly))
 160&nbsp;    KNotifyClient::event("cannotopenfile"), return;
 161&nbsp;
 162&nbsp;  QTextStream t( &amp;f );
 163&nbsp;  QString text(t.read());
 164&nbsp;  qmle-&gt;clear();
 165&nbsp;  qmle-&gt;setText(text);
 166&nbsp;  f.close();
 167&nbsp;}
 168&nbsp;
 169&nbsp;// main.cpp: main() which can be used to test KEditor
 170&nbsp;#include &lt;kapp.h&gt;
 171&nbsp;
 172&nbsp;#include "keditor.h"
 173&nbsp;
 174&nbsp;int
 175&nbsp;main (int argc, char *argv[])
 176&nbsp;{
 177&nbsp;  KApplication kapplication  (argc, argv, "keditor");
 178&nbsp;  KEditor *keditor = new KEditor (0);
 179&nbsp;
 180&nbsp;  kapplication.setMainWidget (keditor);
 181&nbsp;
 182&nbsp;  keditor-&gt;show();
 183&nbsp;  return kapplication.exec();
 184&nbsp;}
 185&nbsp;</PRE
></TD
></TR
></TABLE
></P
></DIV
></DIV
><DIV
CLASS="qandaentry"
><DIV
CLASS="question"
><P
><A
NAME="AEN28106"
></A
><B
>C.6.1.2. </B
>Use KRun to execute a program (and tell the user of its completion). Store the text of the KLineEdit for the sake of session management. (See <A
HREF="appc9.html#ap-clist19"
>Listing C.19</A
>.)</P
></DIV
><DIV
CLASS="answer"
><P
><B
> </B
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;kjogger.h: Class Declaration for KJogger
   3&nbsp;#ifndef __KJOGGER_H__
   4&nbsp;#define __KJOGGER_H__
   5&nbsp;
   6&nbsp;#include &lt;ktmainwindow.h&gt;
   7&nbsp;#include &lt;klineedit.h&gt;
   8&nbsp;#include &lt;kprocess.h&gt;
   9&nbsp;#include &lt;kconfig.h&gt;
  10&nbsp;
  11&nbsp;class JogView;
  12&nbsp;
  13&nbsp;class KJogger : public KTMainWindow
  14&nbsp;{
  15&nbsp; Q_OBJECT
  16&nbsp; public:
  17&nbsp;  KJogger (const char *name=0);
  18&nbsp;
  19&nbsp; protected:
  20&nbsp;  void saveProperties(KConfig* config);
  21&nbsp;  void readProperties(KConfig* config);
  22&nbsp;
  23&nbsp; private:
  24&nbsp;  JogView *view;
  25&nbsp;
  26&nbsp;};
  27&nbsp;
  28&nbsp;class JogView : public KLineEdit
  29&nbsp;{
  30&nbsp; Q_OBJECT
  31&nbsp; public:
  32&nbsp;  JogView(QWidget *parent);
  33&nbsp;
  34&nbsp; protected slots:
  35&nbsp;  /**
  36&nbsp;   * Run the program.
  37&nbsp;   **/
  38&nbsp;  void slotRun();
  39&nbsp;  /**
  40&nbsp;   * Enable the KLineEdit that we are.
  41&nbsp;   **/
  42&nbsp;  void slotEnable(KProcess*);
  43&nbsp; private:
  44&nbsp;  KProcess proc;
  45&nbsp;};
  46&nbsp;
  47&nbsp;#endif
  48&nbsp;
  49&nbsp;kjogger.cpp: Class Definition for KJogger,
  50&nbsp;
  51&nbsp;#include &lt;kapp.h&gt;
  52&nbsp;#include &lt;kmenubar.h&gt;
  53&nbsp;#include &lt;kstdaction.h&gt;
  54&nbsp;#include &lt;kaction.h&gt;
  55&nbsp;
  56&nbsp;#include "kjogger.moc"
  57&nbsp;
  58&nbsp;
  59&nbsp;KJogger::KJogger (const char *name) : KTMainWindow (name)
  60&nbsp;{
  61&nbsp;  KStdAction::quit (kapp, SLOT (closeAllWindows()),
  62&nbsp;    actionCollection());
  63&nbsp;  createGUI();
  64&nbsp;  view=new JogView(this);
  65&nbsp;
  66&nbsp;  setView (view);
  67&nbsp;
  68&nbsp;}
  69&nbsp;
  70&nbsp;void
  71&nbsp;KJogger::saveProperties(KConfig* config)
  72&nbsp;{
  73&nbsp;  config-&gt;writeEntry("program",view-&gt;text());
  74&nbsp;}
  75&nbsp;
  76&nbsp;void
  77&nbsp;KJogger::readProperties(KConfig* config)
  78&nbsp;{
  79&nbsp;  view-&gt;setText(config-&gt;readEntry("program",""));
  80&nbsp;}
  81&nbsp;
  82&nbsp;JogView::JogView (QWidget *parent) : KLineEdit(parent)
  83&nbsp;{
  84&nbsp;  connect(this, SIGNAL(returnPressed()), SLOT (slotRun()) );
  85&nbsp;  connect(&amp;proc, SIGNAL (processExited(KProcess*)), SLOT (slotEnable(KProcess*)) );
  86&nbsp;}
  87&nbsp;
  88&nbsp;void
  89&nbsp;JogView::slotRun()
  90&nbsp;{
  91&nbsp;  setEnabled(false);
  92&nbsp;  proc.clearArguments();
  93&nbsp;  proc &lt;&lt; text();
  94&nbsp;
  95&nbsp;  proc.start();
  96&nbsp;}
  97&nbsp;
  98&nbsp;void
  99&nbsp;JogView::slotEnable(KProcess*)
 100&nbsp;{
 101&nbsp;  setEnabled(true);
 102&nbsp;}
 103&nbsp;
 104&nbsp;
 105&nbsp;// A main() function required to test this program.
 106&nbsp;#include "kjogger.h"
 107&nbsp;#include &lt;kapp.h&gt;
 108&nbsp;#include &lt;dcopclient.h&gt;
 109&nbsp;
 110&nbsp;int main(int argc, char **argv)
 111&nbsp;{
 112&nbsp;  KApplication app(argc, argv, "kjogger");
 113&nbsp;  app.dcopClient()-&gt;registerAs(app.name());
 114&nbsp;
 115&nbsp;  if (app.isRestored())
 116&nbsp;     RESTORE(KJogger)
 117&nbsp;  else
 118&nbsp;  {
 119&nbsp;     KJogger *widget = new KJogger;
 120&nbsp;     widget-&gt;show();
 121&nbsp;  }
 122&nbsp;
 123&nbsp;  return app.exec();
 124&nbsp;}
 125&nbsp;</PRE
></TD
></TR
></TABLE
></P
></DIV
></DIV
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="appC10"/></TD
></TR
><ANNOTATION
NAME="appC10"
TITLE="Exercises"/></TABLE
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="appC9"/></TD
></TR
><ANNOTATION
NAME="appC9"
TITLE="Chapter 6"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="appc7.html"
>Prev</A
> <A
HREF="appc11.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>