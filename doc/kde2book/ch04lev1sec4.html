<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML
><HEAD
><TITLE
>Handling User Input</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"/><LINK
REL="HOME"
TITLE="KDE 2.0 Development"
HREF="index.html"/><LINK
REL="UP"
TITLE="Creating Custom KDE Widgets"
HREF="ch04.html"/><LINK
REL="PREVIOUS"
TITLE="Using Child Widgets"
HREF="ch04lev1sec3.html"/><LINK
REL="NEXT"
TITLE="Summary"
HREF="ch04lev1sec5.html"/><META
HTTP-EQUIV="Content-Style-Type"
CONTENT="text/css"/><LINK
REL="stylesheet"
HREF="kde-common.css"
TYPE="text/css"/><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=iso-8859-1"/><META
HTTP-EQUIV="Content-Language"
CONTENT="en"/><LINK
REL="stylesheet"
HREF="kde-localised.css"
TYPE="text/css"
TITLE="KDE-English"/><LINK
REL="stylesheet"
HREF="kde-default.css"
TYPE="text/css"
TITLE="KDE-Default"/></HEAD
><BODY
CLASS="section"
LINK="#336699"
VLINK="#336699"
ALINK="#336699"
BGCOLOR="#FFFFFF"
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch04lev1sec3.html"
>Prev</A
> <A
HREF="ch04lev1sec5.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H1
CLASS="section"
><A
NAME="ch04lev1sec4"
>4.4. Handling User Input</A
></H1
><P
>Applications receive user input most commonly via mouse and keyboard. You saw earlier that mouse and keyboard information is passed to a KDE/Qt application from the window system via events. The events that are important here are</P
><UL
COMPACT="COMPACT"
><LI
STYLE="list-style-type: disc"
><P
><TT
CLASS="literal"
>mousePressEvent()</TT
></P
></LI
><LI
STYLE="list-style-type: disc"
><P
><TT
CLASS="literal"
>mouseMoveEvent()</TT
></P
></LI
><LI
STYLE="list-style-type: disc"
><P
><TT
CLASS="literal"
>mouseReleaseEvent()</TT
></P
></LI
><LI
STYLE="list-style-type: disc"
><P
><TT
CLASS="literal"
>mouseDoubleClickEvent()</TT
></P
></LI
><LI
STYLE="list-style-type: disc"
><P
><TT
CLASS="literal"
>keyPressEvent()</TT
></P
></LI
><LI
STYLE="list-style-type: disc"
><P
><TT
CLASS="literal"
>keyReleaseEvent()</TT
> for processing keyboard input</P
></LI
></UL
><P
><TT
CLASS="literal"
>KDisc</TT
> (see Listings 4.10&#8211;4.12) demonstrates use of the <TT
CLASS="literal"
>mouseMoveEvent()</TT
> and <TT
CLASS="literal"
>keyPressEvent()</TT
>. The widget draws a disc on itself and lets the user move the disc around by dragging with the mouse or pressing one of the four arrow keys (see <A
HREF="ch04lev1sec4.html#ch04fig07"
>Figure 4.7</A
>).</P
><DIV
CLASS="figure"
><HR/><A
NAME="ch04fig07"
></A
><P
><B
>Figure 4.7. The <TT
CLASS="literal"
>KDisc</TT
> widget processes mouse-move events to let the user drag the disc around.</B
></P
><DIV
CLASS="mediaobject"
><P
><IMG
SRC="graphics/04fig07.gif"
></IMG
></P
></DIV
><HR/></DIV
><DIV
CLASS="example"
><HR/><A
NAME="ch04list10"
></A
><P
><B
>Example 4.10. kdisc.h Contains the Class Declaration for the <TT
CLASS="literal"
>KDisc</TT
> Widget</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;1: #ifndef __KDISC_H__
   3&nbsp;2: #define __KDISC_H__
   4&nbsp;3:
   5&nbsp;4: #include &lt;qwidget.h&gt;
   6&nbsp;5:
   7&nbsp;6:
   8&nbsp;7: /**
   9&nbsp;8:  * KDisc
  10&nbsp;9:  * Lets the user move a disc around with the mouse or keyboard.
  11&nbsp;10:  **/
  12&nbsp;11: class KDisc : public QWidget
  13&nbsp;12: {
  14&nbsp;13:  public:
  15&nbsp;14:   KDisc (QWidget *parent, const char *name=0);
  16&nbsp;15:
  17&nbsp;16:    protected:
  18&nbsp;17:     /**
  19&nbsp;18:      * Disc the widget.
  20&nbsp;19:      **/
  21&nbsp;20:     void paintEvent (QPaintEvent *);
  22&nbsp;21:
  23&nbsp;22:     /**
  24&nbsp;23:      * Draw the disc under the mouse cursor.
  25&nbsp;24:      **/
  26&nbsp;25:     void mouseMoveEvent (QMouseEvent *);
  27&nbsp;26:
  28&nbsp;27:     /**
  29&nbsp;28:      * Examine the key pressed and move the disc accordingly.
  30&nbsp;29:      **/
  31&nbsp;30:     void keyPressEvent (QKeyEvent *);
  32&nbsp;31:
  33&nbsp;32:  private:
  34&nbsp;33:     QPoint discposition;
  35&nbsp;34:
  36&nbsp;35: };
  37&nbsp;36:
  38&nbsp;37: #endif</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>The previous listing, <A
HREF="ch04lev1sec4.html#ch04list10"
>Listing 4.10</A
>, shows the class definition for the <TT
CLASS="literal"
>KDisc</TT
> widget. You will be processing paint events to draw the disc; mouse-move events to move the disc in response to a mouse drag; and key press events to move the disc when one of the four arrow keys is pressed. See <A
HREF="ch04lev1sec4.html#ch04list11"
>Listing 4.11</A
> for the code that accomplishes these tasks. The following two sections discuss the mouse events and key events, respectively.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch04list11"
></A
><P
><B
>Example 4.11. kdisc.cpp Contains the Class Definition for the <TT
CLASS="literal"
>KDisc</TT
> Widget</B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;1: #include &lt;qpainter.h&gt;
   3&nbsp;2:
   4&nbsp;3: #include "kdisc.h"
   5&nbsp;4:
   6&nbsp;5: KDisc::KDisc (QWidget *parent, const char *name=0) :
   7&nbsp;6:   QWidget (parent, name)
   8&nbsp;7: {
   9&nbsp;8:
  10&nbsp;9:   discposition = QPoint (0, 0);
  11&nbsp;10:   setMouseTracking (true);
  12&nbsp;11: }
  13&nbsp;12:
  14&nbsp;13: void
  15&nbsp;14: KDisc::paintEvent (QPaintEvent *)
  16&nbsp;15: {
  17&nbsp;16:   QPainter painter (this);
  18&nbsp;17:
  19&nbsp;18:   painter.setPen ( QPen (Qt::black, 3) );
  20&nbsp;19:   painter.setBrush ( QBrush (Qt::blue, Qt::Dense4Pattern) );
  21&nbsp;20:
  22&nbsp;21:   painter.drawEllipse (discposition.x(), discposition.y(),
  23&nbsp;22:                25, 25);
  24&nbsp;23: }
  25&nbsp;24:
  26&nbsp;25: void
  27&nbsp;26: KDisc::mouseMoveEvent (QMouseEvent *qmouseevent)
  28&nbsp;27: {
  29&nbsp;28: 
  30&nbsp;29:   if (qmouseevent-&gt;state()==Qt::LeftButton)
  31&nbsp;30:     {
  32&nbsp;31:       discposition = qmouseevent-&gt;pos();
  33&nbsp;32:       update();
  34&nbsp;33:     }
  35&nbsp;34:
  36&nbsp;35: }
  37&nbsp;36:
  38&nbsp;37: void
  39&nbsp;38: KDisc::keyPressEvent (QKeyEvent *qkeyevent)
  40&nbsp;39: {
  41&nbsp;40:
  42&nbsp;41:   switch (qkeyevent-&gt;key())
  43&nbsp;42:     {
  44&nbsp;43:     case Qt::Key_Left:
  45&nbsp;44:       discposition = QPoint ( discposition.x()-10,
  46&nbsp;45:                   discposition.y() );
  47&nbsp;46:       update();
  48&nbsp;47:       break;
  49&nbsp;48:     case Qt::Key_Right:
  50&nbsp;49:       discposition = QPoint ( discposition.x()+10,
  51&nbsp;50:                   discposition.y() );
  52&nbsp;51:       update();
  53&nbsp;52:       break;
  54&nbsp;53:     case Qt::Key_Up:
  55&nbsp;54:       discposition = QPoint ( discposition.x(),
  56&nbsp;55:                   discposition.y()-10 );
  57&nbsp;56:       update();
  58&nbsp;57:       break;
  59&nbsp;58:     case Qt::Key_Down:
  60&nbsp;59:       discposition = QPoint ( discposition.x(),
  61&nbsp;60:                   discposition.y()+10 );
  62&nbsp;61:       update();
  63&nbsp;62:       break;
  64&nbsp;63:     default:
  65&nbsp;64:       qkeyevent-&gt;ignore();
  66&nbsp;65:     }
  67&nbsp;66:
  68&nbsp;67: }</PRE
></TD
></TR
></TABLE
><HR/></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch04lev2sec13"
>4.4.1. Mouse Presses</A
></H2
><P
>In <TT
CLASS="literal"
>KXOSquare</TT
> you processed a mouse click with <TT
CLASS="literal"
>mouseReleaseEvent()</TT
>. The <TT
CLASS="literal"
>QMouseEvent::button()</TT
> method tells which button was clicked. The reason you chose <TT
CLASS="literal"
>mouseReleaseEvent()</TT
> and not <TT
CLASS="literal"
>mousePressEvent()</TT
> is because you shouldn't consider a user's mouse click to be registered until the mouse button is released. This way, the user will have a chance to change his or her mind. This behavior is common practice. Try clicking pushbuttons on your screen. Notice that no action occurs until the mouse button is released.</P
><P
>In <TT
CLASS="literal"
>mouseMoveEvent()</TT
> you test <TT
CLASS="literal"
>QMouseEvent::state()</TT
>, not <TT
CLASS="literal"
>QMouseEvent::button()</TT
> to check the state of the mouse. If the left button is being held down, the disc is moved so that it is centered under the mouse cursor (see line 31 of <A
HREF="ch04lev1sec4.html#ch04list11"
>Listing 4.11</A
>):</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;  discposition = qmouseevent-&gt;pos();</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>Then <TT
CLASS="literal"
>update()</TT
> is called to clear the widget, erase the disc, and call <TT
CLASS="literal"
>paintEvent()</TT
> to redraw the disc in its new position.</P
><P
>In <TT
CLASS="literal"
>KDisc::KDisc</TT
> (see line 10 of <A
HREF="ch04lev1sec4.html#ch04list11"
>Listing 4.11</A
>) you call</P
><DIV
CLASS="informalexample"
><HR/><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;  setMouseTracking (true);</PRE
></TD
></TR
></TABLE
><HR/></DIV
><P
>This informs Qt that you want to receive mouse-move events. Because the mouse can move around quite a bit, this can generate lots of events. Generating and passing these events takes time; therefore, by default, they are not generated. For this widget, you need those events to make your UI function as you have designed it.</P
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch04lev2sec13"/></TD
></TR
><ANNOTATION
NAME="ch04lev2sec13"
TITLE="Mouse Presses"/></TABLE
></DIV
><DIV
CLASS="section"
><TABLE
WIDTH="100%"
CELLPADDING="0"
CELLSPACING="0"
BORDER="0"
ALIGN="CENTER"
><TR
><TD
WIDTH="90%"
><H2
CLASS="section"
><A
NAME="ch04lev2sec14"
>4.4.2. Keystrokes</A
></H2
><P
><TT
CLASS="literal"
>QKeyEvent::key()</TT
> returns a code telling which key was pressed. The constants, such as <TT
CLASS="literal"
>Qt::Key_Left</TT
>, <TT
CLASS="literal"
>Qt::Key_Right</TT
>, and so on, are defined in qnamespace.h. (qnamespace.h is included by qwindowdefs.h, which is, in turn, included by qwidget.h. Thus it is enough to include qwidget.h if you want to process keypresses.)</P
><P
>You call <TT
CLASS="literal"
>QKeyEvent::ignore()</TT
> when you don't process the key press. This lets Qt know to pass the keystroke on to our parent widget.</P
><DIV
CLASS="note"
><TABLE
CLASS="note"
WIDTH="100%"
BORDER="0"
><TR
><TD
WIDTH="25"
ALIGN="CENTER"
VALIGN="TOP"
><IMG
SRC="note.png"
HSPACE="5"
ALT="Note"/></TD
><TD
ALIGN="LEFT"
VALIGN="TOP"
><P
>Don't return from a keystroke event handler without calling <TT
CLASS="literal"
>QKeyEvent::ignore()</TT
> if you don't process the passed keystroke.</P
></TD
></TR
></TABLE
></DIV
><P
>Next, in <A
HREF="ch04lev1sec4.html#ch04list12"
>Listing 4.12</A
>, is a <TT
CLASS="literal"
>main()</TT
> function that you can use to create an executable that creates and shows the widget.</P
><DIV
CLASS="example"
><HR/><A
NAME="ch04list12"
></A
><P
><B
>Example 4.12. main.cpp Contains a <TT
CLASS="literal"
>main()</TT
> Function Suitable for Testing <TT
CLASS="literal"
>KDisc</TT
></B
></P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="programlisting"
>   1&nbsp;
   2&nbsp;1: #include &lt;kapp.h&gt;
   3&nbsp;2:
   4&nbsp;3: #include "kdisc.h"
   5&nbsp;4:
   6&nbsp;5: int
   7&nbsp;6: main (int argc, char *argv[])
   8&nbsp;7: {
   9&nbsp;8:   KApplication kapplication (argc, argv, "kdisctest");
  10&nbsp;9:   KDisc *kdisc = new KDisc (0);
  11&nbsp;10:
  12&nbsp;11:   kapplication.setMainWidget (kdisc);
  13&nbsp;12:
  14&nbsp;13:   kdisc-&gt;show();
  15&nbsp;14:   return kapplication.exec();
  16&nbsp;15: }</PRE
></TD
></TR
></TABLE
><HR/></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch04lev2sec14"/></TD
></TR
><ANNOTATION
NAME="ch04lev2sec14"
TITLE="Keystrokes"/></TABLE
></DIV
></TD
><TD
WIDTH="10%"
VALIGN="BOTTOM"
ALIGN="CENTER"
><ANNMARK
NAME="ch04lev1sec4"/></TD
></TR
><ANNOTATION
NAME="ch04lev1sec4"
TITLE="Handling User Input"/></TABLE
></DIV
><DIV
ALIGN="RIGHT"
CLASS="NAVBAR"
><P
><A
HREF="ch04lev1sec3.html"
>Prev</A
> <A
HREF="ch04lev1sec5.html"
>Next</A
> <A
HREF="index.html"
>Table of Contents</A
></P
></DIV
><HR
WIDTH="100%"
SIZE="2"
ALIGN="CENTER"
NOSHADE="NOSHADE"/></BODY
></HTML
>