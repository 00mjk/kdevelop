<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Example of Parsing</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_177.html">previous</A>, <A HREF="libc_179.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC185" HREF="libc_toc.html#TOC185">Example of Parsing a Template String</A></H3>

<P>
Here is an example of decoding argument types for a format string.  We
assume this is part of an interpreter which contains arguments of type
<CODE>NUMBER</CODE>, <CODE>CHAR</CODE>, <CODE>STRING</CODE> and <CODE>STRUCTURE</CODE> (and
perhaps others which are not valid here).

</P>

<PRE>
/* Test whether the <VAR>nargs</VAR> specified objects
   in the vector <VAR>args</VAR> are valid
   for the format string <VAR>format</VAR>:
   if so, return 1.
   If not, return 0 after printing an error message.  */

int
validate_args (char *format, int nargs, OBJECT *args)
{
  int *argtypes;
  int nwanted;

  /* Get the information about the arguments.
     Each conversion specification must be at least two characters
     long, so there cannot be more specifications than half the
     length of the string.  */

  argtypes = (int *) alloca (strlen (format) / 2 * sizeof (int));
  nwanted = parse_printf_format (string, nelts, argtypes);

  /* Check the number of arguments.  */
  if (nwanted &#62; nargs)
    {
      error ("too few arguments (at least %d required)", nwanted);
      return 0;
    }

  /* Check the C type wanted for each argument
     and see if the object given is suitable.  */
  for (i = 0; i &#60; nwanted; i++)
    {
      int wanted;

      if (argtypes[i] &#38; PA_FLAG_PTR)
        wanted = STRUCTURE;
      else
        switch (argtypes[i] &#38; ~PA_FLAG_MASK)
          {
          case PA_INT:
          case PA_FLOAT:
          case PA_DOUBLE:
            wanted = NUMBER;
            break;
          case PA_CHAR:
            wanted = CHAR;
            break;
          case PA_STRING:
            wanted = STRING;
            break;
          case PA_POINTER:
            wanted = STRUCTURE;
            break;
          }
      if (TYPE (args[i]) != wanted)
        {
          error ("type mismatch for arg number %d", i);
          return 0;
        }
    }
  return 1;
}
</PRE>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_177.html">previous</A>, <A HREF="libc_179.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
