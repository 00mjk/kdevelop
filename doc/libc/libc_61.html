<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Using Wide Char Classes</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_60.html">previous</A>, <A HREF="libc_62.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC61" HREF="libc_toc.html#TOC61">Notes on using the wide character classes</A></H2>

<P>
The first note is probably nothing astonishing but still occasionally a
cause of problems.  The <CODE>isw<VAR>XXX</VAR></CODE> functions can be implemented
using macros and in fact, the GNU C library does this.  They are still
available as real functions but when the <TT>`wctype.h'</TT> header is
included the macros will be used.  This is nothing new compared to the
<CODE>char</CODE> type versions of these functions.

</P>
<P>
The second notes covers something which is new.  It can be best
illustrated by a (real-world) example.  The first piece of code is an
excerpt from the original code.  It is truncated a bit but the intention
should be clear.

</P>

<PRE>
int
is_in_class (int c, const char *class)
{
  if (strcmp (class, "alnum") == 0)
    return isalnum (c);
  if (strcmp (class, "alpha") == 0)
    return isalpha (c);
  if (strcmp (class, "cntrl") == 0)
    return iscntrl (c);
  ...
  return 0;
}
</PRE>

<P>
Now with the <CODE>wctype</CODE> and <CODE>iswctype</CODE> one could avoid the
<CODE>if</CODE> cascades.  But rewriting the code as follows is wrong:

</P>

<PRE>
int
is_in_class (int c, const char *class)
{
  wctype_t desc = wctype (class);
  return desc ? iswctype ((wint_t) c, desc) : 0;
}
</PRE>

<P>
The problem is that it is not guarateed that the wide character
representation of a single-byte character can be found using casting.
In fact, usually this fails miserably.  The correct solution for this
problem is to write the code as follows:

</P>

<PRE>
int
is_in_class (int c, const char *class)
{
  wctype_t desc = wctype (class);
  return desc ? iswctype (btowc (c), desc) : 0;
}
</PRE>

<P>
See section <A HREF="libc_82.html#SEC82">Converting Single Characters</A>, for more information on <CODE>btowc</CODE>.
Please note that this change probably does not improve the performance
of the program a lot since the <CODE>wctype</CODE> function still has to make
the string comparisons.  But it gets really interesting if the
<CODE>is_in_class</CODE> function would be called more than once using the
same class name.  In this case the variable <VAR>desc</VAR> could be computed
once and reused for all the calls.  Therefore the above form of the
function is probably not the final one.

</P>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_60.html">previous</A>, <A HREF="libc_62.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
