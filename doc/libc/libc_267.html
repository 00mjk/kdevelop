<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Setting Permissions</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_266.html">previous</A>, <A HREF="libc_268.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC274" HREF="libc_toc.html#TOC274">Assigning File Permissions</A></H3>

<P>
<A NAME="IDX1322"></A>
<A NAME="IDX1323"></A>
The primitive functions for creating files (for example, <CODE>open</CODE> or
<CODE>mkdir</CODE>) take a <VAR>mode</VAR> argument, which specifies the file
permissions for the newly created file.  But the specified mode is
modified by the process's <STRONG>file creation mask</STRONG>, or <STRONG>umask</STRONG>,
before it is used.

</P>
<P>
The bits that are set in the file creation mask identify permissions
that are always to be disabled for newly created files.  For example, if
you set all the "other" access bits in the mask, then newly created
files are not accessible at all to processes in the "other"
category, even if the <VAR>mode</VAR> argument specified to the creation
function would permit such access.  In other words, the file creation
mask is the complement of the ordinary access permissions you want to
grant.

</P>
<P>
Programs that create files typically specify a <VAR>mode</VAR> argument that
includes all the permissions that make sense for the particular file.
For an ordinary file, this is typically read and write permission for
all classes of users.  These permissions are then restricted as
specified by the individual user's own file creation mask.

</P>
<P>
<A NAME="IDX1324"></A>
To change the permission of an existing file given its name, call
<CODE>chmod</CODE>.  This function ignores the file creation mask; it uses
exactly the specified permission bits.

</P>
<P>
<A NAME="IDX1325"></A>
In normal use, the file creation mask is initialized in the user's login
shell (using the <CODE>umask</CODE> shell command), and inherited by all
subprocesses.  Application programs normally don't need to worry about
the file creation mask.  It will do automatically what it is supposed to
do.

</P>
<P>
When your program should create a file and bypass the umask for its
access permissions, the easiest way to do this is to use <CODE>fchmod</CODE>
after opening the file, rather than changing the umask.

</P>
<P>
In fact, changing the umask is usually done only by shells.  They use
the <CODE>umask</CODE> function.

</P>
<P>
The functions in this section are declared in <TT>`sys/stat.h'</TT>.
<A NAME="IDX1326"></A>

</P>
<P>
<DL>
<DT><U>Function:</U> mode_t <B>umask</B> <I>(mode_t <VAR>mask</VAR>)</I>
<DD><A NAME="IDX1327"></A>
The <CODE>umask</CODE> function sets the file creation mask of the current
process to <VAR>mask</VAR>, and returns the previous value of the file
creation mask.

</P>
<P>
Here is an example showing how to read the mask with <CODE>umask</CODE>
without changing it permanently:

</P>

<PRE>
mode_t
read_umask (void)
{
  mode_t mask = umask (0);
  umask (mask);
  return mask;
}
</PRE>

<P>
However, it is better to use <CODE>getumask</CODE> if you just want to read
the mask value, because that is reentrant (at least if you use the GNU
operating system).
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> mode_t <B>getumask</B> <I>(void)</I>
<DD><A NAME="IDX1328"></A>
Return the current value of the file creation mask for the current
process.  This function is a GNU extension.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>chmod</B> <I>(const char *<VAR>filename</VAR>, mode_t <VAR>mode</VAR>)</I>
<DD><A NAME="IDX1329"></A>
The <CODE>chmod</CODE> function sets the access permission bits for the file
named by <VAR>filename</VAR> to <VAR>mode</VAR>.

</P>
<P>
If the <VAR>filename</VAR> names a symbolic link, <CODE>chmod</CODE> changes the
permission of the file pointed to by the link, not those of the link
itself.

</P>
<P>
This function returns <CODE>0</CODE> if successful and <CODE>-1</CODE> if not.  In
addition to the usual file name errors (see section <A HREF="libc_153.html#SEC160">File Name Errors</A>), the following <CODE>errno</CODE> error conditions are defined for
this function:

</P>
<DL COMPACT>

<DT><CODE>ENOENT</CODE>
<DD>
The named file doesn't exist.

<DT><CODE>EPERM</CODE>
<DD>
This process does not have permission to change the access permission of
this file.  Only the file's owner (as judged by the effective user ID of
the process) or a privileged user can change them.

<DT><CODE>EROFS</CODE>
<DD>
The file resides on a read-only file system.

<DT><CODE>EFTYPE</CODE>
<DD>
<VAR>mode</VAR> has the <CODE>S_ISVTX</CODE> bit (the "sticky bit") set,
and the named file is not a directory.  Some systems do not allow setting the
sticky bit on non-directory files, and some do (and only some of those
assign a useful meaning to the bit for non-directory files).

You only get <CODE>EFTYPE</CODE> on systems where the sticky bit has no useful
meaning for non-directory files, so it is always safe to just clear the
bit in <VAR>mode</VAR> and call <CODE>chmod</CODE> again.  See section <A HREF="libc_265.html#SEC272">The Mode Bits for Access Permission</A>,
for full details on the sticky bit.
</DL>
</DL>

<P>
<DL>
<DT><U>Function:</U> int <B>fchmod</B> <I>(int <VAR>filedes</VAR>, int <VAR>mode</VAR>)</I>
<DD><A NAME="IDX1330"></A>
This is like <CODE>chmod</CODE>, except that it changes the permissions of
the file currently open via descriptor <VAR>filedes</VAR>.

</P>
<P>
The return value from <CODE>fchmod</CODE> is <CODE>0</CODE> on success and <CODE>-1</CODE>
on failure.  The following <CODE>errno</CODE> error codes are defined for this
function:

</P>
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The <VAR>filedes</VAR> argument is not a valid file descriptor.

<DT><CODE>EINVAL</CODE>
<DD>
The <VAR>filedes</VAR> argument corresponds to a pipe or socket, or something
else that doesn't really have access permissions.

<DT><CODE>EPERM</CODE>
<DD>
This process does not have permission to change the access permission of
this file.  Only the file's owner (as judged by the effective user ID of
the process) or a privileged user can change them.

<DT><CODE>EROFS</CODE>
<DD>
The file resides on a read-only file system.
</DL>
</DL>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_266.html">previous</A>, <A HREF="libc_268.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
