<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Scanning All Users</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_570.html">previous</A>, <A HREF="libc_572.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC579" HREF="libc_toc.html#TOC579">Scanning the List of All Users</A></H3>
<P>
<A NAME="IDX3002"></A>

</P>
<P>
This section explains how a program can read the list of all users in
the system, one user at a time.  The functions described here are
declared in <TT>`pwd.h'</TT>.

</P>
<P>
You can use the <CODE>fgetpwent</CODE> function to read user entries from a
particular file.

</P>
<P>
<DL>
<DT><U>Function:</U> struct passwd * <B>fgetpwent</B> <I>(FILE *<VAR>stream</VAR>)</I>
<DD><A NAME="IDX3003"></A>
This function reads the next user entry from <VAR>stream</VAR> and returns a
pointer to the entry.  The structure is statically allocated and is
rewritten on subsequent calls to <CODE>fgetpwent</CODE>.  You must copy the
contents of the structure if you wish to save the information.

</P>
<P>
The stream must correspond to a file in the same format as the standard
password database file.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>fgetpwent_r</B> <I>(FILE *<VAR>stream</VAR>, struct passwd *<VAR>result_buf</VAR>, char *<VAR>buffer</VAR>, size_t <VAR>buflen</VAR>, struct passwd **<VAR>result</VAR>)</I>
<DD><A NAME="IDX3004"></A>
This function is similar to <CODE>fgetpwent</CODE> in that it reads the next
user entry from <VAR>stream</VAR>.  But the result is returned in the
structure pointed to by <VAR>result_buf</VAR>.  The
first <VAR>buflen</VAR> bytes of the additional buffer pointed to by
<VAR>buffer</VAR> are used to contain additional information, normally
strings which are pointed to by the elements of the result structure.

</P>
<P>
The stream must correspond to a file in the same format as the standard
password database file.

</P>
<P>
If the function returns zero <VAR>result</VAR> points to the structure with
the wanted data (normally this is in <VAR>result_buf</VAR>).  If errors
occurred the return value is nonzero and <VAR>result</VAR> contains a null
pointer.
</DL>

</P>
<P>
The way to scan all the entries in the user database is with
<CODE>setpwent</CODE>, <CODE>getpwent</CODE>, and <CODE>endpwent</CODE>.

</P>
<P>
<DL>
<DT><U>Function:</U> void <B>setpwent</B> <I>(void)</I>
<DD><A NAME="IDX3005"></A>
This function initializes a stream which <CODE>getpwent</CODE> and
<CODE>getpwent_r</CODE> use to read the user database.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> struct passwd * <B>getpwent</B> <I>(void)</I>
<DD><A NAME="IDX3006"></A>
The <CODE>getpwent</CODE> function reads the next entry from the stream
initialized by <CODE>setpwent</CODE>.  It returns a pointer to the entry.  The
structure is statically allocated and is rewritten on subsequent calls
to <CODE>getpwent</CODE>.  You must copy the contents of the structure if you
wish to save the information.

</P>
<P>
A null pointer is returned when no more entries are available.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>getpwent_r</B> <I>(struct passwd *<VAR>result_buf</VAR>, char *<VAR>buffer</VAR>, int <VAR>buflen</VAR>, struct passwd **<VAR>result</VAR>)</I>
<DD><A NAME="IDX3007"></A>
This function is similar to <CODE>getpwent</CODE> in that it returns the next
entry from the stream initialized by <CODE>setpwent</CODE>.  Like
<CODE>fgetpwent_r</CODE>, it uses the user-supplied buffers in
<VAR>result_buf</VAR> and <VAR>buffer</VAR> to return the information requested.

</P>
<P>
The return values are the same as for <CODE>fgetpwent_r</CODE>.

</P>
</DL>

<P>
<DL>
<DT><U>Function:</U> void <B>endpwent</B> <I>(void)</I>
<DD><A NAME="IDX3008"></A>
This function closes the internal stream used by <CODE>getpwent</CODE> or
<CODE>getpwent_r</CODE>.
</DL>

</P>
<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_570.html">previous</A>, <A HREF="libc_572.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
