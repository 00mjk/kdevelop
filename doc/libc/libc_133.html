<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - POSIX Regexp Compilation</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_132.html">previous</A>, <A HREF="libc_134.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC140" HREF="libc_toc.html#TOC140">POSIX Regular Expression Compilation</A></H3>

<P>
Before you can actually match a regular expression, you must
<STRONG>compile</STRONG> it.  This is not true compilation--it produces a special
data structure, not machine instructions.  But it is like ordinary
compilation in that its purpose is to enable you to "execute" the
pattern fast.  (See section <A HREF="libc_135.html#SEC142">Matching a Compiled POSIX Regular Expression</A>, for how to use the
compiled regular expression for matching.)

</P>
<P>
There is a special data type for compiled regular expressions:

</P>
<P>
<DL>
<DT><U>Data Type:</U> <B>regex_t</B>
<DD><A NAME="IDX728"></A>
This type of object holds a compiled regular expression.
It is actually a structure.  It has just one field that your programs
should look at:

</P>
<DL COMPACT>

<DT><CODE>re_nsub</CODE>
<DD>
This field holds the number of parenthetical subexpressions in the
regular expression that was compiled.
</DL>

<P>
There are several other fields, but we don't describe them here, because
only the functions in the library should use them.
</DL>

</P>
<P>
After you create a <CODE>regex_t</CODE> object, you can compile a regular
expression into it by calling <CODE>regcomp</CODE>.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>regcomp</B> <I>(regex_t *<VAR>compiled</VAR>, const char *<VAR>pattern</VAR>, int <VAR>cflags</VAR>)</I>
<DD><A NAME="IDX729"></A>
The function <CODE>regcomp</CODE> "compiles" a regular expression into a
data structure that you can use with <CODE>regexec</CODE> to match against a
string.  The compiled regular expression format is designed for
efficient matching.  <CODE>regcomp</CODE> stores it into <CODE>*<VAR>compiled</VAR></CODE>.

</P>
<P>
It's up to you to allocate an object of type <CODE>regex_t</CODE> and pass its
address to <CODE>regcomp</CODE>.

</P>
<P>
The argument <VAR>cflags</VAR> lets you specify various options that control
the syntax and semantics of regular expressions.  See section <A HREF="libc_134.html#SEC141">Flags for POSIX Regular Expressions</A>.

</P>
<P>
If you use the flag <CODE>REG_NOSUB</CODE>, then <CODE>regcomp</CODE> omits from
the compiled regular expression the information necessary to record
how subexpressions actually match.  In this case, you might as well
pass <CODE>0</CODE> for the <VAR>matchptr</VAR> and <VAR>nmatch</VAR> arguments when
you call <CODE>regexec</CODE>.

</P>
<P>
If you don't use <CODE>REG_NOSUB</CODE>, then the compiled regular expression
does have the capacity to record how subexpressions match.  Also,
<CODE>regcomp</CODE> tells you how many subexpressions <VAR>pattern</VAR> has, by
storing the number in <CODE><VAR>compiled</VAR>-&#62;re_nsub</CODE>.  You can use that
value to decide how long an array to allocate to hold information about
subexpression matches.

</P>
<P>
<CODE>regcomp</CODE> returns <CODE>0</CODE> if it succeeds in compiling the regular
expression; otherwise, it returns a nonzero error code (see the table
below).  You can use <CODE>regerror</CODE> to produce an error message string
describing the reason for a nonzero value; see section <A HREF="libc_138.html#SEC145">POSIX Regexp Matching Cleanup</A>.

</P>
</DL>

<P>
Here are the possible nonzero values that <CODE>regcomp</CODE> can return:

</P>
<DL COMPACT>

<DT><CODE>REG_BADBR</CODE>
<DD>
There was an invalid <SAMP>`\{...\}'</SAMP> construct in the regular
expression.  A valid <SAMP>`\{...\}'</SAMP> construct must contain either
a single number, or two numbers in increasing order separated by a
comma.

<DT><CODE>REG_BADPAT</CODE>
<DD>
There was a syntax error in the regular expression.

<DT><CODE>REG_BADRPT</CODE>
<DD>
A repetition operator such as <SAMP>`?'</SAMP> or <SAMP>`*'</SAMP> appeared in a bad
position (with no preceding subexpression to act on).

<DT><CODE>REG_ECOLLATE</CODE>
<DD>
The regular expression referred to an invalid collating element (one not
defined in the current locale for string collation).  See section <A HREF="libc_97.html#SEC101">Categories of Activities that Locales Affect</A>.

<DT><CODE>REG_ECTYPE</CODE>
<DD>
The regular expression referred to an invalid character class name.

<DT><CODE>REG_EESCAPE</CODE>
<DD>
The regular expression ended with <SAMP>`\'</SAMP>.

<DT><CODE>REG_ESUBREG</CODE>
<DD>
There was an invalid number in the <SAMP>`\<VAR>digit</VAR>'</SAMP> construct.

<DT><CODE>REG_EBRACK</CODE>
<DD>
There were unbalanced square brackets in the regular expression.

<DT><CODE>REG_EPAREN</CODE>
<DD>
An extended regular expression had unbalanced parentheses,
or a basic regular expression had unbalanced <SAMP>`\('</SAMP> and <SAMP>`\)'</SAMP>.

<DT><CODE>REG_EBRACE</CODE>
<DD>
The regular expression had unbalanced <SAMP>`\{'</SAMP> and <SAMP>`\}'</SAMP>.

<DT><CODE>REG_ERANGE</CODE>
<DD>
One of the endpoints in a range expression was invalid.

<DT><CODE>REG_ESPACE</CODE>
<DD>
<CODE>regcomp</CODE> ran out of memory.
</DL>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_132.html">previous</A>, <A HREF="libc_134.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
