<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Tracing malloc</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_35.html">previous</A>, <A HREF="libc_37.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC36" HREF="libc_toc.html#TOC36">How to install the tracing functionality</A></H3>

<P>
<DL>
<DT><U>Function:</U> void <B>mtrace</B> <I>(void)</I>
<DD><A NAME="IDX256"></A>
When the <CODE>mtrace</CODE> function is called it looks for an environment
variable named <CODE>MALLOC_TRACE</CODE>.  This variable is supposed to
contain a valid file name.  The user must have write access.  If the
file already exists it is truncated.  If the environment variable is not
set or it does not name a valid file which can be opened for writing
nothing is done.  The behaviour of <CODE>malloc</CODE> etc. is not changed.
For obvious reasons this also happens if the application is install SUID
or SGID.

</P>
<P>
If the named file is successfully opened <CODE>mtrace</CODE> installs special
handlers for the functions <CODE>malloc</CODE>, <CODE>realloc</CODE>, and
<CODE>free</CODE> (see section <A HREF="libc_32.html#SEC32">Storage Allocation Hooks</A>).  From now on all uses of these
functions are traced and protocolled into the file.  There is now of
course a speed penalty for all calls to the traced functions so that the
tracing should not be enabled during their normal use.

</P>
<P>
This function is a GNU extension and generally not available on other
systems.  The prototype can be found in <TT>`mcheck.h'</TT>.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> void <B>muntrace</B> <I>(void)</I>
<DD><A NAME="IDX257"></A>
The <CODE>muntrace</CODE> function can be called after <CODE>mtrace</CODE> was used
to enable tracing the <CODE>malloc</CODE> calls.  If no (successful) call of
<CODE>mtrace</CODE> was made <CODE>muntrace</CODE> does nothing.

</P>
<P>
Otherwise it deinstalls the handlers for <CODE>malloc</CODE>, <CODE>realloc</CODE>,
and <CODE>free</CODE> and then closes the protocol file.  No calls are
protocolled anymore and the programs runs again with the full speed.

</P>
<P>
This function is a GNU extension and generally not available on other
systems.  The prototype can be found in <TT>`mcheck.h'</TT>.
</DL>

</P>
<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_35.html">previous</A>, <A HREF="libc_37.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
