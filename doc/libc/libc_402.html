<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Low-Level Time String Parsing</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_401.html">previous</A>, <A HREF="libc_403.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H4><A NAME="SEC409" HREF="libc_toc.html#TOC409">Interpret string according to given format</A></H4>

<P>
The first function is a rather low-level interface.  It is nevertheless
frequently used in user programs since it is better known.  Its
implementation and the interface though is heavily influenced by the
<CODE>getdate</CODE> function which is defined and implemented in terms of
calls to <CODE>strptime</CODE>.

</P>
<P>
<DL>
<DT><U>Function:</U> char * <B>strptime</B> <I>(const char *<VAR>s</VAR>, const char *<VAR>fmt</VAR>, struct tm *<VAR>tp</VAR>)</I>
<DD><A NAME="IDX2333"></A>
The <CODE>strptime</CODE> function parses the input string <VAR>s</VAR> according
to the format string <VAR>fmt</VAR> and stores the found values in the
structure <VAR>tp</VAR>.

</P>
<P>
The input string can be retrieved in any way.  It does not matter
whether it was generated by a <CODE>strftime</CODE> call or made up directly
by a program.  It is also not necessary that the content is in any
human-recognizable format.  I.e., it is OK if a date is written like
<CODE>"02:1999:9"</CODE> which is not understandable without context.  As long
the format string <VAR>fmt</VAR> matches the format of the input string
everything goes.

</P>
<P>
The format string consists of the same components as the format string
for the <CODE>strftime</CODE> function.  The only difference is that the flags
<CODE>_</CODE>, <CODE>-</CODE>, <CODE>0</CODE>, and <CODE>^</CODE> are not allowed.
Several of the formats which <CODE>strftime</CODE> handled differently do the
same work in <CODE>strptime</CODE> since differences like case of the output
do not matter.  For symmetry reasons all formats are supported, though.

</P>
<P>
The modifiers <CODE>E</CODE> and <CODE>O</CODE> are also allowed everywhere the
<CODE>strftime</CODE> function allows them.

</P>
<P>
The formats are:

</P>
<DL COMPACT>

<DT><CODE>%a</CODE>
<DD>
<DT><CODE>%A</CODE>
<DD>
The weekday name according to the current locale, in abbreviated form or
the full name.

<DT><CODE>%b</CODE>
<DD>
<DT><CODE>%B</CODE>
<DD>
<DT><CODE>%h</CODE>
<DD>
The month name according to the current locale, in abbreviated form or
the full name.

<DT><CODE>%c</CODE>
<DD>
The date and time representation for the current locale.

<DT><CODE>%Ec</CODE>
<DD>
Like <CODE>%c</CODE> but the locale's alternative date and time format is used.

<DT><CODE>%C</CODE>
<DD>
The century of the year.

It makes sense to use this format only if the format string also
contains the <CODE>%y</CODE> format.

<DT><CODE>%EC</CODE>
<DD>
The locale's representation of the period.

Unlike <CODE>%C</CODE> it makes sometimes sense to use this format since in
some cultures it is required to specify years relative to periods
instead of using the Gregorian years.

<DT><CODE>%d</CODE>
<DD>
<DT><CODE>%e</CODE>
<DD>
The day of the month as a decimal number (range <CODE>1</CODE> through <CODE>31</CODE>).
Leading zeroes are permitted but not required.

<DT><CODE>%Od</CODE>
<DD>
<DT><CODE>%Oe</CODE>
<DD>
Same as <CODE>%d</CODE> but the locale's alternative numeric symbols are used.

Leading zeroes are permitted but not required.

<DT><CODE>%D</CODE>
<DD>
Equivalent to the use of <CODE>%m/%d/%y</CODE> in this place.

<DT><CODE>%F</CODE>
<DD>
Equivalent to the use of <CODE>%Y-%m-%d</CODE> which is the ISO 8601 date
format.

This is a GNU extension following an ISO C 9X extension to
<CODE>strftime</CODE>.

<DT><CODE>%g</CODE>
<DD>
The year corresponding to the ISO week number, but without the century
(range <CODE>00</CODE> through <CODE>99</CODE>).

<EM>Note:</EM> This is not really implemented currently.  The format is
recognized, input is consumed but no field in <VAR>tm</VAR> is set.

This format is a GNU extension following a GNU extension of <CODE>strftime</CODE>.

<DT><CODE>%G</CODE>
<DD>
The year corresponding to the ISO week number.

<EM>Note:</EM> This is not really implemented currently.  The format is
recognized, input is consumed but no field in <VAR>tm</VAR> is set.

This format is a GNU extension following a GNU extension of <CODE>strftime</CODE>.

<DT><CODE>%H</CODE>
<DD>
<DT><CODE>%k</CODE>
<DD>
The hour as a decimal number, using a 24-hour clock (range <CODE>00</CODE> through
<CODE>23</CODE>).

<CODE>%k</CODE> is a GNU extension following a GNU extension of <CODE>strftime</CODE>.

<DT><CODE>%OH</CODE>
<DD>
Same as <CODE>%H</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%I</CODE>
<DD>
<DT><CODE>%l</CODE>
<DD>
The hour as a decimal number, using a 12-hour clock (range <CODE>01</CODE> through
<CODE>12</CODE>).

<CODE>%l</CODE> is a GNU extension following a GNU extension of <CODE>strftime</CODE>.

<DT><CODE>%OI</CODE>
<DD>
Same as <CODE>%I</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%j</CODE>
<DD>
The day of the year as a decimal number (range <CODE>1</CODE> through <CODE>366</CODE>).

Leading zeroes are permitted but not required.

<DT><CODE>%m</CODE>
<DD>
The month as a decimal number (range <CODE>1</CODE> through <CODE>12</CODE>).

Leading zeroes are permitted but not required.

<DT><CODE>%Om</CODE>
<DD>
Same as <CODE>%m</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%M</CODE>
<DD>
The minute as a decimal number (range <CODE>0</CODE> through <CODE>59</CODE>).

Leading zeroes are permitted but not required.

<DT><CODE>%OM</CODE>
<DD>
Same as <CODE>%M</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%n</CODE>
<DD>
<DT><CODE>%t</CODE>
<DD>
Matches any white space.

<DT><CODE>%p</CODE>
<DD>
<DT><CODE>%P</CODE>
<DD>
The locale-dependent equivalent to <SAMP>`AM'</SAMP> or <SAMP>`PM'</SAMP>.

This format is not useful unless <CODE>%I</CODE> or <CODE>%l</CODE> is also used.
Another complication is that the locale might not define these values at
all and therefore the conversion fails.

<CODE>%P</CODE> is a GNU extension following a GNU extension to <CODE>strftime</CODE>.

<DT><CODE>%r</CODE>
<DD>
The complete time using the AM/PM format of the current locale.

A complication is that the locale might not define this format at all
and therefore the conversion fails.

<DT><CODE>%R</CODE>
<DD>
The hour and minute in decimal numbers using the format <CODE>%H:%M</CODE>.

<CODE>%R</CODE> is a GNU extension following a GNU extension to <CODE>strftime</CODE>.

<DT><CODE>%s</CODE>
<DD>
The number of seconds since the epoch, i.e., since 1970-01-01 00:00:00 UTC.
Leap seconds are not counted unless leap second support is available.

<CODE>%s</CODE> is a GNU extension following a GNU extension to <CODE>strftime</CODE>.

<DT><CODE>%S</CODE>
<DD>
The seconds as a decimal number (range <CODE>0</CODE> through <CODE>61</CODE>).

Leading zeroes are permitted but not required.

Please note the nonsense with <CODE>61</CODE> being allowed.  This is what the
Unix specification says.  They followed the stupid decision once made to
allow double leap seconds.  These do not exist but the myth persists.

<DT><CODE>%OS</CODE>
<DD>
Same as <CODE>%S</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%T</CODE>
<DD>
Equivalent to the use of <CODE>%H:%M:%S</CODE> in this place.

<DT><CODE>%u</CODE>
<DD>
The day of the week as a decimal number (range <CODE>1</CODE> through
<CODE>7</CODE>), Monday being <CODE>1</CODE>.

Leading zeroes are permitted but not required.

<EM>Note:</EM> This is not really implemented currently.  The format is
recognized, input is consumed but no field in <VAR>tm</VAR> is set.

<DT><CODE>%U</CODE>
<DD>
The week number of the current year as a decimal number (range <CODE>0</CODE>
through <CODE>53</CODE>).

Leading zeroes are permitted but not required.

<DT><CODE>%OU</CODE>
<DD>
Same as <CODE>%U</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%V</CODE>
<DD>
The ISO 8601:1988 week number as a decimal number (range <CODE>1</CODE>
through <CODE>53</CODE>).

Leading zeroes are permitted but not required.

<EM>Note:</EM> This is not really implemented currently.  The format is
recognized, input is consumed but no field in <VAR>tm</VAR> is set.

<DT><CODE>%w</CODE>
<DD>
The day of the week as a decimal number (range <CODE>0</CODE> through
<CODE>6</CODE>), Sunday being <CODE>0</CODE>.

Leading zeroes are permitted but not required.

<EM>Note:</EM> This is not really implemented currently.  The format is
recognized, input is consumed but no field in <VAR>tm</VAR> is set.

<DT><CODE>%Ow</CODE>
<DD>
Same as <CODE>%w</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%W</CODE>
<DD>
The week number of the current year as a decimal number (range <CODE>0</CODE>
through <CODE>53</CODE>).

Leading zeroes are permitted but not required.

<EM>Note:</EM> This is not really implemented currently.  The format is
recognized, input is consumed but no field in <VAR>tm</VAR> is set.

<DT><CODE>%OW</CODE>
<DD>
Same as <CODE>%W</CODE> but using the locale's alternative numeric symbols are used.

<DT><CODE>%x</CODE>
<DD>
The date using the locale's date format.

<DT><CODE>%Ex</CODE>
<DD>
Like <CODE>%x</CODE> but the locale's alternative data representation is used.

<DT><CODE>%X</CODE>
<DD>
The time using the locale's time format.

<DT><CODE>%EX</CODE>
<DD>
Like <CODE>%X</CODE> but the locale's alternative time representation is used.

<DT><CODE>%y</CODE>
<DD>
The year without a century as a decimal number (range <CODE>0</CODE> through
<CODE>99</CODE>).

Leading zeroes are permitted but not required.

Please note that it is at least questionable to use this format without
the <CODE>%C</CODE> format.  The <CODE>strptime</CODE> function does regard input
values in the range @math{68} to @math{99} as the years @math{1969} to
@math{1999} and the values @math{0} to @math{68} as the years
@math{2000} to @math{2068}.  But maybe this heuristic fails for some
input data.

Therefore it is best to avoid <CODE>%y</CODE> completely and use <CODE>%Y</CODE>
instead.

<DT><CODE>%Ey</CODE>
<DD>
The offset from <CODE>%EC</CODE> in the locale's alternative representation.

<DT><CODE>%Oy</CODE>
<DD>
The offset of the year (from <CODE>%C</CODE>) using the locale's alternative
numeric symbols.

<DT><CODE>%Y</CODE>
<DD>
The year as a decimal number, using the Gregorian calendar.

<DT><CODE>%EY</CODE>
<DD>
The full alternative year representation.

<DT><CODE>%z</CODE>
<DD>
Equivalent to the use of <CODE>%a, %d %b %Y %H:%M:%S %z</CODE> in this place.
This is the full ISO 8601 date and time format.

<DT><CODE>%Z</CODE>
<DD>
The timezone name.

<EM>Note:</EM> This is not really implemented currently.  The format is
recognized, input is consumed but no field in <VAR>tm</VAR> is set.

<DT><CODE>%%</CODE>
<DD>
A literal <SAMP>`%'</SAMP> character.
</DL>

<P>
All other characters in the format string must have a matching character
in the input string.  Exceptions are white spaces in the input string
which can match zero or more white space characters in the input string.

</P>
<P>
The <CODE>strptime</CODE> function processes the input string from right to
left.  Each of the three possible input elements (white space, literal,
or format) are handled one after the other.  If the input cannot be
matched to the format string the function stops.  The remainder of the
format and input strings are not processed.

</P>
<P>
The return value of the function is a pointer to the first character not
processed in this function call.  In case the input string contains more
characters than required by the format string the return value points
right after the last consumed input character.  In case the whole input
string is consumed the return value points to the NUL byte at the end of
the string.  If <CODE>strptime</CODE> fails to match all of the format string
and therefore an error occurred the function returns <CODE>NULL</CODE>.
</DL>

</P>
<P>
The specification of the function in the XPG standard is rather vague.
It leaves out a few important pieces of information.  Most important it
does not specify what happens to those elements of <VAR>tm</VAR> which are
not directly initialized by the different formats.  Various
implementations on different Unix systems vary here.

</P>
<P>
The GNU libc implementation does not touch those fields which are not
directly initialized.  Exceptions are the <CODE>tm_wday</CODE> and
<CODE>tm_yday</CODE> elements which are recomputed if any of the year, month,
or date elements changed.  This has two implications:

</P>

<UL>
<LI>

Before calling the <CODE>strptime</CODE> function for a new input string one
has to prepare the structure passed in as the <VAR>tm</VAR>.  Normally this
will mean that all values are initialized to zero.  Alternatively one
can use all fields to values like <CODE>INT_MAX</CODE> which allows to
determine which elements were set by the function call.  Zero does not
work here since it is a valid value for many of the fields.

Careful initialization is necessary if one wants to find out whether a
certain field in <VAR>tm</VAR> was initialized by the function call.

<LI>

One can construct a <CODE>struct tm</CODE> value in several <CODE>strptime</CODE>
calls in a row.  A useful application of this is for example the parsing
of two separate strings, one containing the date information, the other
the time information.  By parsing both one after the other without
clearing the structure in between one can construct a complete
broken-down time.
</UL>

<P>
The following example shows a function which parses a string which is
supposed to contain the date information in either US style or ISO
8601 form.

</P>

<PRE>
const char *
parse_date (const char *input, struct tm *tm)
{
  const char *cp;

  /* First clear the result structure.  */
  memset (tm, '\0', sizeof (*tm));

  /* Try the ISO format first.  */
  cp = strptime (input, "%F", tm);
  if (cp == NULL)
    {
      /* Does not match.  Try the US form.  */
      cp = strptime (input, "%D", tm);
    }

  return cp;
}
</PRE>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_401.html">previous</A>, <A HREF="libc_403.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
