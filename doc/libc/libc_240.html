<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Getting File Status Flags</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_239.html">previous</A>, <A HREF="libc_241.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC247" HREF="libc_toc.html#TOC247">Getting and Setting File Status Flags</A></H3>

<P>
The <CODE>fcntl</CODE> function can fetch or change file status flags.

</P>
<P>
<DL>
<DT><U>Macro:</U> int <B>F_GETFL</B>
<DD><A NAME="IDX1143"></A>
This macro is used as the <VAR>command</VAR> argument to <CODE>fcntl</CODE>, to
read the file status flags for the open file with descriptor
<VAR>filedes</VAR>.

</P>
<P>
The normal return value from <CODE>fcntl</CODE> with this command is a
nonnegative number which can be interpreted as the bitwise OR of the
individual flags.  Since the file access modes are not single-bit values,
you can mask off other bits in the returned flags with <CODE>O_ACCMODE</CODE>
to compare them.

</P>
<P>
In case of an error, <CODE>fcntl</CODE> returns @math{-1}.  The following
<CODE>errno</CODE> error conditions are defined for this command:

</P>
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The <VAR>filedes</VAR> argument is invalid.
</DL>
</DL>

<P>
<DL>
<DT><U>Macro:</U> int <B>F_SETFL</B>
<DD><A NAME="IDX1144"></A>
This macro is used as the <VAR>command</VAR> argument to <CODE>fcntl</CODE>, to set
the file status flags for the open file corresponding to the
<VAR>filedes</VAR> argument.  This command requires a third <CODE>int</CODE>
argument to specify the new flags, so the call looks like this:

</P>

<PRE>
fcntl (<VAR>filedes</VAR>, F_SETFL, <VAR>new-flags</VAR>)
</PRE>

<P>
You can't change the access mode for the file in this way; that is,
whether the file descriptor was opened for reading or writing.

</P>
<P>
The normal return value from <CODE>fcntl</CODE> with this command is an
unspecified value other than @math{-1}, which indicates an error.  The
error conditions are the same as for the <CODE>F_GETFL</CODE> command.
</DL>

</P>
<P>
If you want to modify the file status flags, you should get the current
flags with <CODE>F_GETFL</CODE> and modify the value.  Don't assume that the
flags listed here are the only ones that are implemented; your program
may be run years from now and more flags may exist then.  For example,
here is a function to set or clear the flag <CODE>O_NONBLOCK</CODE> without
altering any other flags:

</P>

<PRE>
/* Set the <CODE>O_NONBLOCK</CODE> flag of <VAR>desc</VAR> if <VAR>value</VAR> is nonzero,
   or clear the flag if <VAR>value</VAR> is 0.
   Return 0 on success, or -1 on error with <CODE>errno</CODE> set. */

int
set_nonblock_flag (int desc, int value)
{
  int oldflags = fcntl (desc, F_GETFL, 0);
  /* If reading the flags failed, return error indication now. */
  if (oldflags == -1)
    return -1;
  /* Set just the flag we want to set. */
  if (value != 0)
    oldflags |= O_NONBLOCK;
  else
    oldflags &#38;= ~O_NONBLOCK;
  /* Store modified flag word in the descriptor. */
  return fcntl (desc, F_SETFL, oldflags);
}
</PRE>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_239.html">previous</A>, <A HREF="libc_241.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
