<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Synchronizing I/O</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_225.html">previous</A>, <A HREF="libc_227.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC233" HREF="libc_toc.html#TOC233">Synchronizing I/O operations</A></H2>

<P>
<A NAME="IDX1064"></A>
In most modern operation systems the normal I/O operations are not
executed synchronously.  I.e., even if a <CODE>write</CODE> system call
returns this does not mean the data is actually written to the media,
e.g., the disk.

</P>
<P>
In situations where synchronization points are necessary the user can
use special functions which ensure that all operations finished before
they return.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>sync</B> <I>(void)</I>
<DD><A NAME="IDX1065"></A>
A call to this function will not return as long as there is data which
that is not written to the device.  All dirty buffers in the kernel will
be written and so an overall consistent system can be achieved (if no
other process in parallel writes data).

</P>
<P>
A prototype for <CODE>sync</CODE> can be found in <TT>`unistd.h'</TT>.

</P>
<P>
The return value is zero to indicate no error.
</DL>

</P>
<P>
More often it is wanted that not all data in the system is committed.
Programs want to ensure that data written to a given file are all
committed and in this situation <CODE>sync</CODE> is overkill.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>fsync</B> <I>(int <VAR>fildes</VAR>)</I>
<DD><A NAME="IDX1066"></A>
The <CODE>fsync</CODE> can be used to make sure all data associated with the
open file <VAR>fildes</VAR> is written to the device associated with the
descriptor.  The function call does not return unless all actions have
finished.

</P>
<P>
A prototype for <CODE>fsync</CODE> can be found in <TT>`unistd.h'</TT>.

</P>
<P>
This function is a cancelation point in multi-threaded programs.  This
is a problem if the thread allocates some resources (like memory, file
descriptors, semaphores or whatever) at the time <CODE>fsync</CODE> is
called.  If the thread gets canceled these resources stay allocated
until the program ends.  To avoid this calls to <CODE>fsync</CODE> should be
protected using cancelation handlers.

</P>
<P>
The return value of the function is zero if no error occurred.  Otherwise
it is @math{-1} and the global variable <VAR>errno</VAR> is set to the
following values:
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The descriptor <VAR>fildes</VAR> is not valid.

<DT><CODE>EINVAL</CODE>
<DD>
No synchronization is possible since the system does not implement this.
</DL>
</DL>

<P>
Sometimes it is not even necessary to write all data associated with a
file descriptor.  E.g., in database files which do not change in size it
is enough to write all the file content data to the device.
Meta-information like the modification time etc. are not that important
and leaving such information uncommitted does not prevent a successful
recovering of the file in case of a problem.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>fdatasync</B> <I>(int <VAR>fildes</VAR>)</I>
<DD><A NAME="IDX1067"></A>
When a call to the <CODE>fdatasync</CODE> function returns it is made sure
that all of the file data is written to the device.  For all pending I/O
operations the parts guaranteeing data integrity finished.

</P>
<P>
Not all systems implement the <CODE>fdatasync</CODE> operation.  On systems
missing this functionality <CODE>fdatasync</CODE> is emulated by a call to
<CODE>fsync</CODE> since the performed actions are a superset of those
required by <CODE>fdatasyn</CODE>.

</P>
<P>
The prototype for <CODE>fdatasync</CODE> is in <TT>`unistd.h'</TT>.

</P>
<P>
The return value of the function is zero if no error occurred.  Otherwise
it is @math{-1} and the global variable <VAR>errno</VAR> is set to the
following values:
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The descriptor <VAR>fildes</VAR> is not valid.

<DT><CODE>EINVAL</CODE>
<DD>
No synchronization is possible since the system does not implement this.
</DL>
</DL>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_225.html">previous</A>, <A HREF="libc_227.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
