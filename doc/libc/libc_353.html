<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Allocation</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_352.html">previous</A>, <A HREF="libc_354.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC360" HREF="libc_toc.html#TOC360">Allocating Pseudo-Terminals</A></H3>
<P>
<A NAME="IDX1774"></A>

</P>
<P>
<A NAME="IDX1775"></A>
This subsection describes functions for allocating a pseudo-terminal,
and for making this pseudo-terminal available for actual use.  These
functions are declared in the header file <TT>`stdlib.h'</TT>.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>getpt</B> <I>(void)</I>
<DD><A NAME="IDX1776"></A>
The <CODE>getpt</CODE> function returns a new file descriptor for the next
available master pseudo-terminal.  The normal return value from
<CODE>getpt</CODE> is a non-negative integer file descriptor.  In the case of
an error, a value of @math{-1} is returned instead.  The following
<CODE>errno</CODE> conditions are defined for this function:

</P>
<DL COMPACT>

<DT><CODE>ENOENT</CODE>
<DD>
There are no free master pseudo-terminals available.
</DL>

<P>
This function is a GNU extension.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>grantpt</B> <I>(int <VAR>filedes</VAR>)</I>
<DD><A NAME="IDX1777"></A>
The <CODE>grantpt</CODE> function changes the ownership and access permission
of the slave pseudo-terminal device corresponding to the master
pseudo-terminal device associated with the file descriptor
<VAR>filedes</VAR>.  The owner is set from the real user ID of the calling
process (see section <A HREF="libc_554.html#SEC562">The Persona of a Process</A>), and the group is set to a special
group (typically <STRONG>tty</STRONG>) or from the real group ID of the calling
process.  The access permission is set such that the file is both
readable and writable by the owner and only writable by the group.

</P>
<P>
On some systems this function is implemented by invoking a special
<CODE>setuid</CODE> root program (see section <A HREF="libc_556.html#SEC564">How an Application Can Change Persona</A>).  As a
consequence, installing a signal handler for the <CODE>SIGCHLD</CODE> signal
(see section <A HREF="libc_427.html#SEC434">Job Control Signals</A>) may interfere with a call to
<CODE>grantpt</CODE>.

</P>
<P>
The normal return value from <CODE>grantpt</CODE> is @math{0}; a value of
@math{-1} is returned in case of failure.  The following <CODE>errno</CODE>
error conditions are defined for this function:

</P>
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The <VAR>filedes</VAR> argument is not a valid file descriptor.

<DT><CODE>ENINVAL</CODE>
<DD>
The <VAR>filedes</VAR> argument is not associated with a master pseudo-terminal
device.

<DT><CODE>EACCESS</CODE>
<DD>
The slave pseudo-terminal device corresponding to the master associated
with <VAR>filedes</VAR> could not be accessed.
</DL>

</DL>

<P>
<DL>
<DT><U>Function:</U> int <B>unlockpt</B> <I>(int <VAR>filedes</VAR>)</I>
<DD><A NAME="IDX1778"></A>
The <CODE>unlockpt</CODE> function unlocks the slave pseudo-terminal device
corresponding to the master pseudo-terminal device associated with the
file descriptor <VAR>filedes</VAR>.  On many systems, the slave can only be
opened after unlocking, so portable applications should always call
<CODE>unlockpt</CODE> before trying to open the slave.

</P>
<P>
The normal return value from <CODE>unlockpt</CODE> is @math{0}; a value of
@math{-1} is returned in case of failure.  The following <CODE>errno</CODE>
error conditions are defined for this function:

</P>
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The <VAR>filedes</VAR> argument is not a valid file descriptor.

<DT><CODE>EINVAL</CODE>
<DD>
The <VAR>filedes</VAR> argument is not associated with a master pseudo-terminal
device.
</DL>
</DL>

<P>
<DL>
<DT><U>Function:</U> char * <B>ptsname</B> <I>(int <VAR>filedes</VAR>)</I>
<DD><A NAME="IDX1779"></A>
If the file descriptor <VAR>filedes</VAR> is associated with a
master pseudo-terminal device, the <CODE>ptsname</CODE> function returns a
pointer to a statically-allocated, null-terminated string containing the
file name of the associated slave pseudo-terminal file.  This string
might be overwritten by subsequent calls to <CODE>ptsname</CODE>.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>ptsname_r</B> <I>(int <VAR>filedes</VAR>, char *<VAR>buf</VAR>, size_t <VAR>len</VAR>)</I>
<DD><A NAME="IDX1780"></A>
The <CODE>ptsname_r</CODE> function is similar to the <CODE>ptsname</CODE> function
except that it places its result into the user-specified buffer starting
at <VAR>buf</VAR> with length <VAR>len</VAR>.

</P>
<P>
This function is a GNU extension.
</DL>

</P>
<P>
<STRONG>Portability Note:</STRONG> On System V derived systems, the file
returned by the <CODE>ptsname</CODE> and <CODE>ptsname_r</CODE> functions may be
STREAMS-based, and therefore require additional processing after opening
before it actually behaves as a pseudo terminal.

</P>
<P>
Typical usage of these functions is illustrated by the following example:

<PRE>
int
open_pty_pair (int *amaster, int *aslave)
{
  int master, slave;
  char *name

  master = getpt ();
  if (master &#60; 0)
    return 0;

  if (grantpt (master) &#60; 0 || unlockpt (master) &#60; 0)
    goto close_master;
  name = ptsname (master);
  if (name == NULL)
    goto close_master;

  slave = open (name, O_RDWR);
  if (slave == -1)
    goto close_master;

  if (isastream (slave))
    {
      if (ioctl (slave, I_PUSH, "ptem") &#60; 0
          || ioctl (slave, I_PUSH, "ldterm") &#60; 0)
        goto close_slave;
    }

  *amaster = master;
  *aslave = slave;
  return 1;

close_slave:
  close (slave);

close_master:
  close (master);
  return 0;
}
</PRE>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_352.html">previous</A>, <A HREF="libc_354.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
