<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Setting Groups</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_558.html">previous</A>, <A HREF="libc_560.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC567" HREF="libc_toc.html#TOC567">Setting the Group IDs</A></H2>

<P>
This section describes the functions for altering the group IDs (real
and effective) of a process.  To use these facilities, you must include
the header files <TT>`sys/types.h'</TT> and <TT>`unistd.h'</TT>.
<A NAME="IDX2927"></A>
<A NAME="IDX2928"></A>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>setegid</B> <I>(gid_t <VAR>newgid</VAR>)</I>
<DD><A NAME="IDX2929"></A>
This function sets the effective group ID of the process to
<VAR>newgid</VAR>, provided that the process is allowed to change its group
ID.  Just as with <CODE>seteuid</CODE>, if the process is privileged it may
change its effective group ID to any value; if it isn't, but it has a
file group ID, then it may change to its real group ID or file group ID;
otherwise it may not change its effective group ID.

</P>
<P>
Note that a process is only privileged if its effective <EM>user</EM> ID
is zero.  The effective group ID only affects access permissions.

</P>
<P>
The return values and error conditions for <CODE>setegid</CODE> are the same
as those for <CODE>seteuid</CODE>.

</P>
<P>
This function is only present if <CODE>_POSIX_SAVED_IDS</CODE> is defined.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>setgid</B> <I>(gid_t <VAR>newgid</VAR>)</I>
<DD><A NAME="IDX2930"></A>
This function sets both the real and effective group ID of the process
to <VAR>newgid</VAR>, provided that the process is privileged.  It also
deletes the file group ID, if any.

</P>
<P>
If the process is not privileged, then <CODE>setgid</CODE> behaves like
<CODE>setegid</CODE>.

</P>
<P>
The return values and error conditions for <CODE>setgid</CODE> are the same
as those for <CODE>seteuid</CODE>.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>setregid</B> <I>(gid_t <VAR>rgid</VAR>, gid_t <VAR>egid</VAR>)</I>
<DD><A NAME="IDX2931"></A>
This function sets the real group ID of the process to <VAR>rgid</VAR> and
the effective group ID to <VAR>egid</VAR>.  If <VAR>rgid</VAR> is <CODE>-1</CODE>, it
means not to change the real group ID; likewise if <VAR>egid</VAR> is
<CODE>-1</CODE>, it means not to change the effective group ID.

</P>
<P>
The <CODE>setregid</CODE> function is provided for compatibility with 4.3 BSD
Unix, which does not support file IDs.  You can use this function to
swap the effective and real group IDs of the process.  (Privileged
processes are not limited to this usage.)  If file IDs are supported,
you should use that feature instead of using this function.
See section <A HREF="libc_560.html#SEC568">Enabling and Disabling Setuid Access</A>.

</P>
<P>
The return values and error conditions for <CODE>setregid</CODE> are the same
as those for <CODE>setreuid</CODE>.
</DL>

</P>
<P>
<CODE>setuid</CODE> and <CODE>setgid</CODE> behave differently depending on whether
the effective user ID at the time is zero.  If it is not zero, they
behave like <CODE>seteuid</CODE> and <CODE>setegid</CODE>.  If it is, they change
both effective and real IDs and delete the file ID.  To avoid confusion,
we recommend you always use <CODE>seteuid</CODE> and <CODE>setegid</CODE> except
when you know the effective user ID is zero and your intent is to change
the persona permanently.  This case is rare--most of the programs that
need it, such as <CODE>login</CODE> and <CODE>su</CODE>, have already been written.

</P>
<P>
Note that if your program is setuid to some user other than <CODE>root</CODE>,
there is no way to drop privileges permanently.

</P>
<P>
The system also lets privileged processes change their supplementary
group IDs.  To use <CODE>setgroups</CODE> or <CODE>initgroups</CODE>, your programs
should include the header file <TT>`grp.h'</TT>.
<A NAME="IDX2932"></A>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>setgroups</B> <I>(size_t <VAR>count</VAR>, gid_t *<VAR>groups</VAR>)</I>
<DD><A NAME="IDX2933"></A>
This function sets the process's supplementary group IDs.  It can only
be called from privileged processes.  The <VAR>count</VAR> argument specifies
the number of group IDs in the array <VAR>groups</VAR>.

</P>
<P>
This function returns <CODE>0</CODE> if successful and <CODE>-1</CODE> on error.
The following <CODE>errno</CODE> error conditions are defined for this
function:

</P>
<DL COMPACT>

<DT><CODE>EPERM</CODE>
<DD>
The calling process is not privileged.
</DL>
</DL>

<P>
<DL>
<DT><U>Function:</U> int <B>initgroups</B> <I>(const char *<VAR>user</VAR>, gid_t <VAR>gid</VAR>)</I>
<DD><A NAME="IDX2934"></A>
The <CODE>initgroups</CODE> function sets the process's supplementary group
IDs to be the normal default for the user name <VAR>user</VAR>. If <VAR>gid</VAR>
is not -1, it includes that group also.

</P>
<P>
This function works by scanning the group database for all the groups
<VAR>user</VAR> belongs to.  It then calls <CODE>setgroups</CODE> with the list it
has constructed.

</P>
<P>
The return values and error conditions are the same as for
<CODE>setgroups</CODE>.
</DL>

</P>
<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_558.html">previous</A>, <A HREF="libc_560.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
