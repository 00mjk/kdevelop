<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Reading/Closing Directory</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_248.html">previous</A>, <A HREF="libc_250.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC256" HREF="libc_toc.html#TOC256">Reading and Closing a Directory Stream</A></H3>

<P>
<A NAME="IDX1185"></A>
This section describes how to read directory entries from a directory
stream, and how to close the stream when you are done with it.  All the
symbols are declared in the header file <TT>`dirent.h'</TT>.

</P>
<P>
<DL>
<DT><U>Function:</U> struct dirent * <B>readdir</B> <I>(DIR *<VAR>dirstream</VAR>)</I>
<DD><A NAME="IDX1186"></A>
This function reads the next entry from the directory.  It normally
returns a pointer to a structure containing information about the file.
This structure is statically allocated and can be rewritten by a
subsequent call.

</P>
<P>
<STRONG>Portability Note:</STRONG> On some systems, <CODE>readdir</CODE> may not
return entries for <TT>`.'</TT> and <TT>`..'</TT>, even though these are always
valid file names in any directory.  See section <A HREF="libc_152.html#SEC159">File Name Resolution</A>.

</P>
<P>
If there are no more entries in the directory or an error is detected,
<CODE>readdir</CODE> returns a null pointer.  The following <CODE>errno</CODE> error
conditions are defined for this function:

</P>
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The <VAR>dirstream</VAR> argument is not valid.
</DL>

<P>
<CODE>readdir</CODE> is not thread safe.  Multiple threads using
<CODE>readdir</CODE> on the same <VAR>dirstream</VAR> may overwrite the return
value.  Use <CODE>readdir_r</CODE> when this is critical.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>readdir_r</B> <I>(DIR *<VAR>dirstream</VAR>, struct dirent *<VAR>entry</VAR>, struct dirent **<VAR>result</VAR>)</I>
<DD><A NAME="IDX1187"></A>
This function is the reentrant version of <CODE>readdir</CODE>.  Like
<CODE>readdir</CODE> it returns the next entry from the directory.  But to
prevent conflicts for simultaneously running threads the result is not
stored in some internal memory.  Instead the argument <VAR>entry</VAR> has to
point to a place where the result is stored.

</P>
<P>
The return value is <CODE>0</CODE> in case the next entry was read
successfully.  In this case a pointer to the result is returned in
*<VAR>result</VAR>.  It is not required that *<VAR>result</VAR> is the same as
<VAR>entry</VAR>.  If something goes wrong while executing <CODE>readdir_r</CODE>
the function returns a value indicating the error (as described for
<CODE>readdir</CODE>).

</P>
<P>
If there are no more directory entries, <CODE>readdir_r</CODE>'s return value is
<CODE>0</CODE>, and *<VAR>result</VAR> is set to <CODE>NULL</CODE>.

</P>
<P>
<STRONG>Portability Note:</STRONG> On some systems, <CODE>readdir_r</CODE> may not
return a terminated string as the file name even if no <CODE>d_reclen</CODE>
element is available in <CODE>struct dirent</CODE> and the file name as the
maximal allowed size.  Modern systems all have the <CODE>d_reclen</CODE> field
and on old systems multi threading is not critical.  In any case, there
is no such problem with the <CODE>readdir</CODE> function so that even on
systems without <CODE>d_reclen</CODE> field one could use multiple threads by
using external locking.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>closedir</B> <I>(DIR *<VAR>dirstream</VAR>)</I>
<DD><A NAME="IDX1188"></A>
This function closes the directory stream <VAR>dirstream</VAR>.  It returns
<CODE>0</CODE> on success and <CODE>-1</CODE> on failure.

</P>
<P>
The following <CODE>errno</CODE> error conditions are defined for this
function:

</P>
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The <VAR>dirstream</VAR> argument is not valid.
</DL>
</DL>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_248.html">previous</A>, <A HREF="libc_250.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
