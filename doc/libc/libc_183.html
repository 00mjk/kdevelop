<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Printf Extension Example</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_182.html">previous</A>, <A HREF="libc_184.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC190" HREF="libc_toc.html#TOC190"><CODE>printf</CODE> Extension Example</A></H3>

<P>
Here is an example showing how to define a <CODE>printf</CODE> handler function.
This program defines a data structure called a <CODE>Widget</CODE> and
defines the <SAMP>`%W'</SAMP> conversion to print information about <CODE>Widget *</CODE>
arguments, including the pointer value and the name stored in the data
structure.  The <SAMP>`%W'</SAMP> conversion supports the minimum field width and
left-justification options, but ignores everything else.

</P>

<PRE>
#include &#60;stdio.h&#62;
#include &#60;stdlib.h&#62;
#include &#60;printf.h&#62;

typedef struct
{
  char *name;
}
Widget;

int
print_widget (FILE *stream,
              const struct printf_info *info,
              const void *const *args)
{
  const Widget *w;
  char *buffer;
  int len;

  /* Format the output into a string. */
  w = *((const Widget **) (args[0]));
  len = asprintf (&#38;buffer, "&#60;Widget %p: %s&#62;", w, w-&#62;name);
  if (len == -1)
    return -1;

  /* Pad to the minimum field width and print to the stream. */
  len = fprintf (stream, "%*s",
                 (info-&#62;left ? -info-&#62;width : info-&#62;width),
                 buffer);

  /* Clean up and return. */
  free (buffer);
  return len;
}

int
print_widget_arginfo (const struct printf_info *info, size_t n,
                      int *argtypes)
{
  /* We always take exactly one argument and this is a pointer to the
     structure.. */
  if (n &#62; 0)
    argtypes[0] = PA_POINTER;
  return 1;
}

int
main (void)
{
  /* Make a widget to print. */
  Widget mywidget;
  mywidget.name = "mywidget";

  /* Register the print function for widgets. */
  register_printf_function ('W', print_widget, print_widget_arginfo);

  /* Now print the widget. */
  printf ("|%W|\n", &#38;mywidget);
  printf ("|%35W|\n", &#38;mywidget);
  printf ("|%-35W|\n", &#38;mywidget);

  return 0;
}
</PRE>

<P>
The output produced by this program looks like:

</P>

<PRE>
|&#60;Widget 0xffeffb7c: mywidget&#62;|
|      &#60;Widget 0xffeffb7c: mywidget&#62;|
|&#60;Widget 0xffeffb7c: mywidget&#62;      |
</PRE>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_182.html">previous</A>, <A HREF="libc_184.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
