<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Scanning Directory Content</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_251.html">previous</A>, <A HREF="libc_253.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC259" HREF="libc_toc.html#TOC259">Scanning the Content of a Directory</A></H3>

<P>
A higher-level interface to the directory handling functions is the
<CODE>scandir</CODE> function.  With its help one can select a subset of the
entries in a directory, possibly sort them and get as the result a list
of names.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>scandir</B> <I>(const char *<VAR>dir</VAR>, struct dirent ***<VAR>namelist</VAR>, int (*<VAR>selector</VAR>) (const struct dirent *), int (*<VAR>cmp</VAR>) (const void *, const void *))</I>
<DD><A NAME="IDX1193"></A>

</P>
<P>
The <CODE>scandir</CODE> function scans the contents of the directory selected
by <VAR>dir</VAR>.  The result in <VAR>namelist</VAR> is an array of pointers to
structure of type <CODE>struct dirent</CODE> which describe all selected
directory entries and which is allocated using <CODE>malloc</CODE>.  Instead
of always getting all directory entries returned, the user supplied
function <VAR>selector</VAR> can be used to decide which entries are in the
result.  Only the entries for which <VAR>selector</VAR> returns a nonzero
value are selected.

</P>
<P>
Finally the entries in the <VAR>namelist</VAR> are sorted using the user
supplied function <VAR>cmp</VAR>.  The arguments of the <VAR>cmp</VAR> function
are of type <CODE>struct dirent **</CODE>.  I.e., one cannot directly use the
<CODE>strcmp</CODE> or <CODE>strcoll</CODE> function; see the functions
<CODE>alphasort</CODE> and <CODE>versionsort</CODE> below.

</P>
<P>
The return value of the function gives the number of entries placed in
<VAR>namelist</VAR>.  If it is <CODE>-1</CODE> an error occurred (either the
directory could not be opened for reading or the malloc call failed) and
the global variable <CODE>errno</CODE> contains more information on the error.
</DL>

</P>
<P>
As said above the fourth argument to the <CODE>scandir</CODE> function must be
a pointer to a sorting function.  For the convenience of the programmer
the GNU C library contains implementations of functions which are very
helpful for this purpose.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>alphasort</B> <I>(const void *<VAR>a</VAR>, const void *<VAR>b</VAR>)</I>
<DD><A NAME="IDX1194"></A>
The <CODE>alphasort</CODE> function behaves like the <CODE>strcoll</CODE> function
(see section <A HREF="libc_68.html#SEC68">String/Array Comparison</A>).  The difference is that the arguments
are not string pointers but instead they are of type
<CODE>struct dirent **</CODE>.

</P>
<P>
Return value of <CODE>alphasort</CODE> is less than, equal to, or greater than
zero depending on the order of the two entries <VAR>a</VAR> and <VAR>b</VAR>.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>versionsort</B> <I>(const void *<VAR>a</VAR>, const void *<VAR>b</VAR>)</I>
<DD><A NAME="IDX1195"></A>
The <CODE>versionsort</CODE> function is like <CODE>alphasort</CODE>, excepted that it
uses the <CODE>strverscmp</CODE> function internally.
</DL>

</P>
<P>
If the filesystem supports large files we cannot use the <CODE>scandir</CODE>
anymore since the <CODE>dirent</CODE> structure might not able to contain all
the information.  The LFS provides the new type <CODE>struct
dirent64</CODE>.  To use this we need a new function.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>scandir64</B> <I>(const char *<VAR>dir</VAR>, struct dirent64 ***<VAR>namelist</VAR>, int (*<VAR>selector</VAR>) (const struct dirent64 *), int (*<VAR>cmp</VAR>) (const void *, const void *))</I>
<DD><A NAME="IDX1196"></A>
The <CODE>scandir64</CODE> function works like the <CODE>scandir</CODE> function
only that the directory entries it returns are described by elements of
type <CODE>struct dirent64</CODE>.  The function pointed to by
<VAR>selector</VAR> is again used to select the wanted entries only that
<VAR>selector</VAR> now must point to a function which takes a
<CODE>struct dirent64 *</CODE> parameter.

</P>
<P>
The <VAR>cmp</VAR> now must be a function which expects its two arguments to
be of type <CODE>struct dirent64 **</CODE>.
</DL>

</P>
<P>
As just said the function expected as the fourth is different from the
function expected in <CODE>scandir</CODE>.  Therefore we cannot use the
<CODE>alphasort</CODE> and <CODE>versionsort</CODE> functions anymore.  Instead we
have two similar functions available.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>alphasort64</B> <I>(const void *<VAR>a</VAR>, const void *<VAR>b</VAR>)</I>
<DD><A NAME="IDX1197"></A>
The <CODE>alphasort64</CODE> function behaves like the <CODE>strcoll</CODE> function
(see section <A HREF="libc_68.html#SEC68">String/Array Comparison</A>).  The difference is that the arguments
are not string pointers but instead they are of type
<CODE>struct dirent64 **</CODE>.

</P>
<P>
Return value of <CODE>alphasort64</CODE> is less than, equal to, or greater
than zero depending on the order of the two entries <VAR>a</VAR> and <VAR>b</VAR>.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>versionsort64</B> <I>(const void *<VAR>a</VAR>, const void *<VAR>b</VAR>)</I>
<DD><A NAME="IDX1198"></A>
The <CODE>versionsort64</CODE> function is like <CODE>alphasort64</CODE>, excepted that it
uses the <CODE>strverscmp</CODE> function internally.
</DL>

</P>
<P>
It is important not to mix the use of <CODE>scandir</CODE> and the 64 bits
comparison functions or vice versa.  There are systems on which this
works but on others it will fail miserably.

</P>
<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_251.html">previous</A>, <A HREF="libc_253.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
