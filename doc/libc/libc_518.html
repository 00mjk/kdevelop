<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Process Completion</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_517.html">previous</A>, <A HREF="libc_519.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC526" HREF="libc_toc.html#TOC526">Process Completion</A></H2>
<P>
<A NAME="IDX2782"></A>
<A NAME="IDX2783"></A>
<A NAME="IDX2784"></A>

</P>
<P>
The functions described in this section are used to wait for a child
process to terminate or stop, and determine its status.  These functions
are declared in the header file <TT>`sys/wait.h'</TT>.
<A NAME="IDX2785"></A>

</P>
<P>
<DL>
<DT><U>Function:</U> pid_t <B>waitpid</B> <I>(pid_t <VAR>pid</VAR>, int *<VAR>status-ptr</VAR>, int <VAR>options</VAR>)</I>
<DD><A NAME="IDX2786"></A>
The <CODE>waitpid</CODE> function is used to request status information from a
child process whose process ID is <VAR>pid</VAR>.  Normally, the calling
process is suspended until the child process makes status information
available by terminating.

</P>
<P>
Other values for the <VAR>pid</VAR> argument have special interpretations.  A
value of <CODE>-1</CODE> or <CODE>WAIT_ANY</CODE> requests status information for
any child process; a value of <CODE>0</CODE> or <CODE>WAIT_MYPGRP</CODE> requests
information for any child process in the same process group as the
calling process; and any other negative value - <VAR>pgid</VAR>
requests information for any child process whose process group ID is
<VAR>pgid</VAR>.

</P>
<P>
If status information for a child process is available immediately, this
function returns immediately without waiting.  If more than one eligible
child process has status information available, one of them is chosen
randomly, and its status is returned immediately.  To get the status
from the other eligible child processes, you need to call <CODE>waitpid</CODE>
again.

</P>
<P>
The <VAR>options</VAR> argument is a bit mask.  Its value should be the
bitwise OR (that is, the <SAMP>`|'</SAMP> operator) of zero or more of the
<CODE>WNOHANG</CODE> and <CODE>WUNTRACED</CODE> flags.  You can use the
<CODE>WNOHANG</CODE> flag to indicate that the parent process shouldn't wait;
and the <CODE>WUNTRACED</CODE> flag to request status information from stopped
processes as well as processes that have terminated.

</P>
<P>
The status information from the child process is stored in the object
that <VAR>status-ptr</VAR> points to, unless <VAR>status-ptr</VAR> is a null pointer.

</P>
<P>
This function is a cancelation point in multi-threaded programs.  This
is a problem if the thread allocates some resources (like memory, file
descriptors, semaphores or whatever) at the time <CODE>waitpid</CODE> is
called.  If the thread gets canceled these resources stay allocated
until the program ends.  To avoid this calls to <CODE>waitpid</CODE> should be
protected using cancelation handlers.

</P>
<P>
The return value is normally the process ID of the child process whose
status is reported.  If there are child processes but none of them is
waiting to be noticed, <CODE>waitpid</CODE> will block until one is.  However,
if the <CODE>WNOHANG</CODE> option was specified, <CODE>waitpid</CODE> will return
zero instead of blocking.

</P>
<P>
If a specific PID to wait for was given to <CODE>waitpid</CODE>, it will
ignore all other children (if any).  Therefore if there are children
waiting to be noticed but the child whose PID was specified is not one
of them, <CODE>waitpid</CODE> will block or return zero as described above.

</P>
<P>
A value of <CODE>-1</CODE> is returned in case of error.  The following
<CODE>errno</CODE> error conditions are defined for this function:

</P>
<DL COMPACT>

<DT><CODE>EINTR</CODE>
<DD>
The function was interrupted by delivery of a signal to the calling
process.  See section <A HREF="libc_449.html#SEC456">Primitives Interrupted by Signals</A>.

<DT><CODE>ECHILD</CODE>
<DD>
There are no child processes to wait for, or the specified <VAR>pid</VAR>
is not a child of the calling process.

<DT><CODE>EINVAL</CODE>
<DD>
An invalid value was provided for the <VAR>options</VAR> argument.
</DL>
</DL>

<P>
These symbolic constants are defined as values for the <VAR>pid</VAR> argument
to the <CODE>waitpid</CODE> function.

</P>
<DL COMPACT>

<DT><CODE>WAIT_ANY</CODE>
<DD>
This constant macro (whose value is <CODE>-1</CODE>) specifies that
<CODE>waitpid</CODE> should return status information about any child process.

<DT><CODE>WAIT_MYPGRP</CODE>
<DD>
This constant (with value <CODE>0</CODE>) specifies that <CODE>waitpid</CODE> should
return status information about any child process in the same process
group as the calling process.
</DL>

<P>
These symbolic constants are defined as flags for the <VAR>options</VAR>
argument to the <CODE>waitpid</CODE> function.  You can bitwise-OR the flags
together to obtain a value to use as the argument.

</P>
<DL COMPACT>

<DT><CODE>WNOHANG</CODE>
<DD>
This flag specifies that <CODE>waitpid</CODE> should return immediately
instead of waiting, if there is no child process ready to be noticed.

<DT><CODE>WUNTRACED</CODE>
<DD>
This flag specifies that <CODE>waitpid</CODE> should report the status of any
child processes that have been stopped as well as those that have
terminated.
</DL>

<P>
<DL>
<DT><U>Function:</U> pid_t <B>wait</B> <I>(int *<VAR>status-ptr</VAR>)</I>
<DD><A NAME="IDX2787"></A>
This is a simplified version of <CODE>waitpid</CODE>, and is used to wait
until any one child process terminates.  The call:

</P>

<PRE>
wait (&#38;status)
</PRE>

<P>
is exactly equivalent to:

</P>

<PRE>
waitpid (-1, &#38;status, 0)
</PRE>

<P>
This function is a cancelation point in multi-threaded programs.  This
is a problem if the thread allocates some resources (like memory, file
descriptors, semaphores or whatever) at the time <CODE>wait</CODE> is
called.  If the thread gets canceled these resources stay allocated
until the program ends.  To avoid this calls to <CODE>wait</CODE> should be
protected using cancelation handlers.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> pid_t <B>wait4</B> <I>(pid_t <VAR>pid</VAR>, int *<VAR>status-ptr</VAR>, int <VAR>options</VAR>, struct rusage *<VAR>usage</VAR>)</I>
<DD><A NAME="IDX2788"></A>
If <VAR>usage</VAR> is a null pointer, <CODE>wait4</CODE> is equivalent to
<CODE>waitpid (<VAR>pid</VAR>, <VAR>status-ptr</VAR>, <VAR>options</VAR>)</CODE>.

</P>
<P>
If <VAR>usage</VAR> is not null, <CODE>wait4</CODE> stores usage figures for the
child process in <CODE>*<VAR>rusage</VAR></CODE> (but only if the child has
terminated, not if it has stopped).  See section <A HREF="libc_410.html#SEC417">Resource Usage</A>.

</P>
<P>
This function is a BSD extension.
</DL>

</P>
<P>
Here's an example of how to use <CODE>waitpid</CODE> to get the status from
all child processes that have terminated, without ever waiting.  This
function is designed to be a handler for <CODE>SIGCHLD</CODE>, the signal that
indicates that at least one child process has terminated.

</P>

<PRE>
void
sigchld_handler (int signum)
{
  int pid, status, serrno;
  serrno = errno;
  while (1)
    {
      pid = waitpid (WAIT_ANY, &#38;status, WNOHANG);
      if (pid &#60; 0)
        {
          perror ("waitpid");
          break;
        }
      if (pid == 0)
        break;
      notice_termination (pid, status);
    }
  errno = serrno;
}
</PRE>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_517.html">previous</A>, <A HREF="libc_519.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
