<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Argp Special Keys</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_485.html">previous</A>, <A HREF="libc_487.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H4><A NAME="SEC494" HREF="libc_toc.html#TOC494">Special Keys for Argp Parser Functions</A></H4>

<P>
In addition to key values corresponding to user options, the <VAR>key</VAR>
argument to argp parser functions may have a number of other special
values (<VAR>arg</VAR> and <VAR>state</VAR> refer to parser function arguments;
see section <A HREF="libc_485.html#SEC493">Argp Parser Functions</A>):

</P>
<DL COMPACT>

<DT><CODE>ARGP_KEY_ARG</CODE>
<DD>
<A NAME="IDX2659"></A>
This is not an option at all, but rather a command line argument, whose
value is pointed to by <VAR>arg</VAR>.

When there are multiple parser functions (due to argp parsers being
combined), it's impossible to know which one wants to handle an
argument, so each is called in turn, until one returns 0 or an error
other than <CODE>ARGP_ERR_UNKNOWN</CODE>; if an argument is handled by no one,
<CODE>argp_parse</CODE> immediately returns success, without parsing any more
arguments.

Once a parser function returns success for this key, that fact is
recorded, and the <CODE>ARGP_KEY_NO_ARGS</CODE> case won't be used.
<EM>However</EM>, if while processing the argument, a parser function
decrements the <CODE>next</CODE> field of its <VAR>state</VAR> argument, the option
won't be considered processed; this is to allow you to actually modify
the argument (perhaps into an option), and have it processed again.

<DT><CODE>ARGP_KEY_ARGS</CODE>
<DD>
<A NAME="IDX2660"></A>
If a parser function returns <CODE>ARGP_ERR_UNKNOWN</CODE> for
<CODE>ARGP_KEY_ARG</CODE>, it is immediately called again with the key
<CODE>ARGP_KEY_ARGS</CODE>, which has a similar meaning, but is slightly more
convenient for consuming all remaining arguments.  <VAR>arg</VAR> is 0, and
the tail of the argument vector may be found at <CODE><VAR>state</VAR>-&#62;argv
+ <VAR>state</VAR>-&#62;next</CODE>.  If success is returned for this key, and
<CODE><VAR>state</VAR>-&#62;next</CODE> is unchanged, then all remaining arguments are
considered to have been consumed, otherwise, the amount by which
<CODE><VAR>state</VAR>-&#62;next</CODE> has been adjust indicates how many were used.
For instance, here's an example that uses both, for different args:


<PRE>
...
case ARGP_KEY_ARG:
  if (<VAR>state</VAR>-&#62;arg_num == 0)
    /* First argument */
    first_arg = <VAR>arg</VAR>;
  else
    /* Let the next case parse it.  */
    return ARGP_KEY_UNKNOWN;
  break;
case ARGP_KEY_ARGS:
  remaining_args = <VAR>state</VAR>-&#62;argv + <VAR>state</VAR>-&#62;next;
  num_remaining_args = <VAR>state</VAR>-&#62;argc - <VAR>state</VAR>-&#62;next;
  break;
</PRE>

<DT><CODE>ARGP_KEY_END</CODE>
<DD>
<A NAME="IDX2661"></A>
There are no more command line arguments at all.

<DT><CODE>ARGP_KEY_NO_ARGS</CODE>
<DD>
<A NAME="IDX2662"></A>
Because it's common to want to do some special processing if there
aren't any non-option args, parser functions are called with this key if
they didn't successfully process any non-option arguments.  Called just
before <CODE>ARGP_KEY_END</CODE> (where more general validity checks on
previously parsed arguments can take place).

<DT><CODE>ARGP_KEY_INIT</CODE>
<DD>
<A NAME="IDX2663"></A>
Passed in before any parsing is done.  Afterwards, the values of each
element of the <CODE>child_input</CODE> field of <VAR>state</VAR>, if any, are
copied to each child's state to be the initial value of the <CODE>input</CODE>
when <EM>their</EM> parsers are called.

<DT><CODE>ARGP_KEY_SUCCESS</CODE>
<DD>
<A NAME="IDX2664"></A>
Passed in when parsing has successfully been completed (even if there are
still arguments remaining).

<DT><CODE>ARGP_KEY_ERROR</CODE>
<DD>
<A NAME="IDX2665"></A>
Passed in if an error has occurred, and parsing terminated (in which case
a call with a key of <CODE>ARGP_KEY_SUCCESS</CODE> is never made).

<DT><CODE>ARGP_KEY_FINI</CODE>
<DD>
<A NAME="IDX2666"></A>
The final key ever seen by any parser (even after
<CODE>ARGP_KEY_SUCCESS</CODE> and <CODE>ARGP_KEY_ERROR</CODE>).  Any resources
allocated by <CODE>ARGP_KEY_INIT</CODE> may be freed here (although sometimes
certain resources allocated there are to be returned to the caller after
a successful parse; in that case, those particular resources can be
freed in the <CODE>ARGP_KEY_ERROR</CODE> case).
</DL>

<P>
In all cases, <CODE>ARGP_KEY_INIT</CODE> is the first key seen by parser
functions, and <CODE>ARGP_KEY_FINI</CODE> the last (unless an error was
returned by the parser for <CODE>ARGP_KEY_INIT</CODE>).  Other keys can occur
in one the following orders (<VAR>opt</VAR> refers to an arbitrary option
key):

</P>
<DL COMPACT>

<DT><VAR>opt</VAR>... <CODE>ARGP_KEY_NO_ARGS</CODE> <CODE>ARGP_KEY_END</CODE> <CODE>ARGP_KEY_SUCCESS</CODE>
<DD>
The arguments being parsed contained no non-option arguments at all.

<DT>( <VAR>opt</VAR> | <CODE>ARGP_KEY_ARG</CODE> )... <CODE>ARGP_KEY_END</CODE> <CODE>ARGP_KEY_SUCCESS</CODE>
<DD>
All non-option arguments were successfully handled by a parser function
(there may be multiple parser functions if multiple argp parsers were
combined).

<DT>( <VAR>opt</VAR> | <CODE>ARGP_KEY_ARG</CODE> )... <CODE>ARGP_KEY_SUCCESS</CODE>
<DD>
Some non-option argument was unrecognized.

This occurs when every parser function returns <CODE>ARGP_KEY_UNKNOWN</CODE>
for an argument, in which case parsing stops at that argument.  If a
non-zero value for <VAR>arg_index</VAR> was passed to <CODE>argp_parse</CODE>, the
index of this argument is returned in it, otherwise an error occurs.
</DL>

<P>
If an error occurs (either detected by argp, or because a parser
function returned an error value), then each parser is called with
<CODE>ARGP_KEY_ERROR</CODE>, and no further calls are made except the final
call with <CODE>ARGP_KEY_FINI</CODE>.

</P>
<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_485.html">previous</A>, <A HREF="libc_487.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
