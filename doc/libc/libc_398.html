<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - High-Resolution Calendar</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_397.html">previous</A>, <A HREF="libc_399.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC405" HREF="libc_toc.html#TOC405">High-Resolution Calendar</A></H3>

<P>
The <CODE>time_t</CODE> data type used to represent calendar times has a
resolution of only one second.  Some applications need more precision.

</P>
<P>
So, the GNU C library also contains functions which are capable of
representing calendar times to a higher resolution than one second.  The
functions and the associated data types described in this section are
declared in <TT>`sys/time.h'</TT>.
<A NAME="IDX2310"></A>

</P>
<P>
<DL>
<DT><U>Data Type:</U> <B>struct timeval</B>
<DD><A NAME="IDX2311"></A>
The <CODE>struct timeval</CODE> structure represents a calendar time.  It
has the following members:

</P>
<DL COMPACT>

<DT><CODE>long int tv_sec</CODE>
<DD>
This represents the number of seconds since the epoch.  It is equivalent
to a normal <CODE>time_t</CODE> value.

<DT><CODE>long int tv_usec</CODE>
<DD>
This is the fractional second value, represented as the number of
microseconds.

Some times struct timeval values are used for time intervals.  Then the
<CODE>tv_sec</CODE> member is the number of seconds in the interval, and
<CODE>tv_usec</CODE> is the number of additional microseconds.
</DL>
</DL>

<P>
<DL>
<DT><U>Data Type:</U> <B>struct timezone</B>
<DD><A NAME="IDX2312"></A>
The <CODE>struct timezone</CODE> structure is used to hold minimal information
about the local time zone.  It has the following members:

</P>
<DL COMPACT>

<DT><CODE>int tz_minuteswest</CODE>
<DD>
This is the number of minutes west of UTC.

<DT><CODE>int tz_dsttime</CODE>
<DD>
If nonzero, daylight saving time applies during some part of the year.
</DL>

<P>
The <CODE>struct timezone</CODE> type is obsolete and should never be used.
Instead, use the facilities described in section <A HREF="libc_405.html#SEC412">Functions and Variables for Time Zones</A>.
</DL>

</P>
<P>
It is often necessary to subtract two values of type <CODE>struct
timeval</CODE>.  Here is the best way to do this.  It works even on some
peculiar operating systems where the <CODE>tv_sec</CODE> member has an
unsigned type.

</P>

<PRE>
/* Subtract the `struct timeval' values X and Y,
   storing the result in RESULT.
   Return 1 if the difference is negative, otherwise 0.  */

int
timeval_subtract (result, x, y)
     struct timeval *result, *x, *y;
{
  /* Perform the carry for the later subtraction by updating <VAR>y</VAR>. */
  if (x-&#62;tv_usec &#60; y-&#62;tv_usec) {
    int nsec = (y-&#62;tv_usec - x-&#62;tv_usec) / 1000000 + 1;
    y-&#62;tv_usec -= 1000000 * nsec;
    y-&#62;tv_sec += nsec;
  }
  if (x-&#62;tv_usec - y-&#62;tv_usec &#62; 1000000) {
    int nsec = (x-&#62;tv_usec - y-&#62;tv_usec) / 1000000;
    y-&#62;tv_usec += 1000000 * nsec;
    y-&#62;tv_sec -= nsec;
  }

  /* Compute the time remaining to wait.
     <CODE>tv_usec</CODE> is certainly positive. */
  result-&#62;tv_sec = x-&#62;tv_sec - y-&#62;tv_sec;
  result-&#62;tv_usec = x-&#62;tv_usec - y-&#62;tv_usec;

  /* Return 1 if result is negative. */
  return x-&#62;tv_sec &#60; y-&#62;tv_sec;
}
</PRE>

<P>
<DL>
<DT><U>Function:</U> int <B>gettimeofday</B> <I>(struct timeval *<VAR>tp</VAR>, struct timezone *<VAR>tzp</VAR>)</I>
<DD><A NAME="IDX2313"></A>
The <CODE>gettimeofday</CODE> function returns the current date and time in the
<CODE>struct timeval</CODE> structure indicated by <VAR>tp</VAR>.  Information about the
time zone is returned in the structure pointed at <VAR>tzp</VAR>.  If the <VAR>tzp</VAR>
argument is a null pointer, time zone information is ignored.

</P>
<P>
The return value is <CODE>0</CODE> on success and <CODE>-1</CODE> on failure.  The
following <CODE>errno</CODE> error condition is defined for this function:

</P>
<DL COMPACT>

<DT><CODE>ENOSYS</CODE>
<DD>
The operating system does not support getting time zone information, and
<VAR>tzp</VAR> is not a null pointer.  The GNU operating system does not
support using <CODE>struct timezone</CODE> to represent time zone
information; that is an obsolete feature of 4.3 BSD.
Instead, use the facilities described in section <A HREF="libc_405.html#SEC412">Functions and Variables for Time Zones</A>.
</DL>
</DL>

<P>
<DL>
<DT><U>Function:</U> int <B>settimeofday</B> <I>(const struct timeval *<VAR>tp</VAR>, const struct timezone *<VAR>tzp</VAR>)</I>
<DD><A NAME="IDX2314"></A>
The <CODE>settimeofday</CODE> function sets the current date and time
according to the arguments.  As for <CODE>gettimeofday</CODE>, time zone
information is ignored if <VAR>tzp</VAR> is a null pointer.

</P>
<P>
You must be a privileged user in order to use <CODE>settimeofday</CODE>.

</P>
<P>
The return value is <CODE>0</CODE> on success and <CODE>-1</CODE> on failure.  The
following <CODE>errno</CODE> error conditions are defined for this function:

</P>
<DL COMPACT>

<DT><CODE>EPERM</CODE>
<DD>
This process cannot set the time because it is not privileged.

<DT><CODE>ENOSYS</CODE>
<DD>
The operating system does not support setting time zone information, and
<VAR>tzp</VAR> is not a null pointer.
</DL>
</DL>

<P>
<DL>
<DT><U>Function:</U> int <B>adjtime</B> <I>(const struct timeval *<VAR>delta</VAR>, struct timeval *<VAR>olddelta</VAR>)</I>
<DD><A NAME="IDX2315"></A>
This function speeds up or slows down the system clock in order to make
gradual adjustments in the current time.  This ensures that the time
reported by the system clock is always monotonically increasing, which
might not happen if you simply set the current time.

</P>
<P>
The <VAR>delta</VAR> argument specifies a relative adjustment to be made to
the current time.  If negative, the system clock is slowed down for a
while until it has lost this much time.  If positive, the system clock
is speeded up for a while.

</P>
<P>
If the <VAR>olddelta</VAR> argument is not a null pointer, the <CODE>adjtime</CODE>
function returns information about any previous time adjustment that
has not yet completed.

</P>
<P>
This function is typically used to synchronize the clocks of computers
in a local network.  You must be a privileged user to use it.
The return value is <CODE>0</CODE> on success and <CODE>-1</CODE> on failure.  The
following <CODE>errno</CODE> error condition is defined for this function:

</P>
<DL COMPACT>

<DT><CODE>EPERM</CODE>
<DD>
You do not have privilege to set the time.
</DL>
</DL>

<P>
<STRONG>Portability Note:</STRONG>  The <CODE>gettimeofday</CODE>, <CODE>settimeofday</CODE>,
and <CODE>adjtime</CODE> functions are derived from BSD.

</P>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_397.html">previous</A>, <A HREF="libc_399.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
