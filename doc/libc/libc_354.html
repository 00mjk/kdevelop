<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Pseudo-Terminal Pairs</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_353.html">previous</A>, <A HREF="libc_355.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC361" HREF="libc_toc.html#TOC361">Opening a Pseudo-Terminal Pair</A></H3>
<P>
<A NAME="IDX1781"></A>

</P>
<P>
These functions, derived from BSD, are available in the separate
<TT>`libutil'</TT> library, and declared in <TT>`pty.h'</TT>.

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>openpty</B> <I>(int *<VAR>amaster</VAR>, int *<VAR>aslave</VAR>, char *<VAR>name</VAR>, struct termios *<VAR>termp</VAR>, struct winsize *<VAR>winp</VAR>)</I>
<DD><A NAME="IDX1782"></A>
This function allocates and opens a pseudo-terminal pair, returning the
file descriptor for the master in <VAR>*amaster</VAR>, and the file
descriptor for the slave in <VAR>*aslave</VAR>.  If the argument <VAR>name</VAR>
is not a null pointer, the file name of the slave pseudo-terminal
device is stored in <CODE>*name</CODE>.  If <VAR>termp</VAR> is not a null pointer,
the terminal attributes of the slave are set to the ones specified in
the structure that <VAR>termp</VAR> points to (see section <A HREF="libc_335.html#SEC342">Terminal Modes</A>).
Likewise, if the <VAR>winp</VAR> is not a null pointer, the screen size of
the slave is set to the values specified in the structure that
<VAR>winp</VAR> points to.

</P>
<P>
The normal return value from <CODE>openpty</CODE> is @math{0}; a value of
@math{-1} is returned in case of failure.  The following <CODE>errno</CODE>
conditions are defined for this function:

</P>
<DL COMPACT>

<DT><CODE>ENOENT</CODE>
<DD>
There are no free pseudo-terminal pairs available.
</DL>

<P>
<STRONG>Warning:</STRONG> Using the <CODE>openpty</CODE> function with <VAR>name</VAR> not
set to <CODE>NULL</CODE> is <STRONG>very dangerous</STRONG> because it provides no
protection against overflowing the string <VAR>name</VAR>.  You should use
the <CODE>ttyname</CODE> function on the file descriptor returned in
<VAR>*slave</VAR> to find out the file name of the slave pseudo-terminal
device instead.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>forkpty</B> <I>(int *<VAR>amaster</VAR>, char *<VAR>name</VAR>, struct termios *<VAR>termp</VAR>, struct winsize *<VAR>winp</VAR>)</I>
<DD><A NAME="IDX1783"></A>
This function is similar to the <CODE>openpty</CODE> function, but in
addition, forks a new process (see section <A HREF="libc_516.html#SEC524">Creating a Process</A>) and makes the
newly opened slave pseudo-terminal device the controlling terminal
(see section <A HREF="libc_525.html#SEC533">Controlling Terminal of a Process</A>) for the child process.

</P>
<P>
If the operation is successful, there are then both parent and child
processes and both see <CODE>forkpty</CODE> return, but with different values:
it returns a value of @math{0} in the child process and returns the child's
process ID in the parent process.

</P>
<P>
If the allocation of a pseudo-terminal pair or the process creation
failed, <CODE>forkpty</CODE> returns a value of @math{-1} in the parent
process.

</P>
<P>
<STRONG>Warning:</STRONG> The <CODE>forkpty</CODE> function has the same problems with
respect to the <VAR>name</VAR> argument as <CODE>openpty</CODE>.
</DL>
@set mult &middot;
@set infty &infin;
@set pie &pi;
@macro mul
@cdot
@macro infinity
@infty
@ifnottex
@macro pi

</P>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_353.html">previous</A>, <A HREF="libc_355.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
