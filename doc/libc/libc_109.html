<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - The catgets Functions</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_108.html">previous</A>, <A HREF="libc_110.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC113" HREF="libc_toc.html#TOC113">The <CODE>catgets</CODE> function family</A></H3>

<P>
<DL>
<DT><U>Function:</U> nl_catd <B>catopen</B> <I>(const char *<VAR>cat_name</VAR>, int <VAR>flag</VAR>)</I>
<DD><A NAME="IDX680"></A>
The <CODE>catgets</CODE> function tries to locate the message data file names
<VAR>cat_name</VAR> and loads it when found.  The return value is of an
opaque type and can be used in calls to the other functions to refer to
this loaded catalog.

</P>
<P>
The return value is <CODE>(nl_catd) -1</CODE> in case the function failed and
no catalog was loaded.  The global variable <VAR>errno</VAR> contains a code
for the error causing the failure.  But even if the function call
succeeded this does not mean that all messages can be translated.

</P>
<P>
Locating the catalog file must happen in a way which lets the user of
the program influence the decision.  It is up to the user to decide
about the language to use and sometimes it is useful to use alternate
catalog files.  All this can be specified by the user by setting some
environment variables.

</P>
<P>
The first problem is to find out where all the message catalogs are
stored.  Every program could have its own place to keep all the
different files but usually the catalog files are grouped by languages
and the catalogs for all programs are kept in the same place.

</P>
<P>
<A NAME="IDX681"></A>
To tell the <CODE>catopen</CODE> function where the catalog for the program
can be found the user can set the environment variable <CODE>NLSPATH</CODE> to
a value which describes her/his choice.  Since this value must be usable
for different languages and locales it cannot be a simple string.
Instead it is a format string (similar to <CODE>printf</CODE>'s).  An example
is

</P>

<PRE>
/usr/share/locale/%L/%N:/usr/share/locale/%L/LC_MESSAGES/%N
</PRE>

<P>
First one can see that more than one directory can be specified (with
the usual syntax of separating them by colons).  The next things to
observe are the format string, <CODE>%L</CODE> and <CODE>%N</CODE> in this case.
The <CODE>catopen</CODE> function knows about several of them and the
replacement for all of them is of course different.

</P>
<DL COMPACT>

<DT><CODE>%N</CODE>
<DD>
This format element is substituted with the name of the catalog file.
This is the value of the <VAR>cat_name</VAR> argument given to
<CODE>catgets</CODE>.

<DT><CODE>%L</CODE>
<DD>
This format element is substituted with the name of the currently
selected locale for translating messages.  How this is determined is
explained below.

<DT><CODE>%l</CODE>
<DD>
(This is the lowercase ell.) This format element is substituted with the
language element of the locale name.  The string describing the selected
locale is expected to have the form
<CODE><VAR>lang</VAR>[_<VAR>terr</VAR>[.<VAR>codeset</VAR>]]</CODE> and this format uses the
first part <VAR>lang</VAR>.

<DT><CODE>%t</CODE>
<DD>
This format element is substituted by the territory part <VAR>terr</VAR> of
the name of the currently selected locale.  See the explanation of the
format above.

<DT><CODE>%c</CODE>
<DD>
This format element is substituted by the codeset part <VAR>codeset</VAR> of
the name of the currently selected locale.  See the explanation of the
format above.

<DT><CODE>%%</CODE>
<DD>
Since <CODE>%</CODE> is used in a meta character there must be a way to
express the <CODE>%</CODE> character in the result itself.  Using <CODE>%%</CODE>
does this just like it works for <CODE>printf</CODE>.
</DL>

<P>
Using <CODE>NLSPATH</CODE> allows to specify arbitrary directories to be
searched for message catalogs while still allowing different languages
to be used.  If the <CODE>NLSPATH</CODE> environment variable is not set the
default value is

</P>

<PRE>
<VAR>prefix</VAR>/share/locale/%L/%N:<VAR>prefix</VAR>/share/locale/%L/LC_MESSAGES/%N
</PRE>

<P>
where <VAR>prefix</VAR> is given to <CODE>configure</CODE> while installing the GNU
C Library (this value is in many cases <CODE>/usr</CODE> or the empty string).

</P>
<P>
The remaining problem is to decide which must be used.  The value
decides about the substitution of the format elements mentioned above.
First of all the user can specify a path in the message catalog name
(i.e., the name contains a slash character).  In this situation the
<CODE>NLSPATH</CODE> environment variable is not used.  The catalog must exist
as specified in the program, perhaps relative to the current working
directory.  This situation in not desirable and catalogs names never
should be written this way.  Beside this, this behaviour is not portable
to all other platforms providing the <CODE>catgets</CODE> interface.

</P>
<P>
<A NAME="IDX682"></A>
<A NAME="IDX683"></A>
<A NAME="IDX684"></A>
Otherwise the values of environment variables from the standard
environment are examined (see section <A HREF="libc_505.html#SEC513">Standard Environment Variables</A>).  Which
variables are examined is decided by the <VAR>flag</VAR> parameter of
<CODE>catopen</CODE>.  If the value is <CODE>NL_CAT_LOCALE</CODE> (which is defined
in <TT>`nl_types.h'</TT>) then the <CODE>catopen</CODE> function examines the
environment variable <CODE>LC_ALL</CODE>, <CODE>LC_MESSAGES</CODE>, and <CODE>LANG</CODE>
in this order.  The first variable which is set in the current
environment will be used.

</P>
<P>
If <VAR>flag</VAR> is zero only the <CODE>LANG</CODE> environment variable is
examined.  This is a left-over from the early days of this function
where the other environment variable were not known.

</P>
<P>
In any case the environment variable should have a value of the form
<CODE><VAR>lang</VAR>[_<VAR>terr</VAR>[.<VAR>codeset</VAR>]]</CODE> as explained above.  If
no environment variable is set the <CODE>"C"</CODE> locale is used which
prevents any translation.

</P>
<P>
The return value of the function is in any case a valid string.  Either
it is a translation from a message catalog or it is the same as the
<VAR>string</VAR> parameter.  So a piece of code to decide whether a
translation actually happened must look like this:

</P>

<PRE>
{
  char *trans = catgets (desc, set, msg, input_string);
  if (trans == input_string)
    {
      /* Something went wrong.  */
    }
}
</PRE>

<P>
When an error occurred the global variable <VAR>errno</VAR> is set to

</P>
<DL COMPACT>

<DT><VAR>EBADF</VAR>
<DD>
The catalog does not exist.
<DT><VAR>ENOMSG</VAR>
<DD>
The set/message tuple does not name an existing element in the
message catalog.
</DL>

<P>
While it sometimes can be useful to test for errors programs normally
will avoid any test.  If the translation is not available it is no big
problem if the original, untranslated message is printed.  Either the
user understands this as well or s/he will look for the reason why the
messages are not translated.
</DL>

</P>
<P>
Please note that the currently selected locale does not depend on a call
to the <CODE>setlocale</CODE> function.  It is not necessary that the locale
data files for this locale exist and calling <CODE>setlocale</CODE> succeeds.
The <CODE>catopen</CODE> function directly reads the values of the environment
variables.

</P>

<P>
<DL>
<DT><U>Function:</U> char * <B>catgets</B> <I>(nl_catd <VAR>catalog_desc</VAR>, int <VAR>set</VAR>, int <VAR>message</VAR>, const char *<VAR>string</VAR>)</I>
<DD><A NAME="IDX685"></A>
The function <CODE>catgets</CODE> has to be used to access the massage catalog
previously opened using the <CODE>catopen</CODE> function.  The
<VAR>catalog_desc</VAR> parameter must be a value previously returned by
<CODE>catopen</CODE>.

</P>
<P>
The next two parameters, <VAR>set</VAR> and <VAR>message</VAR>, reflect the
internal organization of the message catalog files.  This will be
explained in detail below.  For now it is interesting to know that a
catalog can consists of several set and the messages in each thread are
individually numbered using numbers.  Neither the set number nor the
message number must be consecutive.  They can be arbitrarily chosen.
But each message (unless equal to another one) must have its own unique
pair of set and message number.

</P>
<P>
Since it is not guaranteed that the message catalog for the language
selected by the user exists the last parameter <VAR>string</VAR> helps to
handle this case gracefully.  If no matching string can be found
<VAR>string</VAR> is returned.  This means for the programmer that

</P>

<UL>
<LI>

the <VAR>string</VAR> parameters should contain reasonable text (this also
helps to understand the program seems otherwise there would be no hint
on the string which is expected to be returned.
<LI>

all <VAR>string</VAR> arguments should be written in the same language.
</UL>

</DL>

<P>
It is somewhat uncomfortable to write a program using the <CODE>catgets</CODE>
functions if no supporting functionality is available.  Since each
set/message number tuple must be unique, the programmer must keep lists
of the messages at the same time the code is written.  And the work
between several people working on the same project must be coordinated.
We will see some how these problems can be relaxed a bit (see section <A HREF="libc_112.html#SEC116">How to use the <CODE>catgets</CODE> interface</A>).

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>catclose</B> <I>(nl_catd <VAR>catalog_desc</VAR>)</I>
<DD><A NAME="IDX686"></A>
The <CODE>catclose</CODE> function can be used to free the resources
associated with a message catalog which previously was opened by a call
to <CODE>catopen</CODE>.  If the resources can be successfully freed the
function returns <CODE>0</CODE>.  Otherwise it return <CODE>-1</CODE> and the
global variable <VAR>errno</VAR> is set.  Errors can occur if the catalog
descriptor <VAR>catalog_desc</VAR> is not valid in which case <VAR>errno</VAR> is
set to <CODE>EBADF</CODE>.
</DL>

</P>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_108.html">previous</A>, <A HREF="libc_110.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
