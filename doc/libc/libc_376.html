<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Control Functions</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_375.html">previous</A>, <A HREF="libc_377.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC383" HREF="libc_toc.html#TOC383">Floating-Point Control Functions</A></H2>

<P>
IEEE 754 floating-point implementations allow the programmer to
decide whether traps will occur for each of the exceptions, by setting
bits in the <STRONG>control word</STRONG>.  In C, traps result in the program
receiving the <CODE>SIGFPE</CODE> signal; see section <A HREF="libc_417.html#SEC424">Signal Handling</A>.

</P>
<P>
<STRONG>Note:</STRONG> IEEE 754 says that trap handlers are given details of
the exceptional situation, and can set the result value.  C signals do
not provide any mechanism to pass this information back and forth.
Trapping exceptions in C is therefore not very useful.

</P>
<P>
It is sometimes necessary to save the state of the floating-point unit
while you perform some calculation.  The library provides functions
which save and restore the exception flags, the set of exceptions that
generate traps, and the rounding mode.  This information is known as the
<STRONG>floating-point environment</STRONG>.

</P>
<P>
The functions to save and restore the floating-point environment all use
a variable of type <CODE>fenv_t</CODE> to store information.  This type is
defined in <TT>`fenv.h'</TT>.  Its size and contents are
implementation-defined.  You should not attempt to manipulate a variable
of this type directly.

</P>
<P>
To save the state of the FPU, use one of these functions:

</P>
<P>
<DL>
<DT><U>Function:</U> void <B>fegetenv</B> <I>(fenv_t *<VAR>envp</VAR>)</I>
<DD><A NAME="IDX2090"></A>
Store the floating-point environment in the variable pointed to by
<VAR>envp</VAR>.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> int <B>feholdexcept</B> <I>(fenv_t *<VAR>envp</VAR>)</I>
<DD><A NAME="IDX2091"></A>
Store the current floating-point environment in the object pointed to by
<VAR>envp</VAR>.  Then clear all exception flags, and set the FPU to trap no
exceptions.  Not all FPUs support trapping no exceptions; if
<CODE>feholdexcept</CODE> cannot set this mode, it returns zero.  If it
succeeds, it returns a nonzero value.
</DL>

</P>
<P>
The functions which restore the floating-point environment can take two
kinds of arguments:

</P>

<UL>
<LI>

Pointers to <CODE>fenv_t</CODE> objects, which were initialized previously by a
call to <CODE>fegetenv</CODE> or <CODE>feholdexcept</CODE>.
<LI>

<A NAME="IDX2092"></A>
The special macro <CODE>FE_DFL_ENV</CODE> which represents the floating-point
environment as it was available at program start.
<LI>

Implementation defined macros with names starting with <CODE>FE_</CODE>.

<A NAME="IDX2093"></A>
If possible, the GNU C Library defines a macro <CODE>FE_NOMASK_ENV</CODE>
which represents an environment where every exception raised causes a
trap to occur.  You can test for this macro using <CODE>#ifdef</CODE>.  It is
only defined if <CODE>_GNU_SOURCE</CODE> is defined.

Some platforms might define other predefined environments.
</UL>

<P>
To set the floating-point environment, you can use either of these
functions:

</P>
<P>
<DL>
<DT><U>Function:</U> void <B>fesetenv</B> <I>(const fenv_t *<VAR>envp</VAR>)</I>
<DD><A NAME="IDX2094"></A>
Set the floating-point environment to that described by <VAR>envp</VAR>.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> void <B>feupdateenv</B> <I>(const fenv_t *<VAR>envp</VAR>)</I>
<DD><A NAME="IDX2095"></A>
Like <CODE>fesetenv</CODE>, this function sets the floating-point environment
to that described by <VAR>envp</VAR>.  However, if any exceptions were
flagged in the status word before <CODE>feupdateenv</CODE> was called, they
remain flagged after the call.  In other words, after <CODE>feupdateenv</CODE>
is called, the status word is the bitwise OR of the previous status word
and the one saved in <VAR>envp</VAR>.
</DL>

</P>
<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_375.html">previous</A>, <A HREF="libc_377.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
