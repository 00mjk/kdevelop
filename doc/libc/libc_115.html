<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Translation with gettext</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_114.html">previous</A>, <A HREF="libc_116.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H4><A NAME="SEC122" HREF="libc_toc.html#TOC122">What has to be done to translate a message?</A></H4>

<P>
The <CODE>gettext</CODE> functions have a very simple interface.  The most
basic function just takes the string which shall be translated as the
argument and it returns the translation.  This is fundamentally
different from the <CODE>catgets</CODE> approach where an extra key is
necessary and the original string is only used for the error case.

</P>
<P>
If the string which has to be translated is the only argument this of
course means the string itself is the key.  I.e., the translation will
be selected based on the original string.  The message catalogs must
therefore contain the original strings plus one translation for any such
string.  The task of the <CODE>gettext</CODE> function is it to compare the
argument string with the available strings in the catalog and return the
appropriate translation.  Of course this process is optimized so that
this process is not more expensive than an access using an atomic key
like in <CODE>catgets</CODE>.

</P>
<P>
The <CODE>gettext</CODE> approach has some advantages but also some
disadvantages.  Please see the GNU <TT>`gettext'</TT> manual for a detailed
discussion of the pros and cons.

</P>
<P>
All the definitions and declarations for <CODE>gettext</CODE> can be found in
the <TT>`libintl.h'</TT> header file.  On systems where these functions are
not part of the C library they can be found in a separate library named
<TT>`libintl.a'</TT> (or accordingly different for shared libraries).

</P>
<P>
<DL>
<DT><U>Function:</U> char * <B>gettext</B> <I>(const char *<VAR>msgid</VAR>)</I>
<DD><A NAME="IDX688"></A>
The <CODE>gettext</CODE> function searches the currently selected message
catalogs for a string which is equal to <VAR>msgid</VAR>.  If there is such a
string available it is returned.  Otherwise the argument string
<VAR>msgid</VAR> is returned.

</P>
<P>
Please note that all though the return value is <CODE>char *</CODE> the
returned string must not be changed.  This broken type results from the
history of the function and does not reflect the way the function should
be used.

</P>
<P>
Please note that above we wrote "message catalogs" (plural).  This is
a specialty of the GNU implementation of these functions and we will
say more about this when we talk about the ways message catalogs are
selected (see section <A HREF="libc_116.html#SEC123">How to determine which catalog to be used</A>).

</P>
<P>
The <CODE>gettext</CODE> function does not modify the value of the global
<VAR>errno</VAR> variable.  This is necessary to make it possible to write
something like

</P>

<PRE>
  printf (gettext ("Operation failed: %m\n"));
</PRE>

<P>
Here the <VAR>errno</VAR> value is used in the <CODE>printf</CODE> function while
processing the <CODE>%m</CODE> format element and if the <CODE>gettext</CODE>
function would change this value (it is called before <CODE>printf</CODE> is
called) we would get a wrong message.

</P>
<P>
So there is no easy way to detect a missing message catalog beside
comparing the argument string with the result.  But it is normally the
task of the user to react on missing catalogs.  The program cannot guess
when a message catalog is really necessary since for a user who s peaks
the language the program was developed in does not need any translation.
</DL>

</P>
<P>
The remaining two functions to access the message catalog add some
functionality to select a message catalog which is not the default one.
This is important if parts of the program are developed independently.
Every part can have its own message catalog and all of them can be used
at the same time.  The C library itself is an example: internally it
uses the <CODE>gettext</CODE> functions but since it must not depend on a
currently selected default message catalog it must specify all ambiguous
information.

</P>
<P>
<DL>
<DT><U>Function:</U> char * <B>dgettext</B> <I>(const char *<VAR>domainname</VAR>, const char *<VAR>msgid</VAR>)</I>
<DD><A NAME="IDX689"></A>
The <CODE>dgettext</CODE> functions acts just like the <CODE>gettext</CODE>
function.  It only takes an additional first argument <VAR>domainname</VAR>
which guides the selection of the message catalogs which are searched
for the translation.  If the <VAR>domainname</VAR> parameter is the null
pointer the <CODE>dgettext</CODE> function is exactly equivalent to
<CODE>gettext</CODE> since the default value for the domain name is used.

</P>
<P>
As for <CODE>gettext</CODE> the return value type is <CODE>char *</CODE> which is an
anachronism.  The returned string must never be modified.
</DL>

</P>
<P>
<DL>
<DT><U>Function:</U> char * <B>dcgettext</B> <I>(const char *<VAR>domainname</VAR>, const char *<VAR>msgid</VAR>, int <VAR>category</VAR>)</I>
<DD><A NAME="IDX690"></A>
The <CODE>dcgettext</CODE> adds another argument to those which
<CODE>dgettext</CODE> takes.  This argument <VAR>category</VAR> specifies the last
piece of information needed to localize the message catalog.  I.e., the
domain name and the locale category exactly specify which message
catalog has to be used (relative to a given directory, see below).

</P>
<P>
The <CODE>dgettext</CODE> function can be expressed in terms of
<CODE>dcgettext</CODE> by using

</P>

<PRE>
dcgettext (domain, string, LC_MESSAGES)
</PRE>

<P>
instead of

</P>

<PRE>
dgettext (domain, string)
</PRE>

<P>
This also shows which values are expected for the third parameter.  One
has to use the available selectors for the categories available in
<TT>`locale.h'</TT>.  Normally the available values are <CODE>LC_CTYPE</CODE>,
<CODE>LC_COLLATE</CODE>, <CODE>LC_MESSAGES</CODE>, <CODE>LC_MONETARY</CODE>,
<CODE>LC_NUMERIC</CODE>, and <CODE>LC_TIME</CODE>.  Please note that <CODE>LC_ALL</CODE>
must not be used and even though the names might suggest this, there is
no relation to the environments variables of this name.

</P>
<P>
The <CODE>dcgettext</CODE> function is only implemented for compatibility with
other systems which have <CODE>gettext</CODE> functions.  There is not really
any situation where it is necessary (or useful) to use a different value
but <CODE>LC_MESSAGES</CODE> in for the <VAR>category</VAR> parameter.  We are
dealing with messages here and any other choice can only be irritating.

</P>
<P>
As for <CODE>gettext</CODE> the return value type is <CODE>char *</CODE> which is an
anachronism.  The returned string must never be modified.
</DL>

</P>
<P>
When using the three functions above in a program it is a frequent case
that the <VAR>msgid</VAR> argument is a constant string.  So it is worth to
optimize this case.  Thinking shortly about this one will realize that
as long as no new message catalog is loaded the translation of a message
will not change.  I.e., the algorithm to determine the translation is
deterministic.

</P>
<P>
Exactly this is what the optimizations implemented in the
<TT>`libintl.h'</TT> header will use.  Whenever a program is compiler with
the GNU C compiler, optimization is selected and the <VAR>msgid</VAR>
argument to <CODE>gettext</CODE>, <CODE>dgettext</CODE> or <CODE>dcgettext</CODE> is a
constant string the actual function call will only be done the first
time the message is used and then always only if any new message catalog
was loaded and so the result of the translation lookup might be
different.  See the <TT>`libintl.h'</TT> header file for details.  For the
user it is only important to know that the result is always the same,
independent of the compiler or compiler options in use.

</P>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_114.html">previous</A>, <A HREF="libc_116.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
