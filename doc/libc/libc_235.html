<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Descriptor Flags</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_234.html">previous</A>, <A HREF="libc_236.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H2><A NAME="SEC242" HREF="libc_toc.html#TOC242">File Descriptor Flags</A></H2>
<P>
<A NAME="IDX1103"></A>

</P>
<P>
<STRONG>File descriptor flags</STRONG> are miscellaneous attributes of a file
descriptor.  These flags are associated with particular file
descriptors, so that if you have created duplicate file descriptors
from a single opening of a file, each descriptor has its own set of flags.

</P>
<P>
Currently there is just one file descriptor flag: <CODE>FD_CLOEXEC</CODE>,
which causes the descriptor to be closed if you use any of the
<CODE>exec...</CODE> functions (see section <A HREF="libc_517.html#SEC525">Executing a File</A>).

</P>
<P>
The symbols in this section are defined in the header file
<TT>`fcntl.h'</TT>.
<A NAME="IDX1104"></A>

</P>
<P>
<DL>
<DT><U>Macro:</U> int <B>F_GETFD</B>
<DD><A NAME="IDX1105"></A>
This macro is used as the <VAR>command</VAR> argument to <CODE>fcntl</CODE>, to
specify that it should return the file descriptor flags associated
with the <VAR>filedes</VAR> argument.

</P>
<P>
The normal return value from <CODE>fcntl</CODE> with this command is a
nonnegative number which can be interpreted as the bitwise OR of the
individual flags (except that currently there is only one flag to use).

</P>
<P>
In case of an error, <CODE>fcntl</CODE> returns @math{-1}.  The following
<CODE>errno</CODE> error conditions are defined for this command:

</P>
<DL COMPACT>

<DT><CODE>EBADF</CODE>
<DD>
The <VAR>filedes</VAR> argument is invalid.
</DL>
</DL>

<P>
<DL>
<DT><U>Macro:</U> int <B>F_SETFD</B>
<DD><A NAME="IDX1106"></A>
This macro is used as the <VAR>command</VAR> argument to <CODE>fcntl</CODE>, to
specify that it should set the file descriptor flags associated with the
<VAR>filedes</VAR> argument.  This requires a third <CODE>int</CODE> argument to
specify the new flags, so the form of the call is:

</P>

<PRE>
fcntl (<VAR>filedes</VAR>, F_SETFD, <VAR>new-flags</VAR>)
</PRE>

<P>
The normal return value from <CODE>fcntl</CODE> with this command is an
unspecified value other than @math{-1}, which indicates an error.
The flags and error conditions are the same as for the <CODE>F_GETFD</CODE>
command.
</DL>

</P>
<P>
The following macro is defined for use as a file descriptor flag with
the <CODE>fcntl</CODE> function.  The value is an integer constant usable
as a bit mask value.

</P>
<P>
<DL>
<DT><U>Macro:</U> int <B>FD_CLOEXEC</B>
<DD><A NAME="IDX1107"></A>
<A NAME="IDX1108"></A>
This flag specifies that the file descriptor should be closed when
an <CODE>exec</CODE> function is invoked; see section <A HREF="libc_517.html#SEC525">Executing a File</A>.  When
a file descriptor is allocated (as with <CODE>open</CODE> or <CODE>dup</CODE>),
this bit is initially cleared on the new file descriptor, meaning that
descriptor will survive into the new program after <CODE>exec</CODE>.
</DL>

</P>
<P>
If you want to modify the file descriptor flags, you should get the
current flags with <CODE>F_GETFD</CODE> and modify the value.  Don't assume
that the flags listed here are the only ones that are implemented; your
program may be run years from now and more flags may exist then.  For
example, here is a function to set or clear the flag <CODE>FD_CLOEXEC</CODE>
without altering any other flags:

</P>

<PRE>
/* Set the <CODE>FD_CLOEXEC</CODE> flag of <VAR>desc</VAR> if <VAR>value</VAR> is nonzero,
   or clear the flag if <VAR>value</VAR> is 0.
   Return 0 on success, or -1 on error with <CODE>errno</CODE> set. */

int
set_cloexec_flag (int desc, int value)
{
  int oldflags = fcntl (desc, F_GETFD, 0);
  /* If reading the flags failed, return error indication now.
  if (oldflags &#60; 0)
    return oldflags;
  /* Set just the flag we want to set. */
  if (value != 0)
    oldflags |= FD_CLOEXEC;
  else
    oldflags &#38;= ~FD_CLOEXEC;
  /* Store modified flag word in the descriptor. */
  return fcntl (desc, F_SETFD, oldflags);
}
</PRE>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_234.html">previous</A>, <A HREF="libc_236.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
