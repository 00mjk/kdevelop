<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Printing Formatted Messages</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_209.html">previous</A>, <A HREF="libc_211.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H3><A NAME="SEC217" HREF="libc_toc.html#TOC217">Printing Formatted Messages</A></H3>

<P>
Messages can be printed to standard error and/or to the console.  To
select the destination the programmer can use the following two values,
bitwise OR combined if wanted, for the <VAR>classification</VAR> parameter of
<CODE>fmtmsg</CODE>:

</P>
<DL COMPACT>

<DT><CODE>MM_PRINT</CODE>
<DD>
<A NAME="IDX953"></A>
Display the message in standard error.
<DT><CODE>MM_CONSOLE</CODE>
<DD>
<A NAME="IDX954"></A>
Display the message on the system console.
</DL>

<P>
The erroneous piece of the system can be signalled by exactly one of the
following values which also is bitwise ORed with the
<VAR>classification</VAR> parameter to <CODE>fmtmsg</CODE>:

</P>
<DL COMPACT>

<DT><CODE>MM_HARD</CODE>
<DD>
<A NAME="IDX955"></A>
The source of the condition is some hardware.
<DT><CODE>MM_SOFT</CODE>
<DD>
<A NAME="IDX956"></A>
The source of the condition is some software.
<DT><CODE>MM_FIRM</CODE>
<DD>
<A NAME="IDX957"></A>
The source of the condition is some firmware.
</DL>

<P>
A third component of the <VAR>classification</VAR> parameter to <CODE>fmtmsg</CODE>
can describe the part of the system which detects the problem.  This is
done by using exactly one of the following values:

</P>
<DL COMPACT>

<DT><CODE>MM_APPL</CODE>
<DD>
<A NAME="IDX958"></A>
The erroneous condition is detected by the application.
<DT><CODE>MM_UTIL</CODE>
<DD>
<A NAME="IDX959"></A>
The erroneous condition is detected by a utility.
<DT><CODE>MM_OPSYS</CODE>
<DD>
<A NAME="IDX960"></A>
The erroneous condition is detected by the operating system.
</DL>

<P>
A last component of <VAR>classification</VAR> can signal the results of this
message.  Exactly one of the following values can be used:

</P>
<DL COMPACT>

<DT><CODE>MM_RECOVER</CODE>
<DD>
<A NAME="IDX961"></A>
It is a recoverable error.
<DT><CODE>MM_NRECOV</CODE>
<DD>
<A NAME="IDX962"></A>
It is a non-recoverable error.
</DL>

<P>
<DL>
<DT><U>Function:</U> int <B>fmtmsg</B> <I>(long int <VAR>classification</VAR>, const char *<VAR>label</VAR>, int <VAR>severity</VAR>, const char *<VAR>text</VAR>, const char *<VAR>action</VAR>, const char *<VAR>tag</VAR>)</I>
<DD><A NAME="IDX963"></A>
Display a message described by its parameters on the device(s) specified
in the <VAR>classification</VAR> parameter.  The <VAR>label</VAR> parameter
identifies the source of the message.  The string should consist of two
colon separated parts where the first part has not more than 10 and the
second part not more the 14 characters.  The <VAR>text</VAR> parameter
describes the condition of the error, the <VAR>action</VAR> parameter possible
steps to recover from the error and the <VAR>tag</VAR> parameter is a
reference to the online documentation where more information can be
found.  It should contain the <VAR>label</VAR> value and a unique
identification number.

</P>
<P>
Each of the parameters can be a special value which means this value
is to be omitted.  The symbolic names for these values are:

</P>
<DL COMPACT>

<DT><CODE>MM_NULLLBL</CODE>
<DD>
<A NAME="IDX964"></A>
Ignore <VAR>label</VAR> parameter.
<DT><CODE>MM_NULLSEV</CODE>
<DD>
<A NAME="IDX965"></A>
Ignore <VAR>severity</VAR> parameter.
<DT><CODE>MM_NULLMC</CODE>
<DD>
<A NAME="IDX966"></A>
Ignore <VAR>classification</VAR> parameter.  This implies that nothing is
actually printed.
<DT><CODE>MM_NULLTXT</CODE>
<DD>
<A NAME="IDX967"></A>
Ignore <VAR>text</VAR> parameter.
<DT><CODE>MM_NULLACT</CODE>
<DD>
<A NAME="IDX968"></A>
Ignore <VAR>action</VAR> parameter.
<DT><CODE>MM_NULLTAG</CODE>
<DD>
<A NAME="IDX969"></A>
Ignore <VAR>tag</VAR> parameter.
</DL>

<P>
There is another way certain fields can be omitted from the output to
standard error.  This is described below in the description of
environment variables influencing the behaviour.

</P>
<P>
The <VAR>severity</VAR> parameter can have one of the values in the following
table:
<A NAME="IDX970"></A>

</P>
<DL COMPACT>

<DT><CODE>MM_NOSEV</CODE>
<DD>
<A NAME="IDX971"></A>
Nothing is printed, this value is the same as <CODE>MM_NULLSEV</CODE>.
<DT><CODE>MM_HALT</CODE>
<DD>
<A NAME="IDX972"></A>
This value is printed as <CODE>HALT</CODE>.
<DT><CODE>MM_ERROR</CODE>
<DD>
<A NAME="IDX973"></A>
This value is printed as <CODE>ERROR</CODE>.
<DT><CODE>MM_WARNING</CODE>
<DD>
<A NAME="IDX974"></A>
This value is printed as <CODE>WARNING</CODE>.
<DT><CODE>MM_INFO</CODE>
<DD>
<A NAME="IDX975"></A>
This value is printed as <CODE>INFO</CODE>.
</DL>

<P>
The numeric value of these five macros are between <CODE>0</CODE> and
<CODE>4</CODE>.  Using the environment variable <CODE>SEV_LEVEL</CODE> or using the
<CODE>addseverity</CODE> function one can add more severity levels with their
corresponding string to print.  This is described below
(see section <A HREF="libc_211.html#SEC218">Adding Severity Classes</A>).

</P>
<P>
If no parameter is ignored the output looks like this:

</P>

<PRE>
<VAR>label</VAR>: <VAR>severity-string</VAR>: <VAR>text</VAR>
TO FIX: <VAR>action</VAR> <VAR>tag</VAR>
</PRE>

<P>
The colons, new line characters and the <CODE>TO FIX</CODE> string are
inserted if necessary, i.e., if the corresponding parameter is not
ignored.

</P>
<P>
This function is specified in the X/Open Portability Guide.  It is also
available on all system derived from System V.

</P>
<P>
The function returns the value <CODE>MM_OK</CODE> if no error occurred.  If
only the printing to standard error failed, it returns <CODE>MM_NOMSG</CODE>.
If printing to the console fails, it returns <CODE>MM_NOCON</CODE>.  If
nothing is printed <CODE>MM_NOTOK</CODE> is returned.  Among situations where
all outputs fail this last value is also returned if a parameter value
is incorrect.
</DL>

</P>
<P>
There are two environment variables which influence the behaviour of
<CODE>fmtmsg</CODE>.  The first is <CODE>MSGVERB</CODE>.  It is used to control the
output actually happening on standard error (<EM>not</EM> the console
output).  Each of the five fields can be explicitly enabled.  To do
this the user has to put the <CODE>MSGVERB</CODE> variable with a format like
the following in the environment before calling the <CODE>fmtmsg</CODE> function
the first time:

</P>

<PRE>
MSGVERB=<VAR>keyword</VAR>[:<VAR>keyword</VAR>[:...]]
</PRE>

<P>
Valid <VAR>keyword</VAR>s are <CODE>label</CODE>, <CODE>severity</CODE>, <CODE>text</CODE>,
<CODE>action</CODE>, and <CODE>tag</CODE>.  If the environment variable is not given
or is the empty string, a not supported keyword is given or the value is
somehow else invalid, no part of the message is masked out.

</P>
<P>
The second environment variable which influences the behaviour of
<CODE>fmtmsg</CODE> is <CODE>SEV_LEVEL</CODE>.  This variable and the change in the
behaviour of <CODE>fmtmsg</CODE> is not specified in the X/Open Portability
Guide.  It is available in System V systems, though.  It can be used to
introduce new severity levels.  By default, only the five severity levels
described above are available.  Any other numeric value would make
<CODE>fmtmsg</CODE> print nothing.

</P>
<P>
If the user puts <CODE>SEV_LEVEL</CODE> with a format like

</P>

<PRE>
SEV_LEVEL=[<VAR>description</VAR>[:<VAR>description</VAR>[:...]]]
</PRE>

<P>
in the environment of the process before the first call to
<CODE>fmtmsg</CODE>, where <VAR>description</VAR> has a value of the form

</P>

<PRE>
<VAR>severity-keyword</VAR>,<VAR>level</VAR>,<VAR>printstring</VAR>
</PRE>

<P>
The <VAR>severity-keyword</VAR> part is not used by <CODE>fmtmsg</CODE> but it has
to be present.  The <VAR>level</VAR> part is a string representation of a
number.  The numeric value must be a number greater than 4.  This value
must be used in the <VAR>severity</VAR> parameter of <CODE>fmtmsg</CODE> to select
this class.  It is not possible to overwrite any of the predefined
classes.  The <VAR>printstring</VAR> is the string printed when a message of
this class is processed by <CODE>fmtmsg</CODE> (see above, <CODE>fmtsmg</CODE> does
not print the numeric value but instead the string representation).

</P>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_209.html">previous</A>, <A HREF="libc_211.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
