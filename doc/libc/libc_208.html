<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from libc.texinfo on 28 March 2001 -->

<TITLE>The GNU C Library - Hook Functions</TITLE>
</HEAD>
<BODY>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_207.html">previous</A>, <A HREF="libc_209.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
<P><HR><P>


<H4><A NAME="SEC215" HREF="libc_toc.html#TOC215">Custom Stream Hook Functions</A></H4>
<P>
<A NAME="IDX947"></A>

</P>
<P>
Here are more details on how you should define the four hook functions
that a custom stream needs.

</P>
<P>
You should define the function to read data from the cookie as:

</P>

<PRE>
ssize_t <VAR>reader</VAR> (void *<VAR>cookie</VAR>, void *<VAR>buffer</VAR>, size_t <VAR>size</VAR>)
</PRE>

<P>
This is very similar to the <CODE>read</CODE> function; see section <A HREF="libc_216.html#SEC223">Input and Output Primitives</A>.  Your function should transfer up to <VAR>size</VAR> bytes into
the <VAR>buffer</VAR>, and return the number of bytes read, or zero to
indicate end-of-file.  You can return a value of <CODE>-1</CODE> to indicate
an error.

</P>
<P>
You should define the function to write data to the cookie as:

</P>

<PRE>
ssize_t <VAR>writer</VAR> (void *<VAR>cookie</VAR>, const void *<VAR>buffer</VAR>, size_t <VAR>size</VAR>)
</PRE>

<P>
This is very similar to the <CODE>write</CODE> function; see section <A HREF="libc_216.html#SEC223">Input and Output Primitives</A>.  Your function should transfer up to <VAR>size</VAR> bytes from
the buffer, and return the number of bytes written.  You can return a
value of <CODE>-1</CODE> to indicate an error.

</P>
<P>
You should define the function to perform seek operations on the cookie
as:

</P>

<PRE>
int <VAR>seeker</VAR> (void *<VAR>cookie</VAR>, fpos_t *<VAR>position</VAR>, int <VAR>whence</VAR>)
</PRE>

<P>
For this function, the <VAR>position</VAR> and <VAR>whence</VAR> arguments are
interpreted as for <CODE>fgetpos</CODE>; see section <A HREF="libc_198.html#SEC205">Portable File-Position Functions</A>.  In
the GNU library, <CODE>fpos_t</CODE> is equivalent to <CODE>off_t</CODE> or
<CODE>long int</CODE>, and simply represents the number of bytes from the
beginning of the file.

</P>
<P>
After doing the seek operation, your function should store the resulting
file position relative to the beginning of the file in <VAR>position</VAR>.
Your function should return a value of <CODE>0</CODE> on success and <CODE>-1</CODE>
to indicate an error.

</P>
<P>
You should define the function to do cleanup operations on the cookie
appropriate for closing the stream as:

</P>

<PRE>
int <VAR>cleaner</VAR> (void *<VAR>cookie</VAR>)
</PRE>

<P>
Your function should return <CODE>-1</CODE> to indicate an error, and <CODE>0</CODE>
otherwise.

</P>
<P>
<DL>
<DT><U>Data Type:</U> <B>cookie_read_function</B>
<DD><A NAME="IDX948"></A>
This is the data type that the read function for a custom stream should have.
If you declare the function as shown above, this is the type it will have.
</DL>

</P>
<P>
<DL>
<DT><U>Data Type:</U> <B>cookie_write_function</B>
<DD><A NAME="IDX949"></A>
The data type of the write function for a custom stream.
</DL>

</P>
<P>
<DL>
<DT><U>Data Type:</U> <B>cookie_seek_function</B>
<DD><A NAME="IDX950"></A>
The data type of the seek function for a custom stream.
</DL>

</P>
<P>
<DL>
<DT><U>Data Type:</U> <B>cookie_close_function</B>
<DD><A NAME="IDX951"></A>
The data type of the close function for a custom stream.
</DL>

</P>

<P><HR><P>
Go to the <A HREF="libc_1.html">first</A>, <A HREF="libc_207.html">previous</A>, <A HREF="libc_209.html">next</A>, <A HREF="libc_654.html">last</A> section, <A HREF="libc_toc.html">table of contents</A>.
</BODY>
</HTML>
